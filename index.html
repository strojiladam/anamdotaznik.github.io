<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anamnéza dítěte</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet">
  <style>
    body {
      font-family: var(--font-body);
      background-color: var(--bg-body);
      color: var(--text-main);
      margin: 0;
      padding: 20px;
      padding-top: 20px;
    }

    h1 {
      color: var(--muni-blue);
      text-align: center;
      margin-bottom: 30px;
    }

    form {
      max-width: 900px;
      margin: 0 auto;
      background-color: var(--bg-base);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    fieldset {
      border: 1px solid var(--border-main);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      background-color: var(--bg-fieldset);
      min-width: 0;
    }

    legend {
      font-weight: 700;
      color: var(--muni-blue);
      font-size: 17px;
      padding: 0 5px;
    }

    label {
      display: block;
      margin-bottom: 0;
      font-weight: 500;
      page-break-inside: avoid;
    }

    input,
    select,
    textarea {
      padding: 6px;
      border-radius: 5px;
      border: 1px solid var(--border-main);
      background-color: var(--bg-input);
      color: var(--text-input);
      font-size: 16px;
      width: 100%;
      margin-left: 0;
      min-width: 0;
      box-sizing: border-box;
      margin-top: 6px;
      margin-bottom: 22px;
      line-height: 1.5;
      height: 40px;
      font-family: var(--font-print);
      vertical-align: middle;
    }

    /* Fix for date inputs on mobile devices */
    input[type="date"] {
      -webkit-appearance: none;
      appearance: none;
      background-color: var(--bg-base);
    }

    /* Add this block for consistent focus styles */
    input:focus-visible,
    select:focus-visible,
    textarea:focus-visible {
      border-color: var(--muni-blue);
      /* Change border to your accent color */
      outline: none;
      /* Remove the default browser outline */
    }

    /* Hide arrows from number inputs - for Chrome, Safari, Edge, Opera */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Hide arrows from number inputs - for Firefox */
    input[type=number] {
      -moz-appearance: textfield;
      appearance: textfield;
    }

    textarea.long-text {
      width: 100%;
      overflow-wrap: break-word;
      resize: none;
      box-sizing: border-box;
      margin-top: 6px;
      margin-bottom: 22px;
    }

    /* --- Button Styles --- */

    /* Base button style for consistent sizing and font */
    .btn {
      padding: 12px 22px;
      font-size: 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s, color 0.2s;
      border: 1px solid transparent;
      /* Reserve space for border */
      margin: 0;
      /* Reset margin */
      font-family: var(--font-body);
    }

    /* Primary button style */
    .btn.primary {
      background-color: var(--muni-blue);
      color: var(--text-on-primary);
      border-color: var(--muni-blue);
      font-weight: bold;
    }

    @media (hover: hover) {
      .btn.primary:hover {
        background-color: var(--muni-blue-hover);
        border-color: var(--muni-blue-hover);
      }
    }

    /* Secondary button style */
    .btn.btn-secondary {
      background-color: var(--bg-base);
      color: var(--muni-blue);
      border: 1px solid var(--muni-blue);
      font-weight: 500;
    }

    @media (hover: hover) {
      .btn.btn-secondary:hover:not(:disabled) {
        background-color: var(--muni-blue-light);
        /* Light blue from tip-block */
      }
    }

    .btn.btn-secondary:disabled {
      color: #999;
      border-color: var(--border-main);
      cursor: not-allowed;
    }

    /* Danger button style */
    .btn.btn-danger {
      background-color: var(--bg-base);
      color: var(--color-error);
      border: 1px solid var(--color-error);
      font-weight: 500;
    }

    @media (hover: hover) {
      .btn.btn-danger:hover:not(:disabled) {
        background-color: rgba(176, 42, 55, 0.1);
        /* Light red, consistent with other hovers */
      }
    }

    /* Styl pro nenápadné smazání dat */
    .btn-delete-link {
      background: none;
      border: none;
      color: var(--text-secondary);
      text-decoration: underline;
      cursor: pointer;
      font-size: 12px;
      padding: 0;
      font-family: inherit;
      transition: color 0.2s ease;
    }

    @media (hover: hover) {
      .btn-delete-link:hover {
        color: var(--color-error);
        /* Zčervená až při najetí (vizuální varování) */
      }
    }


    .alert-action-link {
      color: inherit;
      /* Přebírá barvu okolního textu */
      text-decoration: underline;
      cursor: pointer;
      font-weight: inherit;
      /* Vypadá jako běžný text */
      transition: color 0.2s ease;
    }

    @media (hover: hover) {
      .alert-action-link:hover {
        color: var(--color-error);
        /* Zčervená při najetí (shoda s mazacím odkazem) */
      }
    }

    /* Styl pro dynamické pole (style-soft) */
    .style-soft {
      background: var(--bg-base);
      border: 1px solid var(--border-main);
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      padding: 0 !important;
    }

    .style-soft-header {
      padding: 15px 20px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-light);
    }

    .style-soft-header legend {
      font-weight: 700;
      color: var(--muni-blue);
      font-size: 16px;
      margin: 0 !important;
      border-bottom: none !important;
      padding: 0;
    }

    .style-soft-body {
      padding: 15px 20px 20px;
    }

    /* Inputy v tomto stylu */

    /* UPRAVENÉ TLAČÍTKO ODEBRAT */
    .btn-remove-3 {
      background: none;
      border: 1px solid transparent;
      /* Rezerva pro rámeček při hoveru */
      color: var(--text-muted);
      font-size: 14px;
      /* Menší písmo pro text */
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      /* Zarovnání ikony a textu */
      padding: 6px 12px;
      border-radius: 4px;
      transition: all 0.2s;
      font-family: var(--font-body);
    }

    @media (hover: hover) {
      .btn-remove-3:hover {
        color: #c62828;
        /* Červená */
        background-color: var(--bg-error-hover);
        /* Jemně červené pozadí */
        border-color: var(--border-error-hover);
      }
    }

    .preview-mode-active .btn-add-item,
    .preview-mode-active .btn-remove-3 {
      display: none !important;
    }

    /* Flex container for save buttons */
    .save-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      /* Align items vertically */
    }

    /* Smooth transitions for conditional blocks */
    .qa-block {
      transition: opacity 0.4s ease, max-height 0.4s ease, margin 0.4s ease, padding 0.4s ease;
      overflow: hidden;
    }

    /* Robust alignment for validation dot and questions */
    .qa-block>label>span {
      display: flex;
      align-items: flex-start;
      gap: 0px;
      /* Dot has margin-right, but we can rely on flex gap if we wanted. keeping 0 for now to respect dot's margin-right or remove it? Dot has margin-right: 9px. */
    }

    .qa-block.hidden {
      opacity: 0;
      max-height: 0;
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
    }

    .qa-block.hidden.is-visible {
      opacity: 1;
      max-height: none;
      /* Allow content to expand to its natural height. */
      margin-bottom: 22px !important;
      /* Restore original spacing */
    }

    /* Kompenzace pro qa-group, aby se šipka tip-blocku neořízla, ale nevznikla velká mezera */
    .qa-group.hidden.is-visible {
      margin-top: -12px !important;
      padding-top: 12px !important;
    }


    /* Unified select-group alignment */
    .select-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      width: 100%;
      margin-top: 6px;
      margin-bottom: 22px;
      border: 1px solid var(--border-main);
      border-radius: 8px;
      padding: 8px;
      background: var(--bg-base);
      align-items: center;
      justify-content: flex-start;
      box-sizing: border-box;
    }

    .select-group label {
      display: flex;
      align-items: center;
      gap: 6px;
      /* spacing between input and text */
      font-weight: 400;
      margin: 0;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.15s ease, color 0.15s ease;
      user-select: none;
      min-height: 32px;
    }

    .select-group input[type="radio"],
    .select-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      /* remove margin-right */
      accent-color: var(--muni-blue);
    }

    .select-group label span {
      display: inline-block;
      padding: 2px 4px;
      border-radius: 4px;
      line-height: 1.2;
      height: auto;
    }

    @media (hover: hover) {
      html:not(.preview-mode-active) .select-group label:hover span {
        background-color: var(--bg-select-hover);
      }
    }

    html:not(.preview-mode-active) .select-group input[type="radio"]:checked+span,
    html:not(.preview-mode-active) .select-group input[type="checkbox"]:checked+span {
      background-color: var(--bg-select-checked);
      color: var(--muni-blue);
    }

    .select-group input[type="radio"]:focus-visible,
    .select-group input[type="checkbox"]:focus-visible {
      outline: 2px solid rgba(0, 0, 220, 0.2);
      outline-offset: 2px;
    }


    /* --- Custom styling for "Bez odpovědi" --- */

    /* 1. Default state: Grey text for "Bez odpovědi" */
    .select-group input[value="Bez odpovědi"]+span {
      color: var(--border-neutral);
      /* A neutral grey */
      transition: background-color 0.15s ease, color 0.15s ease;
      /* Smooth transition */
    }

    /* 2. Hover state: Highlight with a light red background */
    @media (hover: hover) {
      html:not(.preview-mode-active) .select-group label:has(input[value="Bez odpovědi"]):hover span {
        background-color: rgba(176, 42, 55, 0.1);
        /* Light red background */
      }
    }

    /* 3. Selected state: Red text and light red background */
    html:not(.preview-mode-active) .select-group input[value="Bez odpovědi"]:checked+span {
      color: var(--color-error);
      /* Red text */
      background-color: rgba(176, 42, 55, 0.1);
      /* Light red background */
    }


    /* Tip / note block */
    .tip-block {
      background-color: var(--muni-blue-light);
      /* light blue tone matching your accent */
      border-bottom: 3px solid var(--muni-blue-border);
      border-radius: 8px;
      padding: 14px 18px;
      /* Keep padding consistent */
      margin: 10px 0 20px;
      font-size: 15px;
      font-style: italic;
      line-height: 1.6;
      color: var(--text-dark);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      /* Needed to position the arrow */
    }

    /* Arrow pointing DOWN (for tip blocks ABOVE a question) */
    .tip-block::after {
      content: '';
      position: absolute;
      bottom: -10px;
      /* Position the arrow just below the block */
      left: 30px;
      /* Indent the arrow slightly */
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 10px solid var(--muni-blue-border);
      /* Arrow color matches the block */
    }

    /* New modifier class for a tip block placed UNDER a question */
    .tip-block.tip-block-under {
      margin-top: 0px;
      /* Reset na 0px, ořezání šipky řešíme posunem rodiče (.qa-group) */
      margin-bottom: 30px;
      /* Removes bottom margin */
      border-bottom: 0;
      border-top: 3px solid var(--muni-blue-border);
      /* Change border to top */
    }

    /* Arrow pointing UP (for tip blocks UNDER a question) */
    .tip-block.tip-block-under::after {
      bottom: auto;
      /* Unset the 'bottom' property from the default arrow */
      top: -10px;
      /* Position the arrow just above the block */
      border-top: none;
      /* Remove the downward-pointing arrow */
      border-bottom: 10px solid var(--muni-blue-border);
      /* Create an upward-pointing arrow */
    }

    .tip-block::before {
      content: "Proč se ptáme?";
      font-weight: 400;
      font-style: normal;
      color: var(--muni-blue);
      display: block;
      margin-bottom: 6px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%230000dc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpath d='M12 16v-4'/%3E%3Cpath d='M12 8h.01'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: left center;
      background-size: 16px 16px;
      padding-left: 20px;
    }

    [data-theme="dark"] .tip-block::before {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364b5f6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpath d='M12 16v-4'/%3E%3Cpath d='M12 8h.01'/%3E%3C/svg%3E");
    }

    /* Instruction block style */
    .instruction-block {
      background-color: var(--bg-instruction);
      border: 1px solid var(--border-main);
      border-left: 3px solid var(--border-neutral);
      /* Neutral grey border */
      border-radius: 8px;
      padding: 14px 18px;
      margin: 20px 0 30px 0;
      font-size: 15px;
      line-height: 1.6;
      color: var(--text-dark);
    }

    .instruction-label {
      font-weight: 500;
      color: var(--text-main);
      display: block;
      margin-bottom: 2px;
    }

    .instruction-block::before {
      content: "Instrukce k vyplňování";
      font-weight: bold;
      font-size: 16px;
      color: var(--text-dark);
      display: block;
      margin-bottom: 8px;
    }

    .instruction-block.sharing-options::before {
      content: "Možnosti uložení a sdílení";
      font-weight: bold;
      color: var(--text-dark);
    }

    .instruction-block ul {
      padding-left: 25px;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .manual-alert {
      background-color: var(--color-warning-bg);
      border: 1px solid var(--color-warning-accent);
      border-left: 4px solid var(--color-warning-accent);
      border-radius: 8px;
      padding: 12px 16px;
      margin: 15px 0;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-dark);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .manual-alert strong {
      color: var(--color-warning);
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }



    .manual-tooltip {
      background-color: var(--muni-blue-light);
      border: 1px solid var(--muni-blue);
      border-left: 4px solid var(--muni-blue);
      border-radius: 8px;
      padding: 12px 16px;
      margin: 15px 0;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-dark);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .manual-tooltip strong {
      color: var(--muni-blue);
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .page-footer {
      width: 100%;
      text-align: center;
      font-size: 10pt;
      color: var(--text-muted);
      font-family: var(--font-print);
      border-top: 1px solid var(--border-main);
      padding: 10px 0;
      margin-top: 40px;
      position: relative;
    }

    /* --- Preview Floating Controls --- */
    .preview-controls {
      display: none;
      /* Hidden by default */
    }

    .preview-mode-active .preview-controls {
      display: flex;
      gap: 15px;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 25px;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      border: 1px solid #ddd;
      border-bottom: none;
    }

    /* --- Print Text Replacement (Shadow DIV) --- */
    .print-text-replacement {
      display: none;
      /* Normálně neviditelné */
      white-space: pre-wrap;
      /* Zachová odřádkování */
      font-family: var(--font-print);
      font-size: 12pt;
      color: #444;
      /* Shoda s barvou inputů při tisku */
      line-height: 1.5;
      margin-bottom: 22px;
      width: 100%;
      overflow-wrap: break-word;
      min-height: 1.5em;
      /* Zajistí alespoň jeden řádek místa */
      padding: 6px;
      /* Odsazení textu stejně jako u inputů */
      box-sizing: border-box;
      margin-top: 6px;
    }


    /* --- A4 Preview Layout --- */
    @media screen {
      .preview-mode-active {
        background-color: var(--bg-grey);
        /* Grey backdrop */
      }

      .preview-mode-active body {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0;
      }

      .preview-mode-active main {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }

      /* Scale down the A4 preview on smaller screens */
      @media (max-width: 230mm) {
        .preview-mode-active form {
          /* Calculate the scale factor to fit the viewport width */
          transform: scale(calc(100vw / 230mm));
          transform-origin: top center;
          /* Adjust margin to account for scaling */
          margin-top: calc(20px * (230mm / 100vw));
          margin-bottom: calc(20px * (230mm / 100vw));
        }
      }
    }

    .print-preview.preview-mode-active body,
    .print-preview body {
      background-color: var(--bg-grey);
    }


    .print-preview fieldset>label,
    .print-preview fieldset>input,
    .print-preview fieldset>select,
    .print-preview fieldset>textarea,
    .print-preview fieldset>.select-group,
    .print-preview fieldset>.qa-block {
      page-break-inside: avoid !important;
    }

    .print-preview #additional_carers_container fieldset,
    .print-preview #siblings_container fieldset {
      border: none !important;
      margin: 0 0 10mm 0 !important;
      padding: 0 !important;
    }

    .print-preview #additional_carers_container legend,
    .print-preview #siblings_container legend {
      font-size: 13pt !important;
      color: #000 !important;
      font-weight: bold !important;
      margin-left: 0 !important;
      margin-bottom: 4mm !important;
    }

    .print-preview #additional_carers_container .qa-block,
    .print-preview #siblings_container .qa-block {
      margin-left: 8mm !important;
    }

    .print-preview #additional_carers_container span,
    .print-preview #siblings_container span {
      margin-left: 0 !important;
      text-indent: 0 !important;
    }

    .print-preview h1 {
      font-weight: bold;
      font-size: 20pt;
      color: var(--muni-blue);
      margin-bottom: 20px;
      font-family: var(--font-print);
    }

    .print-preview .print-only-header {
      display: block;
    }

    .print-preview .tip-block,
    .print-preview .instruction-block {
      display: none;
    }

    .preview-mode-active form {
      width: 230mm;
      min-height: 297mm;
      margin: 20px 0;
      /* Add some vertical margin for spacing from screen edges */
      padding: 20mm;
      background-color: var(--bg-base);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      border-radius: 0;
      box-sizing: border-box;
      border: none;
    }

    .print-preview form {
      font-family: var(--font-print);
    }

    .print-preview .qa-block {
      display: block;
      page-break-inside: auto !important;
      /* Povolí roztržení bloku vejpůl */
    }

    .print-preview fieldset {
      background: none;
      border: none !important;
      padding: 0 !important;
      margin-bottom: 25px !important;
      font-family: var(--font-print);
    }

    .preview-mode-active fieldset {
      border-radius: 0;
    }

    .print-preview legend {
      color: var(--muni-blue);
      font-size: 14pt;
      font-weight: normal;
      border-bottom: none;
      margin-left: 0 !important;
      padding: 0 !important;
      margin-bottom: 25px !important;
      text-align: left !important;
      font-family: var(--font-print);
    }

    .print-preview label {
      display: block !important;
      justify-content: flex-start;
      margin-bottom: 6px !important;
      page-break-inside: avoid !important;
      font-weight: normal;
      color: black;
      font-family: var(--font-print);
    }

    .print-preview label span {
      display: block;
      margin-bottom: 4px;
      font-weight: normal;
      color: black;
      font-family: var(--font-print);
    }

    .print-preview input,
    .print-preview select,
    .print-preview textarea {
      display: block !important;
      border: none;
      background: none;
      width: 100% !important;
      font-weight: normal;
      margin-left: 0 !important;
      color: #444;
      font-family: var(--font-print);
      font-size: 12pt !important;
      page-break-inside: auto !important;
      margin-bottom: 22px !important;
    }

    .print-preview textarea {
      display: none !important;
    }

    .print-preview .print-text-replacement {
      display: block !important;
    }

    /* Make inputs non-editable in preview */
    .print-preview.preview-mode-active input,
    .print-preview.preview-mode-active select,
    .print-preview.preview-mode-active textarea {
      pointer-events: none;
      caret-color: transparent;
    }

    .print-preview .qa-block>label {
      page-break-after: avoid !important;
    }

    .print-preview select {
      -webkit-appearance: none !important;
      -moz-appearance: none !important;
      appearance: none !important;
      pointer-events: none;
    }

    .print-preview select::-ms-expand {
      display: none !important;
    }

    .print-preview textarea::-webkit-scrollbar {
      display: none !important;
    }

    .print-preview .select-group {
      display: flex !important;
      flex-wrap: wrap !important;
      gap: 16px !important;
      margin-top: 0 !important;
      margin-bottom: 22px !important;
      padding: 0 0 0 6px !important;
      background: none !important;
      border: none !important;
      page-break-inside: avoid !important;
      pointer-events: none;
      /* Disable interaction on the whole group */
    }

    .print-preview .select-group label {
      display: flex !important;
      align-items: center !important;
      gap: 6px !important;
      font-weight: normal !important;
      font-size: 12pt !important;
      color: #444 !important;
      padding: 0 !important;
      margin: 0 !important;
      background: none !important;
      border: none !important;
      cursor: default !important;
    }

    .print-preview .select-group input[type="radio"],
    .print-preview .select-group input[type="checkbox"] {
      width: 14px !important;
      height: 14px !important;
      margin: 0 !important;
      accent-color: #444 !important;
    }

    .print-preview .select-group label span {
      display: inline-block !important;
      line-height: 1.2 !important;
      color: #444 !important;
      font-weight: normal !important;
    }

    .print-preview .select-group input[type="radio"]:checked+span,
    .print-preview .select-group input[type="checkbox"]:checked+span {
      font-weight: bold !important;
    }

    .print-preview #preview-button,
    .print-preview .save-buttons,
    .print-preview #json-file-input {
      display: none !important;
    }

    .print-preview .qa-block.hidden:not(.is-visible) {
      display: none !important;
    }

    .print-preview .unanswered-mark {
      display: inline !important;
      font-weight: bold;
      color: var(--color-error);
      margin-right: 6px;
    }

    .print-preview .unanswered-dot {
      display: none !important;
    }

    .print-preview .page-footer {
      display: none;
    }

    .print-preview .survey-utility-header {
      display: none !important;
    }

    .print-preview .header-wide {
      display: none;
    }



    /* Explicit override for active preview mode to ensure soft styles are removed */

    .print-preview .style-soft {
      border: none !important;
      box-shadow: none !important;
      background: none !important;
      border-radius: 0 !important;
      margin: 0 0 20px 0 !important;
      padding: 0 !important;
    }

    .print-preview .style-soft .style-soft-header {
      border: none !important;
      padding: 0 !important;
      margin-bottom: 10px !important;
    }

    .print-preview .style-soft .style-soft-header legend {
      color: black !important;
      font-weight: bold !important;
      font-size: 12pt !important;
      margin: 0 !important;
    }

    .print-preview .style-soft .style-soft-body {
      padding: 0 0 0 20px !important;
    }


    /* --- Print Styles --- */

    @media print {

      fieldset>label,
      fieldset>input,
      fieldset>select,
      fieldset>textarea,
      fieldset>.select-group,
      fieldset>.qa-block {
        page-break-inside: avoid !important;
      }

      @page {
        size: A4;
        margin: 20mm;
        margin-bottom: 25mm;
      }

      html {
        font-size: 12pt;
        /* Set a base font size for print to prevent scaling issues */
      }


      form {
        box-shadow: none !important;
        padding: 0 !important;
      }



      /* --- .style-soft overrides for print --- */
      .style-soft {
        border: none !important;
        box-shadow: none !important;
        background: none !important;
        border-radius: 0 !important;
        margin: 0 0 20px 0 !important;
        padding: 0 !important;
      }

      .style-soft .style-soft-header {
        border: none !important;
        padding: 0 !important;
        margin-bottom: 10px !important;
      }

      .style-soft .style-soft-header legend {
        color: black !important;
        font-weight: bold !important;
        font-size: 12pt !important;
        margin: 0 !important;
      }

      .style-soft .style-soft-body {
        padding: 0 0 0 20px !important;
      }



      /* Keep dynamic fieldsets (siblings, carers) visually grouped */
      #additional_carers_container fieldset,
      #siblings_container fieldset {
        border: none !important;
        margin: 0 0 10mm 0 !important;
        /* Remove indent, rely on qa-block margin */
        padding: 0 !important;
      }

      #additional_carers_container legend,
      #siblings_container legend {
        font-size: 13pt !important;
        color: #000 !important;
        font-weight: bold !important;
        margin-left: 0 !important;
        margin-bottom: 4mm !important;
      }

      /* Consistent alignment inside generated carers/siblings */
      #additional_carers_container .qa-block,
      #siblings_container .qa-block {
        margin-left: 8mm !important;
        /* Indent the questions for hierarchy */
      }

      #additional_carers_container span,
      #siblings_container span {
        margin-left: 0 !important;
        text-indent: 0 !important;
      }

      body {
        background-color: var(--bg-base);
        padding: 0;
        margin: 0;
        font-size: 12pt;
        font-family: var(--font-print);
        color: black;
      }

      h1 {
        font-weight: bold;
        font-size: 20pt;
        color: var(--muni-blue);
        margin-bottom: 20px;
        font-family: var(--font-print);
      }

      .print-only-header {
        display: block !important;
      }

      .tip-block,
      .instruction-block {
        display: none;
      }

      form {
        box-shadow: none;
        background: none;
        padding: 0;
        max-width: 100%;
        font-family: var(--font-print);
      }

      fieldset {
        background: none;
        border: none !important;
        padding: 0 !important;
        margin-bottom: 25px !important;
        font-family: var(--font-print);
      }

      legend {
        color: var(--muni-blue);
        font-size: 14pt;
        font-weight: normal;
        border-bottom: none;
        margin-left: 0 !important;
        padding: 0 !important;
        margin-bottom: 25px !important;
        text-align: left !important;
        font-family: var(--font-print);
      }

      label {
        display: block !important;
        justify-content: flex-start;
        margin-bottom: 6px !important;
        page-break-inside: avoid !important;
        font-weight: normal;
        color: black;
        font-family: var(--font-print);
      }

      label span {
        display: block;
        margin-bottom: 4px;
        font-weight: normal;
        color: black;
        font-family: var(--font-print);
      }

      input,
      select,
      textarea {
        display: block !important;
        border: none;
        background: none;
        width: 100% !important;
        font-weight: normal;
        margin-left: 0 !important;
        color: #444;
        font-family: var(--font-print);
        font-size: 12pt !important;
        page-break-inside: auto !important;
        /* Allow breaking inside long textareas */
        margin-bottom: 22px !important;
        /* Keep consistent spacing */
      }

      /* Hide textareas and show replacement divs for better pagination */
      textarea {
        display: none !important;
      }

      .print-text-replacement {
        display: block !important;
      }

      textarea {
        resize: none;
        white-space: pre-wrap;
        overflow: visible !important;
      }

      /* Ensure the label and the start of the textarea stay together */
      .qa-block>label {
        page-break-after: avoid !important;
      }

      select {
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        appearance: none !important;
        pointer-events: none;
      }

      select::-ms-expand {
        display: none !important;
      }

      textarea::-webkit-scrollbar {
        display: none !important;
      }

      .select-group {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 16px !important;
        margin-top: 0 !important;
        margin-bottom: 22px !important;
        padding: 0 0 0 6px !important;
        background: none !important;
        border: none !important;
        page-break-inside: avoid !important;
      }

      .select-group label {
        display: flex !important;
        align-items: center !important;
        gap: 6px !important;
        font-weight: normal !important;
        font-size: 12pt !important;
        color: #444 !important;
        padding: 0 !important;
        margin: 0 !important;
        background: none !important;
        border: none !important;
        cursor: default !important;
      }

      .select-group input[type="radio"],
      .select-group input[type="checkbox"] {
        width: 14px !important;
        height: 14px !important;
        margin: 0 !important;
        accent-color: #444 !important;
      }

      .select-group label span {
        display: inline-block !important;
        line-height: 1.2 !important;
        color: #444 !important;
        font-weight: normal !important;
      }

      .select-group input[type="radio"]:checked+span,
      .select-group input[type="checkbox"]:checked+span {
        font-weight: bold !important;
      }

      .qa-block {
        display: block;
        page-break-inside: auto !important;
        /* Allow breaking inside long text blocks */
      }

      /* Hide buttons and other non-printable elements */
      button,
      #json-file-input {
        display: none !important;
      }

      /* Only hide conditional blocks that are NOT visible on screen */
      .qa-block.hidden:not(.is-visible) {
        display: none !important;
      }

      /* Style for the unanswered question marker */
      .unanswered-mark {
        display: inline !important;
        /* Show the asterisk */
        font-weight: bold;
        color: var(--color-error);
        /* Make it red to stand out */
        margin-right: 6px;
      }

      /* Hide the live validation dot on print */
      .unanswered-dot {
        display: none !important;
      }

      .preview-controls {
        display: none !important;
        /* Hide floating controls in the actual print output */
      }


      .page-footer {
        display: none;
      }

      .header-wide {
        display: none;
      }
    }

    /* --- Unanswered Question Dot (Live) --- */
    .unanswered-dot {
      display: inline-block;
      width: 9px;
      height: 9px;
      background-color: var(--muni-blue);
      /* Plná modrá pro nezodpovězené */
      border: 1px solid var(--muni-blue);
      border-radius: 50%;
      margin-right: 9px;
      margin-top: 5px;
      /* Flexbox alignment fix */
      flex-shrink: 0;
      /* Remove old positioning hacks */
      box-sizing: border-box;
      transition: background-color 0.4s ease, border-color 0.4s ease;
      opacity: 1;
    }

    /* Stav po zodpovězení: Tečka se "vyprázdní" */
    .unanswered-dot.answered {
      background-color: transparent;
      /* Zmizí barva uvnitř */
      border-color: var(--muni-blue);
      /* Zůstane jen modrý obrys */
      opacity: 0.4;
      /* Mírné zprůhlednění, aby hotové otázky vizuálně ustoupily */
    }

    /* --- Mobile-specific adjustments --- */
    @media (max-width: 600px) {
      body:not(.preview-mode-active) {
        padding: 5px;
        /* Reduce body padding on small screens */
      }

      form:not(.preview-mode-active form) {
        padding: 7px;
        /* Reduce form padding on small screens */
      }
    }


    /* --- Header bar --- */
    .survey-utility-header {
      width: 100%;
      background-color: var(--bg-base);
      border-bottom: 1px solid var(--bg-grey);
      padding: 8px 0;
      font-size: 13px;
      font-family: var(--font-body);
      color: var(--text-muted);
    }

    .header-inner {
      max-width: 900px;
      /* Zarovnáno s šířkou vašeho formuláře */
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .header-link,
    .version-link {
      text-decoration: none;
      color: var(--text-muted);
      transition: color 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .header-left {
      color: var(--muni-blue);
      font-family: var(--font-body);
      font-size: 16px;
    }

    .header-right {
      display: flex;
      gap: 25px;
      align-self: flex-end;
    }

    @media (hover: hover) {
      .header-link:hover {
        color: var(--muni-blue);
      }
    }


    .version-link {
      font-family: var(--font-mono);
      background: var(--bg-body);
      padding: 2px 8px;
      border-radius: 4px;
    }

    @media (hover: hover) {
      .version-link:hover {
        background: #0000dc10;
        color: var(--muni-blue);
      }
    }

    .changelog-text {
      font-size: 11px;
      opacity: 0.7;
    }

    .icon {
      font-size: 14px;
    }

    /* Skrytí v tiskovém náhledu a při tisku */
    @media print {
      .survey-utility-header {
        display: none !important;
      }
    }

    /* Mobilní úprava */
    @media (max-width: 600px) {
      .header-inner {
        /* Zachovat řádek pro úsporu místa díky menu v hlavičce */
        flex-direction: row;
        justify-content: space-between;
        gap: 10px;
        text-align: left;
      }

      .header-right {
        /* Pro správné pozicování dropdownu */
        position: relative;
        align-self: center;
        /* Center the menu vertically */
      }

      .header-left svg {
        height: 50px !important;
        width: auto;
      }
    }

    /* Print/Preview only */
    .preview-mode-active .print-export-date {
      display: block !important;
    }

    @media print {
      .print-export-date {
        display: block !important;
      }
    }

    /* --- Header Menu Styles --- */
    .menu-toggle-btn {
      display: none;
      /* Hidden on desktop */
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      flex-direction: column;
      gap: 3px;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      margin-left: 10px;
      color: var(--text-muted);
    }

    .menu-toggle-btn:hover {
      background-color: var(--border-light);
    }

    .menu-toggle-dot {
      width: 4px;
      height: 4px;
      background-color: currentColor;
      border-radius: 50%;
    }

    .header-right-links {
      display: flex;
      gap: 25px;
      align-items: center;
    }

    @media (max-width: 600px) {
      .menu-toggle-btn {
        display: flex;
        /* Show on mobile */
      }

      .header-right-links {
        display: none;
        /* Hide default links */
        position: absolute;
        top: 100%;
        right: 0;
        width: 200px;
        background-color: var(--bg-base);
        flex-direction: column;
        gap: 0;
        border: 1px solid var(--bg-grey);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 5px 0;
        z-index: 2000;
        align-items: stretch;
      }

      .header-right-links.is-open {
        display: flex;
      }

      .header-right-links .header-link {
        padding: 12px 20px;
        border-bottom: 1px solid var(--border-light);
        color: var(--text-main);
      }

      .header-right-links .header-link:last-child {
        border-bottom: none;
      }

      .header-right-links .header-link:hover {
        background-color: var(--bg-hover-menu);
        color: var(--muni-blue);
      }
    }

    /* Headline styles */

    :root {
      /* Auto-extracted colors for Dark Mode */
      --bg-body: #f4f6f8;
      --bg-base: #fff;
      --bg-fieldset: #fafafa;
      --text-main: #333;
      --text-dark: #222;
      --text-muted: #666;
      --text-secondary: #535353;
      --border-main: #ccc;
      --border-light: #f0f0f0;
      --border-neutral: #6c757d;
      --muni-blue-hover: #0000aa;
      --muni-blue-border: #B3C7FF;
      --bg-instruction: #f8f9fa;
      --bg-error-hover: #fff5f5;
      --border-error-hover: #ffd6d6;
      --bg-grey: #e0e0e0;
      --muni-blue: #0000dc;
      --logo-color: #0000dc;
      --text-black: #000000;
      --bg-input: #ffffff;
      --text-input: #333333;
      --bg-select-hover: #0000dc08;
      --bg-select-checked: #0000dc10;
      --text-on-primary: white;
      --bg-hover-menu: #f9f9f9;
      --bg-hover-summary: #f4f8ff;

      /* Fonts */
      --font-body: Roboto, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --font-print: "Times New Roman", Times, serif;
      --font-mono: monospace;

      /* Unified Accessible Colors (WCAG AA compliant) */
      --color-success: #1a7a33;
      --bg-success: #e8f5e9;
      --color-error: #c62828;
      --color-warning: #BF360C;
      /* Pro nadpis a ikony */
      --color-warning-text: #4E342E;
      /* Pro hlavní text - High Contrast */
      --color-warning-bg: #FFF9F0;
      /* Pozadí */
      --color-warning-accent: #E65100;
      /* Tlustá čára vlevo */
      --color-warning-border: #FFCC80;
      /* Jemný rámeček kolem */


      --muni-blue-light: #e9f1ff;
      --bg-glass: rgba(255, 255, 255, 0.95);
      --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
      --transition-speed: 0.4s;
    }

    [data-theme="dark"] {
      --bg-body: #121212;
      --bg-base: #1e1e1e;
      --bg-fieldset: #2a2a2a;
      --text-main: #e0e0e0;
      --text-dark: #f5f5f5;
      --text-muted: #aaaaaa;
      --text-secondary: #cccccc;
      --border-main: #444444;
      --border-light: #333333;
      --border-neutral: #555555;
      --muni-blue: #64b5f6;
      --muni-blue-hover: #42a5f5;
      --muni-blue-light: #1a237e;
      --muni-blue-border: #283593;
      --bg-instruction: #222222;
      --bg-error-hover: #4a0000;
      --border-error-hover: #7f0000;
      --bg-grey: #2c2c2c;
      --bg-glass: rgba(30, 30, 30, 0.95);
      --text-black: #ffffff;
      --logo-color: #ffffff;
      --color-warning: #ffb300;
      --color-warning-text: #fff3e0;
      --color-warning-bg: #4e342e;
      --color-warning-accent: #ff8f00;
      --color-warning-border: #ffb300;
      --bg-input: #1E1E1E;
      --text-input: #ffffff;
      --color-success: #81c784;
      --bg-success: #1e3522;
      --bg-select-hover: rgba(100, 181, 246, 0.1);
      --bg-select-checked: rgba(100, 181, 246, 0.2);
      --text-on-primary: #121212;
      --bg-hover-menu: #2c2c2c;
      --bg-hover-summary: rgba(100, 181, 246, 0.1);
    }

    @media print {

      :root,
      [data-theme="dark"] {
        --bg-body: #f4f6f8;
        --bg-base: #fff;
        --bg-fieldset: #fafafa;
        --text-main: #333;
        --text-dark: #222;
        --text-muted: #666;
        --text-secondary: #535353;
        --border-main: #ccc;
        --border-light: #f0f0f0;
        --border-neutral: #6c757d;
        --muni-blue: #0000dc;
        --muni-blue-hover: #0000aa;
        --muni-blue-light: #e9f1ff;
        --muni-blue-border: #B3C7FF;
        --bg-instruction: #f8f9fa;
        --bg-error-hover: #fff5f5;
        --border-error-hover: #ffd6d6;
        --bg-grey: #e0e0e0;
        --bg-glass: rgba(255, 255, 255, 0.95);
        --text-black: #000000;
        --logo-color: #0000dc;
        --color-warning: #BF360C;
        --color-warning-text: #4E342E;
        --color-warning-bg: #FFF9F0;
        --color-warning-accent: #E65100;
        --color-warning-border: #FFCC80;
        --bg-input: #ffffff;
        --text-input: #333333;
        --color-success: #1a7a33;
        --bg-success: #e8f5e9;
        --bg-select-hover: #0000dc08;
        --bg-select-checked: #0000dc10;
        --text-on-primary: white;
        --bg-hover-menu: #f9f9f9;
        --bg-hover-summary: #f4f8ff;
      }
    }

    /* Force preview mode interior to remain light, while allowing the root (background) to stay dark */
    [data-theme="dark"].preview-mode-active body {
      --bg-base: #fff;
      --bg-fieldset: #fafafa;
      --text-main: #333;
      --text-dark: #222;
      --text-muted: #666;
      --text-secondary: #535353;
      --border-main: #ccc;
      --border-light: #f0f0f0;
      --border-neutral: #6c757d;
      --muni-blue: #0000dc;
      --muni-blue-hover: #0000aa;
      --muni-blue-light: #e9f1ff;
      --muni-blue-border: #B3C7FF;
      --bg-instruction: #f8f9fa;
      --bg-error-hover: #fff5f5;
      --border-error-hover: #ffd6d6;
      --bg-glass: rgba(255, 255, 255, 0.95);
      --text-black: #000000;
      --logo-color: #0000dc;
      --color-warning: #BF360C;
      --color-warning-text: #4E342E;
      --color-warning-bg: #FFF9F0;
      --color-warning-accent: #E65100;
      --color-warning-border: #FFCC80;
      --bg-input: #ffffff;
      --text-input: #333333;
      --color-success: #1a7a33;
      --bg-success: #e8f5e9;
      --bg-select-hover: #0000dc08;
      --bg-select-checked: #0000dc10;
      --text-on-primary: white;
      --bg-hover-menu: #f9f9f9;
      --bg-hover-summary: #f4f8ff;
    }

    .header-wide {
      max-width: 1000px;
      margin: 60px auto;
      padding: 0 40px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      /* Pravostranné zarovnání */
      font-family: var(--font-body);
    }

    /* Hlavní titul na jednom řádku */
    .title-single-line {
      white-space: nowrap;
      color: var(--muni-blue);
      font-weight: 900;
      font-size: 32pt;
      line-height: 1;
      margin: 0;
      text-transform: uppercase;
      letter-spacing: -1px;
    }

    /* Podnadpis pod titulem */
    .subtitle-wide {
      color: var(--text-black);
      font-weight: 700;
      font-size: 14pt;
      text-transform: uppercase;
      margin: 10px 0 0 0;
      letter-spacing: 2px;
    }

    /* Grafická lišta s linkou a tečkami */
    .accent-row {
      display: flex;
      align-items: center;
      width: 100%;
      margin-top: 30px;
      justify-content: flex-end;
    }

    .accent-line {
      height: 2.5px;
      background-color: var(--muni-blue);
      flex-grow: 1;
      max-width: 600px;
      margin-right: 20px;
    }

    .dots-set {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .dot {
      border-radius: 50%;
    }

    .dot-full {
      width: 20px;
      height: 20px;
      border: 2px solid var(--muni-blue);
      background-color: var(--muni-blue);
    }

    .dot-outline {
      width: 19px;
      height: 19px;
      border: 3px solid var(--muni-blue);
      background-color: transparent;
    }

    /* Responzivní chování */
    @media (max-width: 850px) {
      .title-single-line {
        font-size: 24pt;
      }

      .accent-line {
        max-width: 300px;
      }
    }

    @media (max-width: 600px) {
      .header-wide {
        align-items: center;
        text-align: center;
      }

      .title-single-line {
        white-space: normal;
        font-size: 20pt;
      }

      .accent-row {
        justify-content: center;
      }

      .accent-line {
        display: none;
      }
    }

    /* Hide the plain header on screen, show only in print/preview */
    .print-only-header {
      display: none;
    }

    .print-export-date {
      display: none;
      font-family: var(--font-print);
      font-size: 11pt;
      color: var(--text-muted);
      margin-top: -15px;
      margin-bottom: 25px;
      font-style: normal;
      text-align: center;
    }


    /* --- Error messages --- */
    /* Kontejner pro bublinu, který zajišťuje plynulé vysunutí */
    .error-bubble {
      background-color: var(--bg-error-hover);
      /* Velmi jemná červená */
      border-left: 4px solid var(--color-error);
      border-radius: 4px;
      padding: 0 12px;
      /* Vertikální padding animujeme přes max-height */
      margin-top: -15px;
      /* Kompenzace marginu pod inputem */
      margin-bottom: 20px;
      color: var(--color-error);
      font-size: 13px;
      font-weight: 500;
      line-height: 1.4;

      /* Animační vlastnosti */
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: all 0.3s ease-in-out;
      box-shadow: 0 2px 5px rgba(176, 42, 55, 0.1);
    }

    /* Třída pro aktivní zobrazení bubliny */
    .error-bubble.is-visible {
      max-height: 100px;
      /* Dostatečná rezerva pro víceřádkový text */
      opacity: 1;
      padding: 10px 12px;
      margin-top: -10px;
      /* Mezera pod inputem v aktivním stavu */
    }

    /* Červené ohraničení pro samotný input */
    input.input-error {
      border-color: var(--color-error) !important;
    }

    /* Vypnuto pro tisk a preview */
    @media print {
      .error-bubble {
        display: none !important;
      }
    }

    .print-preview .error-bubble {
      display: none;
    }

    /* Placeholdery */
    /* 1. Pro fyzický tisk (vyvolaný přes Ctrl+P) */
    @media print {

      input::placeholder,
      textarea::placeholder {
        color: transparent !important;
        -webkit-text-fill-color: transparent !important;
        opacity: 0 !important;
      }
    }

    /* 2. Pro náhled na obrazovce (přidaná třída do HTML/Body) */
    .preview-mode-active input::placeholder,
    .preview-mode-active textarea::placeholder {
      color: transparent !important;
      -webkit-text-fill-color: transparent !important;
      opacity: 0 !important;
    }

    /* --- SMART NAVIGATION CSS --- */
    #smart-nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--bg-glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 10000;
      transition: all var(--transition-speed) cubic-bezier(0.16, 1, 0.3, 1);
      overflow: hidden;
      height: 60px;

      /* --- Hidden State --- */
      opacity: 0;
      transform: translateY(-100%);
      pointer-events: none;
    }

    #smart-nav.is-visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    #smart-nav.is-expanded {
      height: auto;
      max-height: 80vh;
      border-bottom-left-radius: 16px;
      border-bottom-right-radius: 16px;
      overflow-y: auto;
    }

    .nav-header {
      height: 60px;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
    }

    @media (hover: hover) {
      .nav-header:hover {
        background-color: var(--muni-blue-light);
      }
    }

    .nav-progress-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin-right: 20px;
    }

    .nav-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
    }

    .nav-label strong {
      color: var(--muni-blue);
    }

    .progress-track-container {
      position: relative;
      height: 6px;
      width: 100%;
    }

    .segments-track {
      display: flex;
      gap: 4px;
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      transition: opacity 0.3s ease;
      opacity: 1;
    }

    .segment {
      flex: 1;
      background-color: var(--bg-grey);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }

    .global-track {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg-grey);
      border-radius: 3px;
      overflow: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .global-fill {
      height: 100%;
      width: 0%;
      background-color: var(--muni-blue);
      transition: width 0.3s ease;
    }

    .global-fill.completed {
      background-color: var(--color-success);
    }

    #smart-nav.is-expanded .segments-track {
      opacity: 0;
      pointer-events: none;
    }

    #smart-nav.is-expanded .global-track {
      opacity: 1;
    }

    .segment-fill {
      height: 100%;
      width: 0%;
      background-color: var(--muni-blue);
      transition: width 0.3s ease;
    }

    .segment.completed .segment-fill {
      background-color: var(--color-success);
    }

    .nav-toggle-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muni-blue);
      font-weight: 600;
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 20px;
      transition: all 0.2s;
    }

    .nav-toggle-icon {
      transition: transform var(--transition-speed);
      font-size: 13px;
    }

    #smart-nav.is-expanded .nav-toggle-icon {
      transform: rotate(180deg);
    }

    .nav-body {
      padding: 10px 20px 20px 20px;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: none;
    }

    #smart-nav.is-expanded .nav-body {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .nav-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 10px;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      padding: 12px 15px;
      background-color: var(--bg-base);
      border: 1px solid var(--border-main);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      box-sizing: border-box;
      position: relative;
      overflow: hidden;
    }

    @media (hover: hover) {
      .nav-item:hover {
        border-color: var(--muni-blue);
        box-shadow: 0 2px 8px rgba(0, 0, 220, 0.1);
        transform: translateY(-1px);
      }

      .nav-item.active:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 220, 0.1);
      }
    }

    .nav-item.active {
      border-color: var(--muni-blue);
    }

    .nav-item.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      width: 4px;
      /* Thickness of the highlight */
      background-color: var(--muni-blue);
    }

    .nav-item-row {
      display: flex;
      align-items: center;
      width: 100%;
      margin-bottom: 8px;
    }

    .nav-item-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .status-done {
      background: var(--bg-success);
      color: var(--color-success);
    }

    .status-todo {
      background: var(--border-light);
      color: var(--text-muted);
    }

    .status-active {
      background: var(--muni-blue-light);
      color: var(--muni-blue);
      font-weight: bold;
    }

    .nav-item-text {
      flex: 1;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-main);
    }

    .nav-item-meta {
      font-size: 11px;
      color: var(--text-muted);
      background: var(--bg-fieldset);
      padding: 2px 8px;
      border-radius: 10px;
    }

    .nav-item-meta.missing {
      color: var(--muni-blue);
      background: var(--muni-blue-light);
      font-weight: 600;
    }

    .nav-item-progress-track {
      height: 4px;
      width: 100%;
      background-color: var(--border-light);
      border-radius: 2px;
      overflow: hidden;
    }

    .nav-item-progress-fill {
      height: 100%;
      width: 0%;
      background-color: var(--muni-blue);
      transition: width 0.3s ease;
    }

    .nav-item-progress-fill.completed {
      background-color: var(--color-success);
    }

    /* Skrytí progress baru při tisku */
    @media print {
      #smart-nav {
        display: none !important;
      }
    }

    .preview-mode-active #smart-nav {
      display: none !important;
    }



    /* --- SOUHRNNÝ PANEL (SUMMARY) --- */
    .summary-container {
      background-color: var(--bg-base);
      border: 1px solid var(--border-main);
      border-left: 3px solid var(--muni-blue);
      /* MUNI Modrá */
      border-radius: 8px;
      margin: 40px 0 30px 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      font-family: var(--font-body);
    }

    .summary-header {
      padding: 15px 20px;
      background-color: var(--bg-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
      flex-wrap: wrap;
      gap: 15px;
    }

    @media (hover: hover) {
      .summary-header:hover {
        background-color: var(--muni-blue-light);
      }
    }

    .summary-stats {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .stat-item {
      text-align: center;
      min-width: 80px;
    }

    .stat-value {
      display: block;
      font-weight: 800;
      font-size: 20px;
      line-height: 1.2;
    }

    .stat-label {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 0.5px;
      font-weight: 600;
      white-space: nowrap;
    }

    /* Barvy statistik */
    .stat-answered .stat-value {
      color: var(--color-success);
    }

    /* Zelená */
    .stat-empty .stat-value {
      color: var(--color-error);
    }

    /* Červená */
    .stat-refused .stat-value {
      color: var(--color-warning-accent);
    }

    /* Oranžová/Hnědá */

    .toggle-icon {
      font-size: 13px;
      color: var(--muni-blue);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-left: auto;
    }

    #summary-arrow {
      transition: transform var(--transition-speed);
    }

    #summary-arrow.is-rotated {
      transform: rotate(180deg);
    }

    /* Detaily (rozbalovací část) */
    .summary-details {
      max-height: 0;
      overflow: hidden;
      /* Zrušen scrollbar pro plynulost */
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      background-color: var(--bg-base);
      opacity: 0.5;
    }

    .summary-details.is-open {
      max-height: 3000px;
      /* Dostatečná výška pro obsah */
      border-top: 1px solid #eee;
      opacity: 1;
      transition: max-height 0.6s ease-in-out, opacity 0.4s ease-in;
    }

    .summary-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .summary-list-item {
      padding: 12px 20px;
      border-bottom: 1px solid var(--border-light);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      transition: background-color 0.2s;
    }

    @media (hover: hover) {
      .summary-list-item:hover {
        background-color: var(--bg-hover-summary);
      }
    }

    .item-info {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 200px;
    }

    .item-section {
      font-size: 10px;
      text-transform: uppercase;
      color: #999;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .item-question {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-main);
    }

    .item-status {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 600;
      text-transform: uppercase;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .item-status.empty {
      background: #ffebeb;
      color: var(--color-error);
      border: 1px solid #fadbd8;
    }

    .item-status.refused {
      background: var(--color-warning-bg);
      color: var(--color-warning);
      border: 1px solid var(--color-warning-border);
    }


    /* Skrytí při tisku */
    @media print {
      .summary-container {
        display: none !important;
      }
    }

    .preview-mode-active #summary-container {
      display: none !important;
    }

    /* Mobilní úprava */
    @media (max-width: 600px) {
      .summary-stats {
        gap: 15px;
        justify-content: space-between;
        width: 100%;
      }

      .stat-item {
        min-width: auto;
        flex: 1;
      }

      .stat-value {
        font-size: 18px;
      }

      .stat-label {
        font-size: 10px;
      }

      .toggle-icon {
        width: 100%;
        justify-content: center;
        margin-top: 5px;
        padding-top: 5px;
        border-top: 1px solid #eee;
      }
    }




    /* --- PULZNÍ VČELKA --- */

    /* Odstranění ořezu u bloku i u nadřazeného fieldsetu */
    .qa-block.highlighted-dot,
    .allow-overflow {
      overflow: visible !important;
    }

    .qa-block.highlighted-dot .unanswered-dot {
      background-color: var(--color-warning-accent) !important;
      border-color: var(--color-warning-accent) !important;
      opacity: 1 !important;
      position: relative;
      z-index: 1000;
      /* Vystoupí nad vše ostatní */
      /* Animace přesně podle vašeho návrhu: 2s, jemný puls */
      animation: orange-pulse 3.5s ease-in-out forwards;
    }

    @keyframes orange-pulse {

      /* PRVNÍ PULS */
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(230, 81, 0, 0.7);
      }

      25% {
        transform: scale(1.25);
        box-shadow: 0 0 0 15px rgba(230, 81, 0, 0);
      }

      50% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(230, 81, 0, 0);
      }

      /* Úplný reset stínu */

      /* KRÁTKÁ PAUZA (BEAT) */
      55% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(230, 81, 0, 0.7);
      }

      /* DRUHÝ PULS */
      80% {
        transform: scale(1.25);
        box-shadow: 0 0 0 15px rgba(230, 81, 0, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(230, 81, 0, 0);
      }
    }



    /* --- INTEGROVANÝ SYSTÉM DIALOGŮ --- */
    #custom-confirm {
      border: none;
      border-radius: 10px;
      padding: 0;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
      outline: none;
    }

    #custom-confirm::backdrop {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    /* VARIANTA 3: ČERVENÁ (Kritické smazání) */
    #custom-confirm.type-delete {
      background-color: var(--bg-base);
      /* Bílé pozadí dle přání */
      border-left: 4px solid var(--color-error);
      /* Červený pruh */
    }

    #custom-confirm.type-delete h3 {
      color: var(--color-error);
      /* Červený nadpis */
    }

    /* Varianta ORANŽOVÁ (Smazání / Varování) */
    #custom-confirm.type-warning {
      background-color: var(--bg-base);
      border-left: 4px solid var(--color-warning-accent);
    }

    #custom-confirm.type-warning h3 {
      color: var(--color-warning);
    }

    /* Varianta MODRÁ (Uložení / Info) */
    #custom-confirm.type-success,
    #custom-confirm.type-info {
      background-color: var(--bg-base);
      border-left: 4px solid var(--muni-blue);
    }

    #custom-confirm.type-success h3,
    #custom-confirm.type-info h3 {
      color: var(--muni-blue);
    }

    .dialog-inner {
      padding: 30px;
    }

    .dialog-inner h3 {
      margin: 0 0 10px 0;
      font-size: 20px;
      font-weight: 700;
    }

    .dialog-inner p {
      color: var(--text-main);
      line-height: 1.6;
      margin-bottom: 30px;
      font-size: 15px;
    }

    .dialog-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    #custom-confirm[open] {
      animation: dialog-appear 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes dialog-appear {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>

<body>

  <nav id="smart-nav">
    <div class="nav-header" onclick="toggleSmartNav()">
      <div class="nav-progress-wrapper">
        <div class="nav-label">
          <span>Postup v dotazníku</span>
          <strong id="nav-progress-text">0%</strong>
        </div>
        <div class="progress-track-container">
          <div class="global-track">
            <div class="global-fill" id="nav-global-fill"></div>
          </div>
          <div class="segments-track" id="nav-segments-track"></div>
        </div>
      </div>
      <div class="nav-toggle-btn">
        <span id="nav-toggle-text">Přehled</span>
        <span class="nav-toggle-icon">▼</span>
      </div>
    </div>
    <div class="nav-body">
      <div class="nav-grid" id="nav-grid"></div>
    </div>
  </nav>

  <main>
    <form id="questionnaire">

      <div class="survey-utility-header">
        <div class="header-inner">
          <div class="header-left">
            <a href="https://diagnostikaditete.cz/" target="_blank" class="header-link">
              <svg width="193" height="68" viewBox="0 0 193 68" style="height: 68px; width: auto;">
                <path fill="var(--logo-color)"
                  d="M-0.06,3l0,26.6l4.14,0l0,-26.6zm4.29,0l2.59,26.6l1.4,0l-2.58,-26.6zm6.73,0l-2.58,26.6l1.4,0l2.59,-26.6zm1.56,0l0,26.6l4.18,0l0,-26.6zm15.69,0l0,20.48c0,3.57,3.23,6.35,6.69,6.35c3.46,0,6.69,-2.78,6.69,-6.35l0,-20.48l-4.18,0l0,20.33c0,1.44,-1.29,2.47,-2.51,2.47c-1.22,0,-2.51,-1.03,-2.51,-2.47l0,-20.33zm26.26,0l0,26.6l4.18,0l0,-26.6zm4.33,0l3.95,26.6l1.45,0l-3.95,-26.6zm5.55,0l0,26.6l4.18,0l0,-26.6zm18.05,25.12l0,1.48l11.36,0l0,-1.48l-3.61,0l0,-23.64l3.61,0l0,-1.48l-11.36,0l0,1.48l3.57,0l0,23.64z">
                </path>
                <path fill="var(--logo-color)"
                  d="M2.68,68.1l2.05,0l0,-11.74l10.14,0l0,-1.9l-10.14,0l0,-11.06l10.6,0l0,-1.9l-12.65,0zm32.22,0.23c3.65,0,6.57,-2.59,6.57,-6.35l0,-1.63c0,-4.33,-3.64,-5.82,-6.15,-6.39c-2.32,-0.53,-4.94,-1.4,-4.94,-4.52l0,-1.78c0,-2.47,2.13,-4.41,4.52,-4.41c2.36,0,4.52,1.94,4.52,4.41l0,0.95l2.05,0l0,-0.99c0,-3.65,-2.92,-6.35,-6.57,-6.35c-3.65,0,-6.57,2.7,-6.57,6.35l0,1.82c0,4.45,3.76,5.85,6.08,6.39c2.43,0.53,5.01,1.4,5.01,4.56l0,1.55c0,2.47,-2.13,4.41,-4.48,4.41c-2.4,0,-4.56,-1.94,-4.56,-4.41l0,-0.87l-2.05,0l0,0.91c0,3.76,2.92,6.35,6.57,6.35zm26.6,0c3.65,0,6.57,-2.59,6.57,-6.35l0,-1.63c0,-4.33,-3.64,-5.82,-6.15,-6.39c-2.32,-0.53,-4.94,-1.4,-4.94,-4.52l0,-1.78c0,-2.47,2.13,-4.41,4.52,-4.41c2.36,0,4.52,1.94,4.52,4.41l0,0.95l2.05,0l0,-0.99c0,-3.65,-2.92,-6.35,-6.57,-6.35c-3.65,0,-6.57,2.7,-6.57,6.35l0,1.82c0,4.45,3.76,5.85,6.08,6.39c2.43,0.53,5.01,1.4,5.01,4.56l0,1.55c0,2.47,-2.13,4.41,-4.48,4.41c-2.4,0,-4.56,-1.94,-4.56,-4.41l0,-0.87l-2.05,0l0,0.91c0,3.76,2.92,6.35,6.57,6.35z">
                </path>
                <path fill="var(--logo-color)"
                  d="M111.23,3.01l0,10.68l3.55,0c3.63,0,5.67,-1.92,5.67,-5.34c0,-3.42,-2.04,-5.34,-5.67,-5.34zm2.19,1.89l1.33,0c2.3,0,3.42,1.14,3.42,3.45c0,2.31,-1.12,3.45,-3.42,3.45l-1.33,0zm10.71,-0.09l0,-1.8l-2.1,0l0,1.8zm0,8.88l0,-7.62l-2.1,0l0,7.62zm5.03,-7.86c-2.18,0,-3.23,1.17,-3.3,2.62l2.04,0c0.03,-0.72,0.48,-1.15,1.26,-1.15c0.73,0,1.24,0.39,1.24,1.35l0,0.27c-0.48,0.03,-1.34,0.12,-1.9,0.21c-2.21,0.34,-2.96,1.18,-2.96,2.43c0,1.32,0.98,2.31,2.6,2.31c1.05,0,1.9,-0.39,2.47,-1.2l0.03,0c0,0.37,0.03,0.7,0.11,1.02l1.88,0c-0.13,-0.51,-0.2,-1.13,-0.2,-2.09l0,-2.76c0,-1.99,-1.12,-3.01,-3.27,-3.01zm1.24,4.65c0,0.69,-0.07,1.09,-0.43,1.45c-0.31,0.3,-0.77,0.44,-1.2,0.44c-0.74,0,-1.13,-0.39,-1.13,-0.96c0,-0.62,0.36,-0.9,1.23,-1.05c0.45,-0.08,1.08,-0.14,1.53,-0.17zm6.63,-4.62c-1.92,0,-3.15,1.5,-3.15,3.87c0,2.37,1.22,3.87,3.12,3.87c0.92,0,1.56,-0.35,2.13,-1.14l0.03,0l0,0.67c0,1.49,-0.58,1.97,-1.53,1.97c-0.79,0,-1.27,-0.35,-1.32,-0.93l-2.1,0c0.12,1.5,1.28,2.43,3.38,2.43c2.19,0,3.61,-1.08,3.61,-3.39l0,-7.14l-1.98,0l0,1.02l-0.03,0c-0.58,-0.87,-1.23,-1.23,-2.16,-1.23zm0.57,1.72c0.99,0,1.62,0.86,1.62,2.15c0,1.29,-0.63,2.14,-1.62,2.14c-0.93,0,-1.53,-0.82,-1.53,-2.14c0,-1.32,0.6,-2.15,1.53,-2.15zm9.87,-1.69c-0.97,0,-1.74,0.46,-2.23,1.14l-0.03,0l0,-0.96l-1.97,0l0,7.62l2.1,0l0,-4.08c0,-1.38,0.63,-2.07,1.5,-2.07c0.83,0,1.34,0.52,1.34,1.68l0,4.47l2.1,0l0,-4.68c0,-2.07,-1.1,-3.12,-2.81,-3.12zm8.18,-0.06c-2.39,0,-3.9,1.57,-3.9,4.05c0,2.47,1.51,4.05,3.9,4.05c2.38,0,3.9,-1.58,3.9,-4.05c0,-2.48,-1.52,-4.05,-3.9,-4.05zm0,1.62c1.03,0,1.69,0.94,1.69,2.43c0,1.48,-0.66,2.43,-1.69,2.43c-1.04,0,-1.7,-0.95,-1.7,-2.43c0,-1.49,0.66,-2.43,1.7,-2.43zm8.34,-1.62c-1.89,0,-3.15,0.97,-3.15,2.34c0,1.77,1.36,2.07,2.64,2.4c1.18,0.31,1.75,0.45,1.75,1.11c0,0.45,-0.37,0.73,-1.11,0.73c-0.87,0,-1.33,-0.43,-1.33,-1.2l-2.13,0c0,1.85,1.3,2.72,3.42,2.72c2.07,0,3.36,-0.96,3.36,-2.39c0,-1.86,-1.5,-2.2,-2.87,-2.56c-1.15,-0.3,-1.63,-0.44,-1.63,-0.98c0,-0.43,0.36,-0.7,1.03,-0.7c0.75,0,1.2,0.33,1.2,1.11l2.01,0c0,-1.7,-1.2,-2.58,-3.19,-2.58zm8.44,6.28c-0.72,0,-0.99,-0.33,-0.99,-1.17l0,-3.31l1.46,0l0,-1.56l-1.46,0l0,-1.98l-2.1,0l0,1.98l-1.23,0l0,1.56l1.23,0l0,3.69c0,1.77,0.77,2.47,2.52,2.47c0.36,0,0.83,-0.06,1.11,-0.15l0,-1.6c-0.13,0.04,-0.34,0.07,-0.54,0.07zm4.04,-7.3l0,-1.8l-2.1,0l0,1.8zm0,8.88l0,-7.62l-2.1,0l0,7.62zm9.31,0l-3.21,-4.11l2.89,-3.51l-2.37,0l-2.46,3.07l-0.03,0l0,-6.13l-2.1,0l0,10.68l2.1,0l0,-3.57l0.03,0l2.55,3.57zm3.66,-7.86c-2.17,0,-3.22,1.17,-3.3,2.62l2.04,0c0.03,-0.72,0.48,-1.15,1.26,-1.15c0.74,0,1.25,0.39,1.25,1.35l0,0.27c-0.48,0.03,-1.34,0.12,-1.91,0.21c-2.21,0.34,-2.96,1.18,-2.96,2.43c0,1.32,0.98,2.31,2.6,2.31c1.05,0,1.9,-0.39,2.48,-1.2l0.03,0c0,0.37,0.03,0.7,0.1,1.02l1.89,0c-0.14,-0.51,-0.21,-1.13,-0.21,-2.09l0,-2.76c0,-1.99,-1.11,-3.01,-3.27,-3.01zm1.25,4.65c0,0.69,-0.08,1.09,-0.44,1.45c-0.3,0.3,-0.76,0.44,-1.2,0.44c-0.74,0,-1.12,-0.39,-1.12,-0.96c0,-0.62,0.35,-0.9,1.23,-1.05c0.44,-0.08,1.08,-0.14,1.53,-0.17z">
                </path>
                <path fill="var(--logo-color)"
                  d="M117.95,31.69l0,-10.68l-2.1,0l0,3.97l-0.03,0c-0.46,-0.72,-1.29,-1.1,-2.16,-1.1c-1.91,0,-3.13,1.57,-3.13,4c0,2.43,1.24,4,3.16,4c0.89,0,1.73,-0.42,2.19,-1.2l0.03,0l0,1.01zm-3.59,-6.21c0.95,0,1.59,0.88,1.59,2.4c0,1.51,-0.64,2.4,-1.59,2.4c-1,0,-1.64,-0.95,-1.64,-2.4c0,-1.46,0.64,-2.4,1.64,-2.4zm7.05,-2.28l2.11,-2.19l-2.6,0l-1.15,2.19zm0.68,8.49l0,-7.62l-2.1,0l0,7.62zm5.46,-1.58c-0.72,0,-0.99,-0.33,-0.99,-1.17l0,-3.31l1.45,0l0,-1.56l-1.45,0l0,-1.98l-2.1,0l0,1.98l-1.23,0l0,1.56l1.23,0l0,3.69c0,1.77,0.76,2.47,2.52,2.47c0.36,0,0.82,-0.06,1.11,-0.15l0,-1.6c-0.14,0.04,-0.34,0.07,-0.54,0.07zm3.87,-6.91l2.24,0l1.71,-2.19l-1.93,0l-0.9,1.14l-0.91,-1.14l-1.92,0zm1.15,7.24c-0.9,0,-1.66,-0.55,-1.72,-2.13l5.47,0c0,-0.84,-0.07,-1.42,-0.23,-1.95c-0.49,-1.54,-1.78,-2.53,-3.53,-2.53c-2.39,0,-3.78,1.74,-3.78,3.99c0,2.43,1.39,4.11,3.79,4.11c2.03,0,3.35,-1.16,3.65,-2.55l-2.15,0c-0.1,0.61,-0.66,1.06,-1.5,1.06zm-0.01,-5.13c0.84,0,1.53,0.53,1.66,1.68l-3.33,0c0.17,-1.15,0.81,-1.68,1.67,-1.68zm8.67,4.8c-0.72,0,-0.99,-0.33,-0.99,-1.17l0,-3.31l1.45,0l0,-1.56l-1.45,0l0,-1.98l-2.1,0l0,1.98l-1.23,0l0,1.56l1.23,0l0,3.69c0,1.77,0.77,2.47,2.52,2.47c0.36,0,0.82,-0.06,1.11,-0.15l0,-1.6c-0.14,0.04,-0.35,0.07,-0.54,0.07zm5.02,0.33c-0.9,0,-1.66,-0.55,-1.72,-2.13l5.47,0c0,-0.84,-0.07,-1.42,-0.24,-1.95c-0.48,-1.54,-1.77,-2.53,-3.52,-2.53c-2.39,0,-3.78,1.74,-3.78,3.99c0,2.43,1.39,4.11,3.79,4.11c2.03,0,3.35,-1.16,3.65,-2.55l-2.15,0c-0.1,0.61,-0.66,1.06,-1.5,1.06zm-0.01,-5.13c0.84,0,1.53,0.53,1.66,1.68l-3.33,0c0.17,-1.15,0.81,-1.68,1.67,-1.68z">
                </path>
                <desc>Diagnostika dítěte</desc>
              </svg>
            </a>
          </div>
          <div class="header-right">
            <div class="header-right-links" id="header-right-links">
              <a href="#" class="header-link" id="theme-toggle" onclick="toggleTheme(event)">
                <span class="icon" id="theme-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-moon-icon lucide-moon">
                    <path
                      d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401" />
                  </svg>
                </span>
                <span id="theme-text">Tmavý režim</span>
              </a>
              <a href="manual.pdf" target="_blank" class="header-link">
                <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" x2="8" y1="13" y2="13" />
                    <line x1="16" x2="8" y1="17" y2="17" />
                    <line x1="10" x2="8" y1="9" y2="9" />
                  </svg></span> Metodický manuál
              </a>
              <a href="https://forms.gle/EpxAt2FqTxr5nCu1A" target="_blank" class="header-link">
                <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z" />
                    <path d="M12 8v4" />
                    <path d="M12 16h.01" />
                  </svg></span> Zpětná vazba
              </a>
            </div>
            <button type="button" class="menu-toggle-btn" onclick="toggleHeaderMenu(event)" aria-label="Menu"
              title="Menu">
              <span class="menu-toggle-dot"></span>
              <span class="menu-toggle-dot"></span>
              <span class="menu-toggle-dot"></span>
            </button>
          </div>
        </div>
      </div>


      <header class="header-wide">
        <h1 class="title-single-line">ANAMNESTICKÝ DOTAZNÍK</h1>
        <h2 class="subtitle-wide">PRO DIAGNOSTIKU DÍTĚTE</h2>

        <div class="accent-row">
          <div class="accent-line"></div>
          <div class="dots-set">
            <div class="dot dot-full"></div>
            <div class="dot dot-full"></div>
            <div class="dot dot-outline"></div>
          </div>
        </div>
      </header>

      <h1 class="print-only-header">Anamnestický dotazník</h1>
      <div id="export-date" class="print-export-date"></div>

      <div class="instruction-block">
        <p>Je možné, že vás některý ze specialistů pečujících o vaše dítě požádal o poskytnutí anamnestických informací.
          Tento dotazník vás provede otázkami zaměřenými na různé oblasti života vašeho dítěte. Anamnéza by měla být
          důkladná, aby specialistům umožnila vytvořit ucelený obraz o vašem dítěti a přesně zacílit následnou pomoc a
          doporučení. Snažte se proto odpovídat upřímně a u otevřených odpovědí poskytovat dostatečné detaily. U
          některých otázek však stačí i několik slov nebo jedna věta – je to na vašem uvážení.</p>
        <ul>
          <li>Dotazník není krátký a k pohodlnějšímu vyplňování tedy doporučujeme použít počítač/laptop.</li>
          <li>Během vyplňování se budou na základě vašich odpovědí rozbalovat doplňující otázky.</li>
          <li>Horní lišta bude ukazovat váš postup v sekcích dotazníku; rozbalením lišty uvidíte detail jednotlivých
            sekcí.
          </li>
          <li> Pokud si přejete otázku nezodpovídat, vyberte možnost <em>Bez odpovědi</em> nebo nechte pole prázdné.
          </li>
          <li> Pokud některou otázku přeskočíte, zobrazí se vám v rekapitulaci na konci dotazníku.</li>
        </ul>


        <p>
          <strong>Ukládání dotazníku</strong><br>
          Pokud si přejete dotazník dokončit jindy, soubor se svými
          odpověďmi si můžete stáhnout tlačítkem <em>Uložit do souboru</em>. Dosavadní průchod se
          ukládá v tomto
          prohlížeči automaticky, případně také tlačítkem <em>Průběžně uložit</em>. Obě možnosti
          naleznete na
          konci
          dotazníku.
        </p>


        <div class="manual-tooltip">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="flex-shrink: 0; color: var(--muni-blue);">
            <path
              d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
            <path d="m9 12 2 2 4-4" />
          </svg>
          <div>
            <strong>Ochrana dat:</strong>
            <span>Data, která budete zadávat, mohou být citlivé povahy. Tento dotazník nikdy neodesílá data mimo vaše
              zařízení.
              Pro jistotu jsou vaše odpovědi automaticky ukládány pouze lokálně ve vašem prohlížeči. To umožňuje obnovu
              dat v případě zavření dotazníku apod.</span>
          </div>
        </div>


        <div class="manual-alert">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="flex-shrink: 0; color: var(--color-warning);">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3" />
            <path d="M12 9v4" />
            <path d="M12 17h.01" />
          </svg>
          <div>
            <strong>Upozornění:</strong>
            <span>Automatické ukládání nebude fungovat v anonymním režimu. Data se mohou ztratit také při smazání
              historie prohlížeče. Ukládání do souboru je nejspolehlivější metodou.</span>
          </div>

        </div>


        <p>
          <strong>Načítání dotazníku</strong><br>
          Vámi uložený soubor s odpověďmi načtete tlačítkem <em>Načíst ze souboru</em>. Pokud existuje
          průběžně/automaticky
          uložený průchod, obnovíte jej kliknutím na tlačítko <em>Načíst poslední průchod</em>.
        </p>


        <div
          style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 10px;">
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button type="button" class="btn btn-secondary"
              onclick="document.getElementById('json-file-input').click()">Načíst ze souboru</button>
            <button type="button" class="btn btn-secondary" id="load-from-storage-btn" onclick="loadForm()">Načíst
              poslední průchod</button>
          </div>
          <div style="text-align: right; margin-left: auto;">
            <button type="button" class="btn-delete-link" onclick="clearHistory()">Smazat aktuální průchod a
              historii</button>
          </div>
        </div>
      </div>


      <!-- Základní údaje -->
      <fieldset>
        <legend>Základní údaje</legend>

        <div class="qa-block">
          <label for="child_name"><span>Jméno dítěte:</span></label>
          <input class="short-text" type="text" name="child_name" id="child_name">
        </div>

        <div class="qa-block">
          <label for="child_preferred_name"><span>Jak si dítě přeje být oslovováno:</span></label>
          <input class="short-text" type="text" name="child_preferred_name" id="child_preferred_name">
        </div>
        <div class="qa-block">
          <label for="child_birthdate"><span>Datum narození dítěte:</span></label>
          <input type="date" name="child_birthdate" id="child_birthdate">
        </div>

        <div class="qa-block">
          <label><span>Věk:</span></label>
          <input type="text" name="child_age" id="child_age" readonly tabindex="-1" onfocus="this.blur()"
            style="cursor:default; pointer-events: none;" placeholder="Dopočítá se z data narození">
        </div>
      </fieldset>

      <fieldset>
        <legend>Zdravotní anamnéza</legend>

        <div class="tip-block tip-block-under">
          Zdravotní stav dítěte do značné míry určuje, jakou má kapacitu soustředit se, učit se, zvládat běžný den ve
          škole i doma a regulovat svoje chování. Řada obtíží, se kterými se ve školním prostředí může dítě potýkat
          (nesoustředěnost, pomalé tempo, vyrušování, emoční výbuchy), může být ovlivněna také tím, jak vidí a slyší,
          ale také chronickými nemocemi nebo bolestmi.
        </div>

        <div class="qa-block">
          <label id="lbl_neurolog_exam"><span>Bylo dítě někdy vyšetřeno neurologem, psychiatrem nebo klinickým
              psychologem?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_neurolog_exam">
            <label><input type="radio" name="neurolog_exam" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="neurolog_exam" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="neurolog_exam" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden" id="q_neurolog_exam_detail" data-controlled-by="neurolog_exam">
          <label for="diagnoses"><span>Jaké diagnózy stanovil/i:</span></label>
          <textarea class="long-text" name="diagnoses" id="diagnoses"></textarea>
        </div>
        <div class="qa-block">
          <label id="lbl_chronic_illnesses_status"><span>Trpí dítě některými chronickými onemocněními?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_chronic_illnesses_status">
            <label><input type="radio" name="chronic_illnesses_status" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="chronic_illnesses_status" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="chronic_illnesses_status" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden" id="q_chronic_illnesses_detail" data-controlled-by="chronic_illnesses_status">
          <label for="chronic_illnesses_detail"><span>Jakými chronickými onemocněními?</span></label>
          <textarea class="long-text" name="chronic_illnesses_detail" id="chronic_illnesses_detail"></textarea>
        </div>
        <div class="qa-block">
          <label id="lbl_past_health_issues_status"><span>Prodělalo dítě v minulosti nějaké vážné zdravotní komplikace
              (hospitalizace, chirurgický zákrok, apod.)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_past_health_issues_status">
            <label><input type="radio" name="past_health_issues_status" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="past_health_issues_status" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="past_health_issues_status" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden" id="q_past_health_issues_detail" data-controlled-by="past_health_issues_status">
          <label for="past_health_issues_detail"><span>Jaké zdravotní komplikace to byly?</span></label>
          <textarea class="long-text" name="past_health_issues_detail" id="past_health_issues_detail"></textarea>
        </div>
        <div class="qa-block">
          <label id="lbl_vision_exam"><span>Byl dítěti někdy vyšetřen zrak?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_vision_exam">
            <label><input type="radio" name="vision_exam" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="vision_exam" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="vision_exam" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block">
          <label id="lbl_vision_issues"><span>Má dítě se zrakem nějaké obtíže?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_vision_issues">
            <label><input type="radio" name="vision_issues" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="vision_issues" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="vision_issues" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden" id="q_vision_issues_detail" data-controlled-by="vision_issues">
          <label id="lbl_vision_devices"><span>Dítě:</span></label>
          <div class="select-group" role="group" aria-labelledby="lbl_vision_devices">
            <label><input type="checkbox" name="vision_devices_glasses"><span>Nosí brýle</span></label>
            <label><input type="checkbox" name="vision_devices_contacts"><span>Nosí kontaktní čočky</span></label>
            <label><input type="checkbox" name="vision_devices_occluder"><span>Používá okluzory</span></label>
            <label><input type="checkbox" name="vision_devices_surgery"><span>Podstoupilo operaci očí</span></label>
            <label><input type="checkbox" name="vision_devices_other"><span>Má jiný problém</span></label>
          </div>
        </div>

        <div class="qa-block">
          <label id="lbl_hearing_exam"><span>Byl dítěti někdy vyšetřen sluch (například na ORL)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_hearing_exam">
            <label><input type="radio" name="hearing_exam" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="hearing_exam" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="hearing_exam" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block">
          <label id="lbl_hearing_issues"><span>Má dítě se sluchem nějaké dlouhodobé obtíže?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_hearing_issues">
            <label><input type="radio" name="hearing_issues" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="hearing_issues" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="hearing_issues" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden" id="q_hearing_issues_detail" data-controlled-by="hearing_issues">
          <label for="hearing_issues_detail"><span>Jaké sluchové obtíže to jsou?</span></label>
          <textarea class="long-text" name="hearing_issues_detail" id="hearing_issues_detail"></textarea>
        </div>

        <div class="qa-block">
          <label id="lbl_speech_therapist_visit"><span>Dochází nebo docházelo dítě k logopedovi?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_speech_therapist_visit">
            <label><input type="radio" name="speech_therapist_visit" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="speech_therapist_visit" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="speech_therapist_visit" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block">
          <label id="lbl_speech_difficulties"><span>Dochází u dítěte k řečovým obtížím?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_speech_difficulties">
            <label><input type="radio" name="speech_difficulties" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="speech_difficulties" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="speech_difficulties" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

      </fieldset>

      <fieldset>
        <legend>Rodinná anamnéza</legend>

        <div class="tip-block tip-block-under">
          V rodinném prostředí dítě tráví velkou část, často i většinu svého času. Rodina tak do značné míry určuje, jak
          má nastavené denní režimy, pravidla, i jaké míře zátěže je dlouhodobě vystaveno.
        </div>

        <div class="qa-block">
          <label id="lbl_respondent_relation"><span>V jakém vztahu jste k dítěti vy?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_respondent_relation">
            <label><input type="radio" name="respondent_relation" value="Biologický rodič"><span>Biologický
                rodič</span></label>
            <label><input type="radio" name="respondent_relation" value="Vychovávající rodič"><span>Vychovávající
                rodič</span></label>
            <label><input type="radio" name="respondent_relation" value="Jiný vztah"><span>Jiný vztah</span></label>
            <label><input type="radio" name="respondent_relation" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>



        <!-- Bio parent -->

        <div class="qa-block qa-group hidden" id="group_bio_parents_combined" data-controlled-by="respondent_relation"
          data-trigger-value="Biologický rodič">


          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Údaje o Vás</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="bio_p1_age"><span>Váš věk:</span></label>
                <input type="number" name="bio_p1_age" id="bio_p1_age">
              </div>

              <div class="qa-block">
                <label id="lbl_bio_p1_job_status"><span>Jste zaměstnaný/á?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_bio_p1_job_status">
                  <label><input type="radio" name="bio_p1_job_status" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="bio_p1_job_status" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="bio_p1_job_status" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_bio_p1_job_detail" data-controlled-by="bio_p1_job_status"
                data-trigger-value="Ano">
                <label for="bio_p1_job_text"><span>Jaké je vaše zaměstnání?</span></label>
                <input class="short-text" type="text" name="bio_p1_job_text" id="bio_p1_job_text">
              </div>

              <div class="qa-block">
                <label id="lbl_bio_p1_mental"><span>Máte nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_bio_p1_mental">
                  <label><input type="radio" name="bio_p1_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="bio_p1_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="bio_p1_mental" value="Bez odpovědi"><span>Bez odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_bio_p1_mental_detail" data-controlled-by="bio_p1_mental"
                data-trigger-value="Ano">
                <label for="bio_p1_mental_text"><span>Jaké duševní obtíže to jsou?</span></label>
                <textarea class="long-text" name="bio_p1_mental_text" id="bio_p1_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_bio_p1_physical"><span>Máte nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_bio_p1_physical">
                  <label><input type="radio" name="bio_p1_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="bio_p1_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="bio_p1_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_bio_p1_physical_detail" data-controlled-by="bio_p1_physical"
                data-trigger-value="Ano">
                <label for="bio_p1_physical_text"><span>Jaká fyzická omezení to jsou?</span></label>
                <textarea class="long-text" name="bio_p1_physical_text" id="bio_p1_physical_text"></textarea>
              </div>

            </div>
          </fieldset>


          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Druhý biologický rodič</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="bio_p2_age"><span>Věk:</span></label>
                <input type="number" name="bio_p2_age" id="bio_p2_age">
              </div>

              <div class="qa-block">
                <label id="lbl_bio_p2_carer"><span>Je zároveň vychovávajícím rodičem?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_bio_p2_carer">
                  <label><input type="radio" name="bio_p2_carer" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="bio_p2_carer" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="bio_p2_carer" value="Bez odpovědi"><span>Bez odpovědi</span></label>
                </div>
              </div>

              <div class="qa-block">
                <label id="lbl_bio_p2_mental"><span>Má/měl(a) nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_bio_p2_mental">
                  <label><input type="radio" name="bio_p2_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="bio_p2_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="bio_p2_mental" value="Bez odpovědi"><span>Bez odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_bio_p2_mental_detail" data-controlled-by="bio_p2_mental"
                data-trigger-value="Ano">
                <label for="bio_p2_mental_text"><span>Jaké duševní obtíže to jsou/byla?</span></label>
                <textarea class="long-text" name="bio_p2_mental_text" id="bio_p2_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_bio_p2_physical"><span>Má/měl(a) nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_bio_p2_physical">
                  <label><input type="radio" name="bio_p2_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="bio_p2_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="bio_p2_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_bio_p2_physical_detail" data-controlled-by="bio_p2_physical"
                data-trigger-value="Ano">
                <label for="bio_p2_physical_text"><span>Jaká fyzická omezení to jsou/byla?</span></label>
                <textarea class="long-text" name="bio_p2_physical_text" id="bio_p2_physical_text"></textarea>
              </div>
            </div>
          </fieldset>

        </div>
        <!-- End of bio parent -->


        <!-- Step Parent -->

        <div class="qa-block qa-group hidden" id="group_stepparent_combined" data-controlled-by="respondent_relation"
          data-trigger-value="Vychovávající rodič">

          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Údaje o Vás</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="step_resp_age"><span>Váš věk:</span></label>
                <input type="number" name="step_resp_age" id="step_resp_age">
              </div>

              <div class="qa-block">
                <label id="lbl_step_resp_job_status"><span>Jste zaměstnaný/á?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_resp_job_status">
                  <label><input type="radio" name="step_resp_job_status" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_resp_job_status" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_resp_job_status" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_resp_job_detail" data-controlled-by="step_resp_job_status"
                data-trigger-value="Ano">
                <label for="step_resp_job_text"><span>Jaké je vaše zaměstnání?</span></label>
                <input class="short-text" type="text" name="step_resp_job_text" id="step_resp_job_text">
              </div>

              <div class="qa-block">
                <label id="lbl_step_resp_mental"><span>Máte nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_resp_mental">
                  <label><input type="radio" name="step_resp_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_resp_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_resp_mental" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_resp_mental_detail" data-controlled-by="step_resp_mental"
                data-trigger-value="Ano">
                <label for="step_resp_mental_text"><span>Jaké duševní obtíže to jsou?</span></label>
                <textarea class="long-text" name="step_resp_mental_text" id="step_resp_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_step_resp_physical"><span>Máte nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_resp_physical">
                  <label><input type="radio" name="step_resp_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_resp_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_resp_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_resp_physical_detail" data-controlled-by="step_resp_physical"
                data-trigger-value="Ano">
                <label for="step_resp_physical_text"><span>Jaká fyzická omezení to jsou?</span></label>
                <textarea class="long-text" name="step_resp_physical_text" id="step_resp_physical_text"></textarea>
              </div>
            </div>
          </fieldset>


          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Biologická matka</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="step_bio_m_age"><span>Věk:</span></label>
                <input type="number" name="step_bio_m_age" id="step_bio_m_age">
              </div>

              <div class="qa-block">
                <label id="lbl_step_bio_m_carer"><span>Je zároveň vychovávajícím rodičem?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_bio_m_carer">
                  <label><input type="radio" name="step_bio_m_carer" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_bio_m_carer" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_bio_m_carer" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>

              <div class="qa-block">
                <label id="lbl_step_bio_m_mental"><span>Má/měla nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_bio_m_mental">
                  <label><input type="radio" name="step_bio_m_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_bio_m_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_bio_m_mental" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_bio_m_mental_detail" data-controlled-by="step_bio_m_mental"
                data-trigger-value="Ano">
                <label for="step_bio_m_mental_text"><span>Jaké duševní obtíže to jsou/byly?</span></label>
                <textarea class="long-text" name="step_bio_m_mental_text" id="step_bio_m_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_step_bio_m_physical"><span>Má/měla nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_bio_m_physical">
                  <label><input type="radio" name="step_bio_m_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_bio_m_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_bio_m_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_bio_m_physical_detail" data-controlled-by="step_bio_m_physical"
                data-trigger-value="Ano">
                <label for="step_bio_m_physical_text"><span>Jaká fyzická omezení to jsou/byla?</span></label>
                <textarea class="long-text" name="step_bio_m_physical_text" id="step_bio_m_physical_text"></textarea>
              </div>
            </div>
          </fieldset>


          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Biologický otec</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="step_bio_f_age"><span>Věk:</span></label>
                <input type="number" name="step_bio_f_age" id="step_bio_f_age">
              </div>

              <div class="qa-block">
                <label id="lbl_step_bio_f_carer"><span>Je zároveň vychovávajícím rodičem?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_bio_f_carer">
                  <label><input type="radio" name="step_bio_f_carer" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_bio_f_carer" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_bio_f_carer" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>

              <div class="qa-block">
                <label id="lbl_step_bio_f_mental"><span>Má/měl nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_bio_f_mental">
                  <label><input type="radio" name="step_bio_f_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_bio_f_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_bio_f_mental" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_bio_f_mental_detail" data-controlled-by="step_bio_f_mental"
                data-trigger-value="Ano">
                <label for="step_bio_f_mental_text"><span>Jaké duševní obtíže to jsou/byly?</span></label>
                <textarea class="long-text" name="step_bio_f_mental_text" id="step_bio_f_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_step_bio_f_physical"><span>Má/měl nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_step_bio_f_physical">
                  <label><input type="radio" name="step_bio_f_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="step_bio_f_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="step_bio_f_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_step_bio_f_physical_detail" data-controlled-by="step_bio_f_physical"
                data-trigger-value="Ano">
                <label for="step_bio_f_physical_text"><span>Jaká fyzická omezení to jsou/byla?</span></label>
                <textarea class="long-text" name="step_bio_f_physical_text" id="step_bio_f_physical_text"></textarea>
              </div>
            </div>
          </fieldset>

        </div>

        <!-- End of step parent -->

        <!-- Other relationship -->

        <div class="qa-block qa-group hidden" id="group_other_combined" data-controlled-by="respondent_relation"
          data-trigger-value="Jiný vztah">

          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Údaje o Vás</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="other_resp_relation_spec"><span>V jakém vztahu jste k dítěti?</span></label>
                <input class="short-text" type="text" name="other_resp_relation_spec" id="other_resp_relation_spec">
              </div>

              <div class="qa-block">
                <label for="other_resp_age"><span>Váš věk:</span></label>
                <input type="number" name="other_resp_age" id="other_resp_age">
              </div>

              <div class="qa-block">
                <label id="lbl_other_resp_job_status"><span>Jste zaměstnaný/á?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_resp_job_status">
                  <label><input type="radio" name="other_resp_job_status" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_resp_job_status" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_resp_job_status" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_resp_job_detail" data-controlled-by="other_resp_job_status"
                data-trigger-value="Ano">
                <label for="other_resp_job_text"><span>Jaké je vaše zaměstnání?</span></label>
                <input class="short-text" type="text" name="other_resp_job_text" id="other_resp_job_text">
              </div>

              <div class="qa-block">
                <label id="lbl_other_resp_mental"><span>Máte nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_resp_mental">
                  <label><input type="radio" name="other_resp_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_resp_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_resp_mental" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_resp_mental_detail" data-controlled-by="other_resp_mental"
                data-trigger-value="Ano">
                <label for="other_resp_mental_text"><span>Jaké duševní obtíže to jsou?</span></label>
                <textarea class="long-text" name="other_resp_mental_text" id="other_resp_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_other_resp_physical"><span>Máte nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_resp_physical">
                  <label><input type="radio" name="other_resp_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_resp_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_resp_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_resp_physical_detail" data-controlled-by="other_resp_physical"
                data-trigger-value="Ano">
                <label for="other_resp_physical_text"><span>Jaká fyzická omezení to jsou?</span></label>
                <textarea class="long-text" name="other_resp_physical_text" id="other_resp_physical_text"></textarea>
              </div>
            </div>
          </fieldset>


          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Biologická matka</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="other_bio_m_age"><span>Věk:</span></label>
                <input type="number" name="other_bio_m_age" id="other_bio_m_age">
              </div>

              <div class="qa-block">
                <label id="lbl_other_bio_m_carer"><span>Je zároveň vychovávajícím rodičem?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_bio_m_carer">
                  <label><input type="radio" name="other_bio_m_carer" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_bio_m_carer" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_bio_m_carer" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>

              <div class="qa-block">
                <label id="lbl_other_bio_m_mental"><span>Má/měla nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_bio_m_mental">
                  <label><input type="radio" name="other_bio_m_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_bio_m_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_bio_m_mental" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_bio_m_mental_detail" data-controlled-by="other_bio_m_mental"
                data-trigger-value="Ano">
                <label for="other_bio_m_mental_text"><span>Jaké duševní obtíže to jsou/byly?</span></label>
                <textarea class="long-text" name="other_bio_m_mental_text" id="other_bio_m_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_other_bio_m_physical"><span>Má/měla nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_bio_m_physical">
                  <label><input type="radio" name="other_bio_m_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_bio_m_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_bio_m_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_bio_m_physical_detail" data-controlled-by="other_bio_m_physical"
                data-trigger-value="Ano">
                <label for="other_bio_m_physical_text"><span>Jaká fyzická omezení to jsou/byla?</span></label>
                <textarea class="long-text" name="other_bio_m_physical_text" id="other_bio_m_physical_text"></textarea>
              </div>
            </div>
          </fieldset>


          <fieldset class="style-soft">
            <div class="style-soft-header">
              <legend>Biologický otec</legend>
            </div>
            <div class="style-soft-body">

              <div class="qa-block">
                <label for="other_bio_f_age"><span>Věk:</span></label>
                <input type="number" name="other_bio_f_age" id="other_bio_f_age">
              </div>

              <div class="qa-block">
                <label id="lbl_other_bio_f_carer"><span>Je zároveň vychovávajícím rodičem?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_bio_f_carer">
                  <label><input type="radio" name="other_bio_f_carer" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_bio_f_carer" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_bio_f_carer" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>

              <div class="qa-block">
                <label id="lbl_other_bio_f_mental"><span>Má/měl nějaké duševní obtíže?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_bio_f_mental">
                  <label><input type="radio" name="other_bio_f_mental" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_bio_f_mental" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_bio_f_mental" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_bio_f_mental_detail" data-controlled-by="other_bio_f_mental"
                data-trigger-value="Ano">
                <label for="other_bio_f_mental_text"><span>Jaké duševní obtíže to jsou/byly?</span></label>
                <textarea class="long-text" name="other_bio_f_mental_text" id="other_bio_f_mental_text"></textarea>
              </div>

              <div class="qa-block">
                <label id="lbl_other_bio_f_physical"><span>Má/měl nějaká fyzická omezení (např. nemoci,
                    hendikep)?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_bio_f_physical">
                  <label><input type="radio" name="other_bio_f_physical" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="other_bio_f_physical" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="other_bio_f_physical" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block hidden" id="q_other_bio_f_physical_detail" data-controlled-by="other_bio_f_physical"
                data-trigger-value="Ano">
                <label for="other_bio_f_physical_text"><span>Jaká fyzická omezení to jsou/byla?</span></label>
                <textarea class="long-text" name="other_bio_f_physical_text" id="other_bio_f_physical_text"></textarea>
              </div>
            </div>
          </fieldset>

        </div>

        <!-- End of Other relationship -->

        <div class="qa-block">
          <label id="lbl_other_carer_status"><span>Podílí se na výchově dítěte ještě někdo další?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_other_carer_status">
            <label><input type="radio" name="other_carer_status" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="other_carer_status" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="other_carer_status" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden summary-ignore" id="q_other_carer_detail" data-controlled-by="other_carer_status">
          <div id="additional_carers_container"></div>
          <div class="qa-block summary-ignore" style="text-align: center; margin-top: 15px;">
            <button type="button" class="btn btn-secondary btn-add-item" onclick="addCarer()">+ Přidat vychovávající
              osobu</button>
          </div>
        </div>
        <div class="qa-block">
          <label id="lbl_has_siblings"><span>Má dítě sourozence?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_has_siblings">
            <label><input type="radio" name="has_siblings" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="has_siblings" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="has_siblings" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden summary-ignore" id="q_siblings_detail" data-controlled-by="has_siblings">
          <div id="siblings_container"></div>
          <div class="qa-block summary-ignore" style="text-align: center; margin-top: 15px;">
            <button type="button" class="btn btn-secondary btn-add-item" onclick="addSibling()">+ Přidat
              sourozence</button>
          </div>
        </div>
      </fieldset>


      <fieldset>
        <legend>Sociální anamnéza</legend>

        <div class="tip-block tip-block-under">
          Tato sekce mapuje sociální prostředí, ve kterém dítě žije (zda má stabilní bydlení, vlastní prostor pro plnění
          povinností i volný čas), možnosti pečujících osob s dítětem trávit čas a jejich společné záliby.
        </div>

        <div class="qa-block">
          <label id="lbl_housing_type"><span>V jakém typu bydlení žijete?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_housing_type">
            <label><input type="radio" name="housing_type" value="Dům"><span>Dům</span></label>
            <label><input type="radio" name="housing_type" value="Byt"><span>Byt</span></label>
            <label><input type="radio" name="housing_type" value="Jiné"><span>Jiné</span></label>
            <label><input type="radio" name="housing_type" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block hidden" id="q_housing_specification_detail" data-controlled-by="housing_type"
          data-trigger-value="Jiné">
          <label for="housing_specification"><span>Můžete typ bydlení specifikovat?</span></label>
          <textarea class="long-text" name="housing_specification" id="housing_specification"></textarea>
        </div>
        <div class="qa-block">
          <label for="housing_satisfaction"><span>Jak jste s bydlením spokojení?</span></label>
          <textarea class="long-text" name="housing_satisfaction" id="housing_satisfaction"></textarea>
        </div>
        <div class="qa-block">
          <label for="household_count"><span>Kolik lidí žije ve vaší domácnosti?</span></label>
          <input type="number" name="household_count" id="household_count">
        </div>
        <div class="qa-block">
          <label id="lbl_child_own_room"><span>Má dítě vlastní pokoj?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_child_own_room">
            <label><input type="radio" name="child_own_room" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="child_own_room" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="child_own_room" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>
        <div class="qa-block">
          <label id="lbl_child_own_desk"><span>Má dítě vlastní pracovní stůl?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_child_own_desk">
            <label><input type="radio" name="child_own_desk" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="child_own_desk" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="child_own_desk" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block">
          <label id="lbl_time_with_children"><span>Kolik času denně trávíte vy osobně s dítětem (stačí pouhá přítomnost
              doma)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_time_with_children">
            <label><input type="radio" name="time_with_children" value="Do 2 hodin"><span>Do 2 hodin</span></label>
            <label><input type="radio" name="time_with_children" value="2–5 hodin"><span>2–5 hodin</span></label>
            <label><input type="radio" name="time_with_children" value="5–8 hodin"><span>5–8 hodin</span></label>
            <label><input type="radio" name="time_with_children" value="8 hodin a více"><span>8 hodin a
                více</span></label>
            <label><input type="radio" name="time_with_children" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block">
          <label id="lbl_time_with_child_active"><span>Kolik času denně se dítěti vy osobně přímo věnujete (hra,
              společné činnosti, rozhovor)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_time_with_child_active">
            <label><input type="radio" name="time_with_child_active" value="0-30 minut"><span>0-30 minut</span></label>
            <label><input type="radio" name="time_with_child_active" value="30-60 minut"><span>30-60
                minut</span></label>
            <label><input type="radio" name="time_with_child_active" value="2-3 hodiny"><span>2-3 hodiny</span></label>
            <label><input type="radio" name="time_with_child_active" value="3 hodiny a více"><span>3 hodiny a
                více</span></label>
            <label><input type="radio" name="time_with_child_active" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block">
          <label id="lbl_time_with_child_others"><span>Kolik času denně se dítěti přímo věnují další osoby (hra,
              společné činnosti, rozhovor)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_time_with_child_others">
            <label><input type="radio" name="time_with_child_others" value="0-30 minut"><span>0-30 minut</span></label>
            <label><input type="radio" name="time_with_child_others" value="30-60 minut"><span>30-60
                minut</span></label>
            <label><input type="radio" name="time_with_child_others" value="2-3 hodiny"><span>2-3 hodiny</span></label>
            <label><input type="radio" name="time_with_child_others" value="3 hodiny a více"><span>3 hodiny a
                více</span></label>
            <label><input type="radio" name="time_with_child_others" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>



        <div class="qa-block">
          <label id="lbl_practice_with_child"><span>Máte prostor s dítětem něco procvičovat?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_practice_with_child">
            <label><input type="radio" name="practice_with_child" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="practice_with_child" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="practice_with_child" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block">
          <label for="fav_activity_with_child"><span>Jaká je vaše oblíbená činnost s dítětem? (může jich být i
              více)</span></label>
          <textarea class="long-text" name="fav_activity_with_child" id="fav_activity_with_child"></textarea>
        </div>

        <div class="qa-block">
          <label for="child_fav_activity"><span>Jaká je oblíbená činnost dítěte obecně?</span></label>
          <textarea class="long-text" name="child_fav_activity" id="child_fav_activity"></textarea>
        </div>

        <div class="qa-block">
          <label for="child_fav_movie"><span>Jestli má dítě oblíbený film, jaký to je?</span></label>
          <input type="text" name="child_fav_movie" id="child_fav_movie">
        </div>

        <div class="qa-block">
          <label for="child_fav_book"><span>Jestli má dítě oblíbenou knihu, jaká to je?</span></label>
          <input type="text" name="child_fav_book" id="child_fav_book">
        </div>

        <div class="qa-block">
          <label id="lbl_child_has_device"><span>Má dítě přístup k telefonu nebo tabletu?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_child_has_device">
            <label><input type="radio" name="child_has_device" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="child_has_device" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="child_has_device" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block qa-group hidden" id="q_child_device_details" data-controlled-by="child_has_device">
          <div class="qa-block">
            <label for="child_device_use_relative"><span>Jak moc dítě podle vás používá mobil nebo tablet ve srovnání s
                vrstevníky?</span></label>
            <textarea class="long-text" name="child_device_use_relative" id="child_device_use_relative"></textarea>
          </div>
          <div class="qa-block">
            <label for="child_device_usage"><span>Co dítě na telefonu nejčastěji dělá? (seřaďte podle
                frekvence)</span></label>
            <textarea class="long-text" name="child_device_usage" id="child_device_usage"></textarea>
          </div>
          <div class="qa-block">
            <label for="child_device_control"><span>Pokoušíte se nějakým způsobem kontrolovat, co dítě na telefonu dělá?
                (např. výchovně nebo omezením přímo v telefonu)</span></label>
            <textarea class="long-text" name="child_device_control" id="child_device_control"></textarea>
          </div>
        </div>

        <div class="qa-block">
          <label for="child_device_parenting_theme"><span>Jak moc je pro vás používání mobilu či tabletu tématem ve
              výchově?</span></label>
          <textarea class="long-text" name="child_device_parenting_theme" id="child_device_parenting_theme"></textarea>
        </div>
      </fieldset>

      <fieldset>
        <legend>Školka</legend>
        <div class="qa-block">
          <label id="lbl_attends_kindergarten"><span>Navštěvuje vaše dítě školku?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_attends_kindergarten">
            <label><input type="radio" name="attends_kindergarten" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="attends_kindergarten" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="attends_kindergarten" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block qa-group hidden" id="q_kindergarten_details" data-controlled-by="attends_kindergarten">

          <div class="tip-block tip-block-under">
            Tato sekce mapuje zkušenosti dítěte s předškolním vzděláváním - zda a v jakém režimu dítě školku navštěvuje,
            jak probíhá adaptace na prostředí, fungování v dětském kolektivu nebo zvládání předškolní přípravy. Ve
            školce má dítě možnost rozvíjet sociální dovednosti, vrstevnické vztahy, sebeobsluhu, schopnost fungovat
            mimo rodinu a také odolnost vůči změnám a zátěži.
          </div>

          <div class="qa-block">
            <label for="kg_how_many"><span>Do kolika školek vaše dítě chodí?</span></label>
            <input type="number" name="kg_how_many" id="kg_how_many">
          </div>

          <div class="qa-block">
            <label for="kg_days_per_week"><span>Kolik dní v týdnu chodí vaše dítě do školky?</span></label>
            <input type="number" name="kg_days_per_week" id="kg_days_per_week">
          </div>

          <div class="qa-block">
            <label for="kg_afternoons"><span>Kolik z těchto dnů tráví ve školce i odpoledne?</span></label>
            <input type="number" name="kg_afternoons" id="kg_afternoons">
          </div>

          <div class="qa-block">
            <label id="lbl_kg_morning_issues"><span>Kdybyste měl/a zhodnotit, jak probíhá ranní vypravování do školky –
                má s ním dítě nějaké obtíže?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_morning_issues">
              <label><input type="radio" name="kg_morning_issues" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_morning_issues" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_morning_issues" value="Bez odpovědi"><span>Bez odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_morning_issues_detail" data-controlled-by="kg_morning_issues">
            <label for="kg_morning_issues_detail"><span>Můžete obtíže specifikovat?</span></label>
            <textarea class="long-text" name="kg_morning_issues_detail" id="kg_morning_issues_detail"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_kg_separation_issues"><span>Má dítě problém se rozloučit při odchodu do
                školky?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_separation_issues">
              <label><input type="radio" name="kg_separation_issues" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_separation_issues" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_separation_issues" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label for="kg_after_return_behavior"><span>Kdybyste měl/a zhodnotit, jak dítě funguje (jak se chová) po
                návratu ze školky, co byste o něm řekl/a?</span></label>
            <textarea class="long-text" name="kg_after_return_behavior" id="kg_after_return_behavior"></textarea>
          </div>

          <div class="qa-block">
            <label for="kg_child_rating"><span>Jak dítě hodnotí školku?</span></label>
            <textarea class="long-text" name="kg_child_rating" id="kg_child_rating"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_kg_talks_about_day"><span>Mluví s vámi dítě o svém dni ve školce?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_talks_about_day">
              <label><input type="radio" name="kg_talks_about_day" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_talks_about_day" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_talks_about_day" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label for="kg_obedience"><span>Jak je vaše dítě ve školce poslušné podle učitelek?</span></label>
            <textarea class="long-text" name="kg_obedience" id="kg_obedience"></textarea>
          </div>

          <div class="qa-block">
            <label for="kg_participation"><span>Jak se vaše dítě podle učitelek zapojuje do dění ve
                školce?</span></label>
            <textarea class="long-text" name="kg_participation" id="kg_participation"></textarea>
          </div>

          <div class="qa-block">
            <label for="kg_peer_behavior"><span>Jak učitelky ve školce hodnotí chování vašeho dítěte k jiným dětem?
                (hraje si s nimi / nezlobí je apod.)</span></label>
            <textarea class="long-text" name="kg_peer_behavior" id="kg_peer_behavior"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_kg_teachers_complain"><span>Stěžují si učitelky ve školce na vaše dítě?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_teachers_complain">
              <label><input type="radio" name="kg_teachers_complain" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_teachers_complain" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_teachers_complain" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_kg_teachers_see_problem"><span>Zmiňují učitelky problém, kvůli kterému bude nyní dítě
                podstupovat vyšetření?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_teachers_see_problem">
              <label><input type="radio" name="kg_teachers_see_problem" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_teachers_see_problem" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_teachers_see_problem" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_kg_preschool_prep"><span>Probíhá ve školce nějaká forma předškolní přípravy?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_preschool_prep">
              <label><input type="radio" name="kg_preschool_prep" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_preschool_prep" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_preschool_prep" value="Bez odpovědi"><span>Bez odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_kg_prep_progress_detail" data-controlled-by="kg_preschool_prep">
            <label for="kg_prep_progress"><span>Jak učitelky hodnotí fungování dítěte při školní
                přípravě?</span></label>
            <textarea class="long-text" name="kg_prep_progress" id="kg_prep_progress"></textarea>
          </div>

          <div class="qa-block">
            <label for="kg_parent_rating"><span>Jak vy osobně školku hodnotíte?</span></label>
            <textarea class="long-text" name="kg_parent_rating" id="kg_parent_rating"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_kg_starting_school"><span>Nastupuje dítě v nejbližší době do první třídy?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_kg_starting_school">
              <label><input type="radio" name="kg_starting_school" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="kg_starting_school" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="kg_starting_school" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

        </div>
      </fieldset>


      <fieldset>
        <legend>Škola</legend>

        <div class="qa-block">
          <label id="lbl_attends_school"><span>Navštěvuje dítě školu?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_attends_school">
            <label><input type="radio" name="attends_school" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="attends_school" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="attends_school" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block qa-group hidden" id="q_school_details" data-controlled-by="attends_school">

          <div class="tip-block tip-block-under">
            Školní docházka může pro děti představovat velkou výzvu - vyžaduje dlouhodobou pozornost, regulaci emocí i
            chování, organizaci, práci podle instrukcí a schopnost vztahovat se adekvátním způsobem k ostatním dětem i
            vyučujícím. V dotazníku se snažíme získat co nejvíce informací o tom, jak konkrétně vypadá školní režim,
            uspořádání třídy a školní povinnosti dítěte. Všechny tyto faktory se mohou promítat do školního výkonu i
            psychické pohody dítěte.
          </div>

          <div class="qa-block">
            <label id="lbl_school_first_grade"><span>Je dítě aktuálně v první třídě?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_first_grade">
              <label><input type="radio" name="school_first_grade" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_first_grade" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_first_grade" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block qa-group hidden" id="q_school_first_grade_history"
            data-controlled-by="school_first_grade">

            <div class="tip-block tip-block-under">
              Tato část dotazníku se vrací k období předškolního věku, kdy se začínají objevovat první náznaky potíží či
              naopak silných stránek, které mohou ovlivňovat fungování dítěte ve škole i dnes. Vaše odpovědi nám pomohou
              získat představu o tom, jaká doporučení nebo podpůrná opatření by dítěti ve škole mohla prospívat.</div>

            <div class="qa-block">
              <label for="school_history_kg_obedience"><span>Jak bylo vaše dítě ve školce poslušné podle
                  učitelek?</span></label>
              <textarea class="long-text" name="school_history_kg_obedience"
                id="school_history_kg_obedience"></textarea>
            </div>
            <div class="qa-block">
              <label for="school_history_kg_participation"><span>Jak se vaše dítě podle učitelek zapojovalo do dění ve
                  školce?</span></label>
              <textarea class="long-text" name="school_history_kg_participation"
                id="school_history_kg_participation"></textarea>
            </div>
            <div class="qa-block">
              <label for="school_history_kg_peer_behavior"><span>Jak učitelky ve školce hodnotily chování vašeho dítěte
                  k jiným dětem? (hraje si s nimi / nezlobí je apod.)</span></label>
              <textarea class="long-text" name="school_history_kg_peer_behavior"
                id="school_history_kg_peer_behavior"></textarea>
            </div>
            <div class="qa-block">
              <label for="school_history_kg_prep_progress"><span>Jak učitelky ve školce hodnotily fungování dítěte při
                  školní přípravě?</span></label>
              <textarea class="long-text" name="school_history_kg_prep_progress"
                id="school_history_kg_prep_progress"></textarea>
            </div>
            <div class="qa-block">
              <label for="school_history_kg_prep_see_problem"><span>Zmiňovaly učitelky ve školce problém, kvůli kterému
                  bude nyní dítě podstupovat vyšetření?</span></label>
              <textarea class="long-text" name="school_history_kg_prep_see_problem"
                id="school_history_kg_prep_see_problem"></textarea>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_school_fav_subjects_exists"><span>Má dítě ve škole nějaké oblíbené vyučovací
                předměty?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_fav_subjects_exists">
              <label><input type="radio" name="school_fav_subjects_exists" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_fav_subjects_exists" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_fav_subjects_exists" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_fav_subjects_detail"
            data-controlled-by="school_fav_subjects_exists">
            <label for="school_fav_subjects_list"><span>Jaké oblíbenépředměty to jsou?</span></label>
            <textarea class="long-text" name="school_fav_subjects_list" id="school_fav_subjects_list"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_school_disliked_subjects_exists"><span>Jsou nějaké předměty, které dítě nemá
                rádo?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_disliked_subjects_exists">
              <label><input type="radio" name="school_disliked_subjects_exists" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_disliked_subjects_exists" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_disliked_subjects_exists" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_disliked_subjects_detail"
            data-controlled-by="school_disliked_subjects_exists">
            <label for="school_disliked_subjects_list"><span>Které předměty nemá rádo?</span></label>
            <textarea class="long-text" name="school_disliked_subjects_list"
              id="school_disliked_subjects_list"></textarea>
          </div>

          <div class="qa-block">
            <label for="school_teacher_count"><span>Kolik vyučujících Vaše dítě učí?</span></label>
            <input type="number" name="school_teacher_count" id="school_teacher_count">
          </div>

          <div class="qa-block">
            <label id="lbl_school_grading_type"><span>Jaký typ hodnocení se ve škole, kterou dítě navštěvuje,
                používá?</span></label>
            <div class="select-group" role="group" aria-labelledby="lbl_school_grading_type">
              <label><input type="checkbox" name="school_grading_type_grades"><span>Známkování</span></label>
              <label><input type="checkbox" name="school_grading_type_verbal"><span>Slovní hodnocení</span></label>
              <label><input type="checkbox" name="school_grading_type_self"><span>Sebehodnocení dítěte</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_school_performance"><span>Dítěti se z hlediska hodnocení školního prospěchu ve škole daří
                spíše:</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_performance">
              <label><input type="radio" name="school_performance" value="Dobře"><span>Dobře</span></label>
              <label><input type="radio" name="school_performance" value="Špatně"><span>Špatně</span></label>
              <label><input type="radio" name="school_performance" value="Něco mezi"><span>Něco mezi</span></label>
              <label><input type="radio" name="school_performance" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_school_comm_app"><span>Škola pro komunikaci s rodiči ohledně známek, domácích úkolů nebo
                absence využívá:</span></label>
            <div class="select-group" role="group" aria-labelledby="lbl_school_comm_app">
              <label><input type="checkbox" name="school_comm_app"><span>Elektronickou komunikaci, např. systém
                  Bakaláři</span></label>
              <label><input type="checkbox" name="school_comm_notebook"><span>Žákovskou knížku ve fyzické
                  podobě</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_school_homework_exists"><span>Dostává dítě ve škole domácí úkoly?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_homework_exists">
              <label><input type="radio" name="school_homework_exists" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_homework_exists" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_homework_exists" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block qa-group hidden" id="q_school_homework_detail"
            data-controlled-by="school_homework_exists">

            <div class="qa-block">
              <label id="lbl_school_homework_complaints"><span>Stěžují si vyučující, že dítě neplní domácí
                  úkoly?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_homework_complaints">
                <label><input type="radio" name="school_homework_complaints" value="Ano"><span>Ano</span></label>
                <label><input type="radio" name="school_homework_complaints" value="Ne"><span>Ne</span></label>
                <label><input type="radio" name="school_homework_complaints" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>

            <div class="qa-block">
              <label id="lbl_school_homework_tracking"><span>Je třeba, aby si dítě ve škole samo zaznamenávalo úkoly,
                  které má vypracovat doma?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_homework_tracking">
                <label><input type="radio" name="school_homework_tracking" value="Ano"><span>Ano</span></label>
                <label><input type="radio" name="school_homework_tracking" value="Ne"><span>Ne</span></label>
                <label><input type="radio" name="school_homework_tracking" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>

            <div class="qa-block qa-group hidden" id="q_school_homework_tracking_detail"
              data-controlled-by="school_homework_tracking">
              <div class="qa-block">
                <label id="lbl_school_homework_notebook_exists"><span>Má dítě úkolníček nebo jinou pomůcku, do které si
                    úkoly zaznamenává?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_homework_notebook_exists">
                  <label><input type="radio" name="school_homework_notebook_exists" value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="school_homework_notebook_exists" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="school_homework_notebook_exists" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block">
                <label id="lbl_school_homework_tracking_success"><span>Myslíte si, že se dítěti daří poznamenat si ve
                    škole všechny domácí úkoly?</span></label>
                <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_homework_tracking_success">
                  <label><input type="radio" name="school_homework_tracking_success"
                      value="Ano"><span>Ano</span></label>
                  <label><input type="radio" name="school_homework_tracking_success" value="Ne"><span>Ne</span></label>
                  <label><input type="radio" name="school_homework_tracking_success" value="Bez odpovědi"><span>Bez
                      odpovědi</span></label>
                </div>
              </div>
              <div class="qa-block">
                <label id="lbl_school_homework_check"><span>Dítě doma kontroluje úkolníček nebo jinou pomůcku pro
                    zaznamenávání úkolů:</span></label>
                <div class="select-group" role="group" aria-labelledby="lbl_school_homework_check">
                  <label><input type="checkbox" name="school_homework_check_self"><span>Samo</span></label>
                  <label><input type="checkbox" name="school_homework_check_parent"><span>Se mnou</span></label>
                  <label><input type="checkbox" name="school_homework_check_other"><span>S jinou vychovávající
                      osobou</span></label>
                </div>
              </div>
            </div>
            <div class="qa-block">
              <label id="lbl_school_homework_expectation_self"><span>Očekáváte od dítěte, že bude domácí úkoly
                  vypracovávat samo?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_homework_expectation_self">
                <label><input type="radio" name="school_homework_expectation_self" value="Ano"><span>Ano</span></label>
                <label><input type="radio" name="school_homework_expectation_self" value="Ne"><span>Ne</span></label>
                <label><input type="radio" name="school_homework_expectation_self" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>

            <div class="qa-block">
              <label id="lbl_school_homework_do"><span>Dítě vypracovává domácí úkoly:</span></label>
              <div class="select-group" role="group" aria-labelledby="lbl_school_homework_do">
                <label><input type="checkbox" name="school_homework_do_self"><span>Samo</span></label>
                <label><input type="checkbox" name="school_homework_do_parent"><span>Se mnou</span></label>
                <label><input type="checkbox" name="school_homework_do_other"><span>S jinou vychovávající
                    osobou</span></label>
              </div>
            </div>

          </div>


          <div class="qa-block">
            <label for="school_teacher_rating_by_child"><span>Jak dítě hodnotí jeho vyučující v rámci třídních schůzek
                nebo jiné komunikace s Vámi?</span></label>
            <textarea class="long-text" name="school_teacher_rating_by_child"
              id="school_teacher_rating_by_child"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_school_teacher_complaints_general"><span>Stěžují si vyučující opakovaně na něco, co se týká
                Vašeho dítěte?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_teacher_complaints_general">
              <label><input type="radio" name="school_teacher_complaints_general" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_teacher_complaints_general" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_teacher_complaints_general" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_teacher_complaints_detail"
            data-controlled-by="school_teacher_complaints_general">
            <label for="school_teacher_complaints_list"><span>Na co si vyučující stěžují?</span></label>
            <textarea class="long-text" name="school_teacher_complaints_list"
              id="school_teacher_complaints_list"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_school_teacher_praise_exists"><span>Chválí vyučující dítě za něco?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_teacher_praise_exists">
              <label><input type="radio" name="school_teacher_praise_exists" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_teacher_praise_exists" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_teacher_praise_exists" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_teacher_praise_detail"
            data-controlled-by="school_teacher_praise_exists">
            <label for="school_teacher_praise_list"><span>Za co vyučující Vaše dítě chválí?</span></label>
            <textarea class="long-text" name="school_teacher_praise_list" id="school_teacher_praise_list"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_school_seating_type"><span>Školní třída je uspořádána:</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_seating_type">
              <label><input type="radio" name="school_seating_type" value="Po dvou"><span>V lavicích po
                  dvou</span></label>
              <label><input type="radio" name="school_seating_type" value="Jiné"><span>Jiné uspořádání</span></label>
            </div>
          </div>

          <div class="qa-block qa-group hidden" id="q_school_seating_pair_details"
            data-controlled-by="school_seating_type" data-trigger-value="Po dvou">
            <div class="qa-block">
              <label id="lbl_school_seating_partner"><span>Dítě sedí:</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_seating_partner">
                <label><input type="radio" name="school_seating_partner" value="Samo"><span>Samo</span></label>
                <label><input type="radio" name="school_seating_partner" value="S jiným dítětem"><span>S jiným
                    dítětem</span></label>
                <label><input type="radio" name="school_seating_partner" value="S asistentem"><span>S
                    asistentem/kou</span></label>
                <label><input type="radio" name="school_seating_partner" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>
            <div class="qa-block">
              <label id="lbl_school_seating_desk_row"><span>V kolikáté lavici dítě sedí? (počítejte od
                  tabule)</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_seating_desk_row">
                <label><input type="radio" name="school_seating_desk_row" value="1. lavice"><span>1.
                    lavice</span></label>
                <label><input type="radio" name="school_seating_desk_row" value="2. lavice"><span>2.
                    lavice</span></label>
                <label><input type="radio" name="school_seating_desk_row" value="3. lavice"><span>3.
                    lavice</span></label>
                <label><input type="radio" name="school_seating_desk_row" value="4. lavice nebo další"><span>4. lavice
                    nebo další</span></label>
                <label><input type="radio" name="school_seating_desk_row" value="Nelze říci"><span>Nelze
                    říci</span></label>
                <label><input type="radio" name="school_seating_desk_row" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>
            <div class="qa-block">
              <label id="lbl_school_seating_location"><span>Ve které části třídy dítě sedí?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_seating_location">
                <label><input type="radio" name="school_seating_location" value="U dveří"><span>U dveří</span></label>
                <label><input type="radio" name="school_seating_location"
                    value="Uprostřed"><span>Uprostřed</span></label>
                <label><input type="radio" name="school_seating_location" value="U okna"><span>U okna</span></label>
                <label><input type="radio" name="school_seating_location" value="Nelze říci"><span>Nelze
                    říci</span></label>
                <label><input type="radio" name="school_seating_location" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_seating_other_detail" data-controlled-by="school_seating_type"
            data-trigger-value="Jiné">
            <label for="school_seating_other_description"><span>Můžete uspořádání třídy a místo dítěte
                popsat?</span></label>
            <textarea class="long-text" name="school_seating_other_description"
              id="school_seating_other_description"></textarea>
          </div>

          <div class="qa-block">
            <label id="lbl_school_relax_zone_exists"><span>Má školní třída relaxační část?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_relax_zone_exists">
              <label><input type="radio" name="school_relax_zone_exists" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_relax_zone_exists" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_relax_zone_exists" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_relax_zone_detail" data-controlled-by="school_relax_zone_exists">
            <label for="school_relax_zone_rules"><span>Může dítě relaxační část využívat?</span></label>
            <textarea class="long-text" name="school_relax_zone_rules" id="school_relax_zone_rules"></textarea>
          </div>

          <div class="qa-block">
            <label for="school_class_size"><span>Kolik dětí je ve školní třídě?</span></label>
            <input type="number" name="school_class_size" id="school_class_size">
          </div>

          <div class="qa-block">
            <label id="lbl_school_talks_about_friends"><span>Mluví dítě doma o kamarádech?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_talks_about_friends">
              <label><input type="radio" name="school_talks_about_friends" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_talks_about_friends" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_talks_about_friends" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block qa-group hidden" id="q_school_friends_detail"
            data-controlled-by="school_talks_about_friends">
            <div class="qa-block">
              <label id="lbl_school_has_friends"><span>Má někoho, koho považuje za kamaráda/kamarádku?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_has_friends">
                <label><input type="radio" name="school_has_friends" value="Ano"><span>Ano</span></label>
                <label><input type="radio" name="school_has_friends" value="Ne"><span>Ne</span></label>
                <label><input type="radio" name="school_has_friends" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>
            <div class="qa-block">
              <label id="lbl_school_has_longterm_friends"><span>Má nějaké kamarády/ky, o kterých mluví
                  dlouhodobě?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_has_longterm_friends">
                <label><input type="radio" name="school_has_longterm_friends" value="Ano"><span>Ano</span></label>
                <label><input type="radio" name="school_has_longterm_friends" value="Ne"><span>Ne</span></label>
                <label><input type="radio" name="school_has_longterm_friends" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>
          </div>
          <div class="qa-block">
            <label id="lbl_school_complains_about_peers"><span>Stěžuje si na některé spolužáky nebo
                spolužačky?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_complains_about_peers">
              <label><input type="radio" name="school_complains_about_peers" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_complains_about_peers" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_complains_about_peers" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block qa-group hidden" id="q_school_complains_peers_detail"
            data-controlled-by="school_complains_about_peers">
            <div class="qa-block">
              <label id="lbl_school_complains_peers_longterm"><span>Stěžuje si na někoho dlouhodobě?</span></label>
              <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_complains_peers_longterm">
                <label><input type="radio" name="school_complains_peers_longterm" value="Ano"><span>Ano</span></label>
                <label><input type="radio" name="school_complains_peers_longterm" value="Ne"><span>Ne</span></label>
                <label><input type="radio" name="school_complains_peers_longterm" value="Bez odpovědi"><span>Bez
                    odpovědi</span></label>
              </div>
            </div>
          </div>
          <div class="qa-block">
            <label id="lbl_school_complains_other"><span>Stěžuje si dítě na něco jiného ohledně školy?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_school_complains_other">
              <label><input type="radio" name="school_complains_other" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="school_complains_other" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="school_complains_other" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block hidden" id="q_school_complains_other_detail" data-controlled-by="school_complains_other">
            <label for="school_complaints_other_text"><span>Na co si dítě stěžuje?</span></label>
            <textarea class="long-text" name="school_complaints_other_text"
              id="school_complaints_other_text"></textarea>
          </div>

          <div class="qa-block">
            <label for="school_hours_per_week"><span>Kolik hodin týdně dítě tráví ve škole? (započítejte, prosím,
                případné doučování a podobné aktivity)</span></label>
            <input type="number" name="school_hours_per_week" id="school_hours_per_week">
          </div>

        </div>
      </fieldset>

      <fieldset>
        <legend>Kroužky a zájmy</legend>

        <div class="tip-block tip-block-under">
          Volnočasové aktivity tvoří důležitou součást života dítěte a mohou přispívat k jeho psychické pohodě,
          sociálním dovednostem i schopnosti regulovat chování. Způsob, jakým dítě tráví volný čas, nám zároveň
          napovídá, v jakých oblastech může zažívat úspěch a z čeho naopak může být vyčerpané.
        </div>

        <div class="qa-block">
          <label id="lbl_hobbies_fav_exists"><span>Má dítě nějakou volnočasovou aktivitu, která jej hodně baví nebo jí
              dokáže trávit hodně času?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_hobbies_fav_exists">
            <label><input type="radio" name="hobbies_fav_exists" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="hobbies_fav_exists" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="hobbies_fav_exists" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block hidden" id="q_hobbies_fav_detail" data-controlled-by="hobbies_fav_exists">
          <label for="hobbies_fav_activity"><span>Jaká aktivita to je?</span></label>
          <input class="short-text" type="text" name="hobbies_fav_activity" id="hobbies_fav_activity">
        </div>

        <div class="qa-block">
          <label id="lbl_hobbies_clubs_exists"><span>Navštěvuje dítě nějaké zájmové kroužky?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_hobbies_clubs_exists">
            <label><input type="radio" name="hobbies_clubs_exists" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="hobbies_clubs_exists" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="hobbies_clubs_exists" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block qa-group hidden" id="q_hobbies_clubs_detail" data-controlled-by="hobbies_clubs_exists">
          <div class="qa-block">
            <label for="hobbies_clubs_count"><span>Kolik kroužků navštěvuje?</span></label>
            <input type="number" name="hobbies_clubs_count" id="hobbies_clubs_count" min="0">
          </div>
          <div class="qa-block">
            <label for="hobbies_clubs_list"><span>Jaké kroužky dítě navštěvuje? (vypište)</span></label>
            <textarea class="long-text" name="hobbies_clubs_list" id="hobbies_clubs_list"></textarea>
          </div>
          <div class="qa-block">
            <label for="hobbies_clubs_hours"><span>Kolik hodin týdně tráví dítě v kroužcích?</span></label>
            <input type="number" name="hobbies_clubs_hours" id="hobbies_clubs_hours" min="0">
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Doma</legend>

        <div class="tip-block tip-block-under">
          V domácím prostředí dítě odpočívá, učí se, hraje si a tráví velkou část času mimo školu. Způsob, jakým dítě
          doma funguje, významně ovlivňuje nejen jeho emoční stabilitu, ale i schopnost zvládat požadavky školy.
        </div>

        <div class="qa-block">
          <label id="lbl_home_chores_exists"><span>Má dítě nějaké domácí povinnosti (např. úklid pokoje)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_chores_exists">
            <label><input type="radio" name="home_chores_exists" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="home_chores_exists" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="home_chores_exists" value="Bez odpovědi"><span>Bez odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block qa-group hidden" id="q_home_chores_detail" data-controlled-by="home_chores_exists">
          <div class="qa-block">
            <label for="home_chores_expectation"><span>Jaké domácí povinnosti by dítě podle Vás mělo být schopno
                splnit?</span></label>
            <input class="short-text" type="text" name="home_chores_expectation" id="home_chores_expectation">
          </div>

          <div class="qa-block">
            <label id="lbl_home_chores_success"><span>Daří se mu domácí povinnosti plnit?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_chores_success">
              <label><input type="radio" name="home_chores_success" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="home_chores_success" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="home_chores_success" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_home_chores_self_check"><span>Dokáže si dítě samo kontrolovat plnění domácích
                povinností?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_chores_self_check">
              <label><input type="radio" name="home_chores_self_check" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="home_chores_self_check" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="home_chores_self_check" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>
        </div>

        <div class="qa-block">
          <label id="lbl_home_request_compliance"><span>Zvládne dítě doma udělat něco, o co jej požádáte (např. něco
              donést, s něčím pomoci)?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_request_compliance">
            <label><input type="radio" name="home_request_compliance" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="home_request_compliance" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="home_request_compliance" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block">
          <label id="lbl_home_conflicts_exists"><span>Máte doma s dítětem často konflikty?</span></label>
          <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_conflicts_exists">
            <label><input type="radio" name="home_conflicts_exists" value="Ano"><span>Ano</span></label>
            <label><input type="radio" name="home_conflicts_exists" value="Ne"><span>Ne</span></label>
            <label><input type="radio" name="home_conflicts_exists" value="Bez odpovědi"><span>Bez
                odpovědi</span></label>
          </div>
        </div>

        <div class="qa-block qa-group hidden" id="q_home_conflicts_detail" data-controlled-by="home_conflicts_exists">
          <div class="qa-block">
            <label id="lbl_home_conflicts_resolution"><span>Máte pocit, že konflikty zvládáte řešit tak, jak byste
                chtěl*a?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_conflicts_resolution">
              <label><input type="radio" name="home_conflicts_resolution" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="home_conflicts_resolution" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="home_conflicts_resolution" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>

          <div class="qa-block">
            <label id="lbl_home_conflicts_help"><span>Ocenil*a byste radu nebo pomoc ohledně toho, jak konflikty
                řešit?</span></label>
            <div class="select-group" role="radiogroup" aria-labelledby="lbl_home_conflicts_help">
              <label><input type="radio" name="home_conflicts_help" value="Ano"><span>Ano</span></label>
              <label><input type="radio" name="home_conflicts_help" value="Ne"><span>Ne</span></label>
              <label><input type="radio" name="home_conflicts_help" value="Bez odpovědi"><span>Bez
                  odpovědi</span></label>
            </div>
          </div>
        </div>

        <div class="qa-block">
          <label for="general_main_concern"><span>Co Vás obecně ohledně dítěte nejvíce trápí?</span></label>
          <textarea class="long-text" name="general_main_concern" id="general_main_concern"></textarea>
        </div>
      </fieldset>


      <!-- Summary table -->
      <div class="summary-container" id="summary-container">
        <div class="summary-header" onclick="toggleSummaryDetails()">
          <div class="summary-stats">
            <div class="stat-item stat-answered">
              <span class="stat-value" id="count-answered">0</span>
              <span class="stat-label">Odpovězené</span>
            </div>
            <div class="stat-item stat-refused">
              <span class="stat-value" id="count-refused">0</span>
              <span class="stat-label">Nechci odpovídat</span>
            </div>
            <div class="stat-item stat-empty">
              <span class="stat-value" id="count-empty">0</span>
              <span class="stat-label">Prázdné</span>
            </div>
          </div>
          <div class="toggle-icon">
            <span id="summary-toggle-text">Zobrazit detaily</span>
            <span id="summary-arrow">▼</span>
          </div>
        </div>

        <div class="summary-details" id="summary-details-body">
          <div id="summary-empty-msg"
            style="padding: 20px; text-align: center; color: #888; font-style: italic; display: none;">
            Všechny položky jsou zodpovězené.
          </div>
          <ul class="summary-list" id="summary-list">
          </ul>
        </div>
      </div>




      <!-- Save and Share Options -->
      <div class="instruction-block sharing-options">
        <p>Dorazili jste na konec dotazníku. Nyní máte dvě možnosti, jak své odpovědi sdílet se specialistou.</p>
        <ul>
          <li><strong>Uložit do souboru:</strong> Stáhne vaše odpovědi jako soubor, který můžete předat specialistovi
            nebo si jej uložit pro příště.</li>
          <li><strong>Náhled tisku/PDF:</strong> Zobrazí vaše odpovědi ve formátu diagnostické zprávy pro tisk nebo
            uložení do PDF.</li>
        </ul>

        <p>V závislosti na dohodě se specialistou vyberte preferovnou variantu. Pokud si nejste jisti, je lepší zvolit
          <strong>Uložit do souboru</strong> a soubor přinést specialistovi (například na USB disku). Specialista může
          vaše odpovědi převést do PDF později sám.
        </p>



        <div
          style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 20px;">
          <div class="save-buttons">
            <button type="button" class="btn primary" onclick="saveAsJsonFile()">Uložit do souboru</button>
            <button type="button" class="btn primary" id="preview-button" onclick="togglePrintPreview()">Náhled tisku /
              PDF</button>
          </div>
          <button type="button" class="btn btn-secondary" onclick="saveForm(true)" style="margin-left: auto;">Průběžně
            uložit</button>
        </div>

        <div class="manual-alert">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            style="flex-shrink: 0; color: var(--color-warning);">
            <path
              d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z" />
            <path d="M12 8v4" />
            <path d="M12 16h.01" />
          </svg>
          <div>
            <strong>Upozornění k ochraně dat:</strong>
            <span>Data v uloženém souboru mohou být citlivé povahy.
              Některé nezabezpečené formy sdílení, například skrze e-mail, mohou nést rizika. Upřednostněte raději
              předání osobně (USB disk) nebo skrze jiné zabezpečené cesty.</span><br><br>
            <span> Pokud jste vyplnili dotazník na veřejném zařízení, nezapomeňte po uložení nebo exportu
              <span class="alert-action-link" onclick="clearHistory()">vymazat dotazník a průběžně uložená data</span>.
            </span>
          </div>

        </div>
      </div>

      <footer class="page-footer">
        <p>© 2026 MUNI FSS, Diagnostika dítěte</p>
        <p>Licence <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.cs" target="_blank">CC BY-NC-ND
            4.0</a></p>
      </footer>

    </form>
  </main>

  <input type="file" id="json-file-input" accept=".json" style="display: none;" aria-label="Načíst soubor JSON">

  <!-- Floating controls for Print Preview -->
  <aside class="preview-controls" aria-label="Ovládání náhledu">
    <button type="button" class="btn btn-secondary" onclick="togglePrintPreview()">Zpět</button>
    <button type="button" class="btn primary" onclick="printWithUnansweredMarks()">Tisk/PDF</button>
  </aside>

  <script>


    // Age calculation
    const birthInput = document.getElementById('child_birthdate');
    const ageInput = document.getElementById('child_age');

    function formatYearsCzech(years) {
      if (years === 1) return '1 rok';
      if (years >= 2 && years <= 4) return `${years} roky`;
      return `${years} let`;
    }

    function formatMonthsCzech(months) {
      if (months === 1) return '1 měsíc';
      if (months >= 2 && months <= 4) return `${months} měsíce`;
      return `${months} měsíců`;
    }

    /* --- SMART NAVIGATION LOGIC --- */

    function toggleSmartNav() {
      document.getElementById('smart-nav').classList.toggle('is-expanded');
    }

    function initSmartNav() {
      const fieldsets = Array.from(document.querySelectorAll('#questionnaire > fieldset'));
      const track = document.getElementById('nav-segments-track');
      const grid = document.getElementById('nav-grid');

      // Setup Segments
      track.innerHTML = '';
      grid.innerHTML = '';

      fieldsets.forEach((fieldset, index) => {
        const legend = fieldset.querySelector('legend').textContent;

        // Create Segment
        const segment = document.createElement('div');
        segment.className = 'segment';
        segment.id = `nav-seg-${index}`;

        const fill = document.createElement('div');
        fill.className = 'segment-fill';
        segment.appendChild(fill);
        track.appendChild(segment);

        // Create Grid Item
        const item = document.createElement('div');
        item.className = 'nav-item';
        item.id = `nav-item-${index}`;
        item.onclick = () => {
          // Prioritize the HEADING (legend) so the user sees the section title first
          const target = fieldset.querySelector('legend') || fieldset.querySelector('.qa-block') || fieldset;

          if (target) {
            // Dynamic offset: positions the heading at ~45% of the screen height (responsive)
            const headerOffset = window.innerHeight * 0.35;
            const elementPosition = target.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.scrollY - headerOffset;

            window.scrollTo({
              top: offsetPosition,
              behavior: "smooth"
            });
          }

          // Collapse nav if on mobile OR if the expanded menu blocks the view of the section header
          // The header is positioned at `headerOffset` (35% of viewport height).
          // If the menu extends below this point, it obstructs the view.
          const smartNav = document.getElementById('smart-nav');
          const headerOffset = window.innerHeight * 0.35; // Must match the scroll offset calculation above

          if (window.innerWidth <= 850 || (smartNav.classList.contains('is-expanded') && smartNav.offsetHeight > headerOffset)) {
            smartNav.classList.remove('is-expanded');
          }
        };

        item.innerHTML = `
            <div class="nav-item-row">
                <div class="nav-item-icon status-todo" id="nav-icon-${index}">●</div>
                <div class="nav-item-text">${legend}</div>
                <div class="nav-item-meta" id="nav-meta-${index}">0 %</div>
            </div>
            <div class="nav-item-progress-track">
                <div class="nav-item-progress-fill" id="nav-item-fill-${index}"></div>
            </div>
        `;
        grid.appendChild(item);
      });

      // Scroll Spy Logic
      const handleScrollSpy = () => {
        const viewportHeight = window.innerHeight;
        // Trigger line slightly below the scroll target (0.35) so the section header is "above" or crossing it
        const triggerLine = viewportHeight * 0.38;

        let closestIndex = -1;
        let minDistance = Infinity;

        fieldsets.forEach((fieldset, index) => {
          const rect = fieldset.getBoundingClientRect();
          const navItem = document.getElementById(`nav-item-${index}`);

          // Reset active status
          if (navItem) {
            navItem.classList.remove('active');
          }

          // Distance to trigger line
          let dist = 0;
          if (rect.top > triggerLine) dist = rect.top - triggerLine;
          else if (rect.bottom < triggerLine) dist = triggerLine - rect.bottom;

          if (dist < minDistance) {
            minDistance = dist;
            closestIndex = index;
          }
        });

        if (closestIndex !== -1) {
          const activeItem = document.getElementById(`nav-item-${closestIndex}`);
          if (activeItem) activeItem.classList.add('active');
        }
      };

      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            handleScrollSpy();
            ticking = false;
          });
          ticking = true;
        }
      });

      // Initial call
      handleScrollSpy();

      updateProgressBar(); // Initial calculation
    }

    function updateProgressBar() {
      const fieldsets = Array.from(document.querySelectorAll('#questionnaire > fieldset'));

      let totalProgress = 0;

      fieldsets.forEach((fieldset, index) => {
        const allBlocks = Array.from(fieldset.querySelectorAll('.qa-block'))
          .filter(block => {
            const hasDirectLabel = Array.from(block.children).some(child => child.tagName === 'LABEL');
            const isAgeField = block.querySelector('#child_age');
            return hasDirectLabel && !isAgeField;
          });

        let points = 0;
        let total = allBlocks.length;

        if (total > 0) {
          allBlocks.forEach(block => {
            const input = block.querySelector('input:not([type="radio"]):not([type="checkbox"]), textarea, select');
            const radioChecked = block.querySelector('input[type="radio"]:checked');
            const checkboxChecked = block.querySelector('input[type="checkbox"]:checked');

            const isAnswered = (input && input.value.trim() !== "") || radioChecked || checkboxChecked;

            if (isAnswered) {
              points++;
            } else {
              // PŮVODNÍ LOGIKA ATRIBUTŮ: Započítá se pouze, pokud je trigger AKTIVNĚ nastaven jinak
              let currentEl = block;
              let logicallySkipped = false;
              let skippingController = null;

              while (currentEl && currentEl !== document.body) {
                const controlId = currentEl.getAttribute('data-controlled-by') ||
                  (currentEl.closest('[data-controlled-by]') ? currentEl.closest('[data-controlled-by]').getAttribute('data-controlled-by') : null);

                if (controlId) {
                  const requiredValue = currentEl.closest('[data-trigger-value]') ?
                    currentEl.closest('[data-trigger-value]').getAttribute('data-trigger-value') : "Ano";
                  const trigger = document.querySelector(`input[name="${controlId}"]:checked`);

                  // Změna: Pokud trigger není vybrán (null), logicallySkipped zůstává false.
                  // Sekce se započítá jako "hotová" jen tehdy, když uživatel vybral hodnotu, která ji vylučuje.
                  if (trigger && trigger.value !== requiredValue) {
                    logicallySkipped = true;
                    skippingController = controlId;
                    break;
                  }
                }
                currentEl = currentEl.parentElement;
              }

              if (logicallySkipped) {
                // EXCEPTION: For respondent_relation, do not count skipped items as done points.
                // Instead, remove them from the total count to avoid massive progress jumps.
                if (skippingController === 'respondent_relation') {
                  total--;
                } else {
                  points++;
                }
              }
            }
          });
        }

        // Finální výpočet procenta pro tento konkrétní segment
        let percentage = 0;
        if (total > 0) {
          percentage = Math.round((points / total) * 100);
        } else {
          percentage = 100;
        }

        // Update Segment
        const segment = document.getElementById(`nav-seg-${index}`);
        if (segment) {
          const fill = segment.querySelector('.segment-fill');
          if (fill) fill.style.width = percentage + "%";

          if (percentage >= 100) segment.classList.add('completed');
          else segment.classList.remove('completed');
        }

        // Update Grid Item Progress Bar
        const itemFill = document.getElementById(`nav-item-fill-${index}`);
        if (itemFill) {
          itemFill.style.width = percentage + "%";
          if (percentage >= 100) itemFill.classList.add('completed');
          else itemFill.classList.remove('completed');
        }

        // Update Grid Item
        const icon = document.getElementById(`nav-icon-${index}`);
        const meta = document.getElementById(`nav-meta-${index}`);

        if (icon && meta) {
          if (percentage >= 100) {
            icon.className = 'nav-item-icon status-done';
            icon.textContent = '✔';
            meta.className = 'nav-item-meta';
            meta.textContent = 'Hotovo';
          } else {
            icon.className = 'nav-item-icon status-todo';
            icon.textContent = index + 1;
            meta.className = 'nav-item-meta missing';
            meta.textContent = `${percentage} %`;
          }
        }

        totalProgress += percentage;
      });

      // Update Global Percentage
      const globalPercent = Math.round(totalProgress / fieldsets.length);
      window.currentGlobalPercent = globalPercent; // Expose global percent for visibility logic

      const textEl = document.getElementById('nav-progress-text');
      if (textEl) textEl.textContent = `${globalPercent}%`;

      const globalFill = document.getElementById('nav-global-fill');
      if (globalFill) {
        globalFill.style.width = `${globalPercent}%`;
        if (globalPercent >= 100) globalFill.classList.add('completed');
        else globalFill.classList.remove('completed');
      }

      // Update visibility based on new percent
      handleProgressBarVisibility();
    }

    /**
     * OVLÁDÁNÍ VIDITELNOSTI PROGRESS BARU PŘI SCROLLOVÁNÍ
     */
    function handleProgressBarVisibility() {
      const bar = document.getElementById('smart-nav');
      const firstFieldset = document.querySelector('fieldset'); // Zaměříme se na první sekci otázek

      if (!bar || !firstFieldset) return;

      // Získáme pozici horního okraje prvního fieldsetu
      const rect = firstFieldset.getBoundingClientRect();

      const percent = window.currentGlobalPercent || 0;

      // Show ONLY if NOT at the very top AND (scrolled past 40% of viewport OR started filling)
      if (window.scrollY > 0 && (rect.top <= window.innerHeight * 0.4 || percent > 0)) {
        bar.classList.add('is-visible');
      } else {
        bar.classList.remove('is-visible');
      }
    }

    // Přidáme posluchač na událost scroll
    window.addEventListener('scroll', handleProgressBarVisibility);

    // Zavoláme i při načtení (pro případ, že by uživatel stránku refreshnul už odscrollovanou)
    document.addEventListener('DOMContentLoaded', handleProgressBarVisibility);

    // setupConditional that supports radio groups and <select>
    const conditionalUpdateFunctions = [];

    function setupConditional(selectName, detailId, triggerValue = 'Ano') {
      const detailDiv = document.getElementById(detailId);
      if (!detailDiv) return; // Exit if the detail element doesn't exist

      const radios = Array.from(document.querySelectorAll(`[name="${selectName}"]`));
      const isRadioGroup = radios.length > 1 || (radios.length === 1 && radios[0].type === 'radio');

      let update;

      if (isRadioGroup) {
        update = () => {
          const checked = document.querySelector(`[name="${selectName}"]:checked`);
          const shouldShow = checked && checked.value === triggerValue;
          detailDiv.classList.toggle('is-visible', shouldShow);
          updateProgressBar();
          updateQuestionnaireSummary();
        };

        radios.forEach(r => r.addEventListener('change', update));
      } else {
        // Single select or input
        const elem = document.querySelector(`[name="${selectName}"]`);
        if (!elem) return;

        update = () => {
          const shouldShow = elem.value === triggerValue;
          detailDiv.classList.toggle('is-visible', shouldShow);
          updateProgressBar();
          updateQuestionnaireSummary();
        };

        elem.addEventListener('change', update);
      }

      if (update) {
        update(); // Initial check
        conditionalUpdateFunctions.push(update);
      }
    }

    function updateAllConditionals() {
      conditionalUpdateFunctions.forEach(fn => fn());
    }

    setupConditional('mother_health', 'q_mother_health_detail', 'Ano');
    setupConditional('father_health', 'q_father_health_detail', 'Ano');
    setupConditional('other_carer_status', 'q_other_carer_detail', 'Ano');
    document.querySelectorAll('input[name="other_carer_status"]').forEach(r => {
      r.addEventListener('change', (e) => {
        if (e.target.value === 'Ano') {
          const container = document.getElementById('additional_carers_container');
          if (container && container.children.length === 0) addCarer();
        }
      });
    });
    setupConditional('mother_employed', 'q_mother_jobs_detail', 'Ano');
    setupConditional('father_employed', 'q_father_jobs_detail', 'Ano');
    setupConditional('has_siblings', 'q_siblings_detail', 'Ano');
    document.querySelectorAll('input[name="has_siblings"]').forEach(r => {
      r.addEventListener('change', (e) => {
        if (e.target.value === 'Ano') {
          const container = document.getElementById('siblings_container');
          if (container && container.children.length === 0) addSibling();
        }
      });
    });
    setupConditional('child_has_device', 'q_child_device_details', 'Ano');
    setupConditional('neurolog_exam', 'q_neurolog_exam_detail', 'Ano');
    setupConditional('chronic_illnesses_status', 'q_chronic_illnesses_detail', 'Ano');
    setupConditional('past_health_issues_status', 'q_past_health_issues_detail', 'Ano');
    setupConditional('vision_issues', 'q_vision_issues_detail', 'Ano');
    setupConditional('hearing_issues', 'q_hearing_issues_detail', 'Ano');
    setupConditional('housing_type', 'q_housing_specification_detail', 'Jiné');

    setupConditional('attends_kindergarten', 'q_kindergarten_details', 'Ano');
    setupConditional('kg_morning_issues', 'q_morning_issues_detail', 'Ano');

    // --- Logika pro sekci Škola ---
    setupConditional('kg_preschool_prep', 'q_kg_prep_progress_detail', 'Ano');
    setupConditional('attends_school', 'q_school_details', 'Ano');
    setupConditional('school_first_grade', 'q_school_first_grade_history', 'Ano');
    setupConditional('school_fav_subjects_exists', 'q_school_fav_subjects_detail', 'Ano');
    setupConditional('school_disliked_subjects_exists', 'q_school_disliked_subjects_detail', 'Ano');
    setupConditional('school_homework_tracking', 'q_school_homework_tracking_detail', 'Ano');
    setupConditional('school_teacher_complaints_general', 'q_school_teacher_complaints_detail', 'Ano');
    setupConditional('school_teacher_praise_exists', 'q_school_teacher_praise_detail', 'Ano');
    setupConditional('school_homework_exists', 'q_school_homework_detail', 'Ano');

    // Podmínky pro sezení
    setupConditional('school_seating_type', 'q_school_seating_pair_details', 'Po dvou');
    setupConditional('school_seating_type', 'q_school_seating_other_detail', 'Jiné');

    setupConditional('school_relax_zone_exists', 'q_school_relax_zone_detail', 'Ano');
    setupConditional('school_talks_about_friends', 'q_school_friends_detail', 'Ano');
    setupConditional('school_complains_about_peers', 'q_school_complains_peers_detail', 'Ano');
    setupConditional('school_complains_other', 'q_school_complains_other_detail', 'Ano');


    // --- Logika pro sekci Kroužky a zájmy/Doma ---
    setupConditional('hobbies_fav_exists', 'q_hobbies_fav_detail', 'Ano');
    setupConditional('hobbies_clubs_exists', 'q_hobbies_clubs_detail', 'Ano');
    setupConditional('home_chores_exists', 'q_home_chores_detail', 'Ano');
    setupConditional('home_conflicts_exists', 'q_home_conflicts_detail', 'Ano');



    // Rodinná anamníza
    // Registrace hlavní skupiny
    setupConditional('respondent_relation', 'group_bio_parents_combined', 'Biologický rodič');
    setupConditional('respondent_relation', 'group_stepparent_combined', 'Vychovávající rodič');
    setupConditional('respondent_relation', 'group_other_combined', 'Jiný vztah');

    // Registrace vnořených podmínek pro Biologického rodiče 1 (Vy)
    setupConditional('bio_p1_job_status', 'q_bio_p1_job_detail', 'Ano');
    setupConditional('bio_p1_mental', 'q_bio_p1_mental_detail', 'Ano');
    setupConditional('bio_p1_physical', 'q_bio_p1_physical_detail', 'Ano');

    // Registrace vnořených podmínek pro Biologického rodiče 2 (Druhý rodič)
    setupConditional('bio_p2_job_status', 'q_bio_p2_job_detail', 'Ano');
    setupConditional('bio_p2_mental', 'q_bio_p2_mental_detail', 'Ano');
    setupConditional('bio_p2_physical', 'q_bio_p2_physical_detail', 'Ano');

    // Respondent (Nevlastní rodič)
    setupConditional('step_resp_job_status', 'q_step_resp_job_detail', 'Ano');
    setupConditional('step_resp_mental', 'q_step_resp_mental_detail', 'Ano');
    setupConditional('step_resp_physical', 'q_step_resp_physical_detail', 'Ano');

    // Respondent (Nevlastní rodič) Bio Matka
    setupConditional('step_bio_m_mental', 'q_step_bio_m_mental_detail', 'Ano');
    setupConditional('step_bio_m_physical', 'q_step_bio_m_physical_detail', 'Ano');

    // Respondent (Nevlastní rodič) Bio Otec
    setupConditional('step_bio_f_mental', 'q_step_bio_f_mental_detail', 'Ano');
    setupConditional('step_bio_f_physical', 'q_step_bio_f_physical_detail', 'Ano');

    // Respondent (Jiný vztah)
    setupConditional('other_resp_job_status', 'q_other_resp_job_detail', 'Ano');
    setupConditional('other_resp_mental', 'q_other_resp_mental_detail', 'Ano');
    setupConditional('other_resp_physical', 'q_other_resp_physical_detail', 'Ano');

    // Respondent (Jiný vztah) Bio Matka
    setupConditional('other_bio_m_mental', 'q_other_bio_m_mental_detail', 'Ano');
    setupConditional('other_bio_m_physical', 'q_other_bio_m_physical_detail', 'Ano');

    // Respondent (Jiný vztah) Bio Otec
    setupConditional('other_bio_f_mental', 'q_other_bio_f_mental_detail', 'Ano');
    setupConditional('other_bio_f_physical', 'q_other_bio_f_physical_detail', 'Ano');


    // Auto-expand and retract textarea with padding only after first character
    function autoExpandTextarea(textarea) {
      textarea.style.height = 'auto'; // Reset height to recalc scrollHeight

      const style = getComputedStyle(textarea);
      const lineHeight = parseFloat(style.lineHeight) || 24;
      const numLines = Math.round(textarea.scrollHeight / lineHeight);

      // Only add padding if textarea has at least one character
      const hasContent = textarea.value.trim().length > 0;
      const basePadding = hasContent ? 10 : 0; // 0 if empty, else 10px
      const extraPadding = hasContent ? (numLines - 1) * 10 : 0;
      const padding = Math.min(basePadding + extraPadding, 50);

      textarea.style.height = `${textarea.scrollHeight + padding}px`;
    }

    // Apply to all long-text textareas
    document.querySelectorAll('textarea.long-text').forEach(area => {
      area.addEventListener('input', () => autoExpandTextarea(area));
      // Initialize height in case of prefilled content
      autoExpandTextarea(area);
    });



    // Dynamic generation for additional carers
    function addCarer(data = null) {
      const container = document.getElementById('additional_carers_container');
      const index = container.children.length + 1;
      const fs = document.createElement('fieldset');
      fs.className = 'style-soft dynamic-item';

      fs.innerHTML = `
    <div class="style-soft-header">
        <legend>Další osoba ${index}</legend>
        <button type="button" class="btn-remove-3" onclick="removeDynamicItem(this)">✖ Odebrat</button>
    </div>
    <div class="style-soft-body">
    <div class="qa-block">
      <label for="carer_${index}_relation"><span>V jakém vztahu je osoba s dítětem (případně s vámi)?</span></label>
      <input class="short-text" type="text" name="carer_${index}_relation" id="carer_${index}_relation">
    </div>
    <div class="qa-block">
      <label for="carer_${index}_age"><span>Věk:</span></label>
      <input type="number" name="carer_${index}_age" id="carer_${index}_age">
    </div>
    <div class="qa-block">
      <label id="lbl_carer_${index}_mental"><span>Má nějaké duševní obtíže?</span></label>
      <div class="select-group" role="radiogroup" aria-labelledby="lbl_carer_${index}_mental">
        <label><input type="radio" name="carer_${index}_mental" value="Ano"><span>Ano</span></label>
        <label><input type="radio" name="carer_${index}_mental" value="Ne"><span>Ne</span></label>
        <label><input type="radio" name="carer_${index}_mental" value="Bez odpovědi"><span>Bez odpovědi</span></label>
      </div>
    </div>
    <div class="qa-block hidden" id="q_carer_${index}_mental_detail" data-controlled-by="carer_${index}_mental">
      <label for="carer_${index}_mental_text"><span>Jaké duševní obtíže to jsou?</span></label>
      <textarea class="long-text" name="carer_${index}_mental_text" id="carer_${index}_mental_text"></textarea>
    </div>
    <div class="qa-block">
      <label id="lbl_carer_${index}_physical"><span>Má nějaká fyzická omezení (např. nemoci, hendikep)?</span></label>
      <div class="select-group" role="radiogroup" aria-labelledby="lbl_carer_${index}_physical">
        <label><input type="radio" name="carer_${index}_physical" value="Ano"><span>Ano</span></label>
        <label><input type="radio" name="carer_${index}_physical" value="Ne"><span>Ne</span></label>
        <label><input type="radio" name="carer_${index}_physical" value="Bez odpovědi"><span>Bez odpovědi</span></label>
      </div>
    </div>
    <div class="qa-block hidden" id="q_carer_${index}_physical_detail" data-controlled-by="carer_${index}_physical">
      <label for="carer_${index}_physical_text"><span>Jaká fyzická omezení to jsou?</span></label>
      <textarea class="long-text" name="carer_${index}_physical_text" id="carer_${index}_physical_text"></textarea>
    </div>
    </div>
  `;

      container.appendChild(fs);

      // Attach listeners for conditional logic
      const mentalRadios = fs.querySelectorAll(`input[name^="carer_"][name$="_mental"]`);
      mentalRadios.forEach(r => r.addEventListener('change', () => {
        const currentName = r.name;
        const match = currentName.match(/_(\d+)_/);
        if (match) {
          const currentIndex = match[1];
          const targetId = `q_carer_${currentIndex}_mental_detail`;
          const target = document.getElementById(targetId);
          if (target) {
            target.classList.toggle('is-visible', r.value === 'Ano');
            updateProgressBar();
            updateQuestionnaireSummary();
          }
        }
      }));

      const physicalRadios = fs.querySelectorAll(`input[name^="carer_"][name$="_physical"]`);
      physicalRadios.forEach(r => r.addEventListener('change', () => {
        const currentName = r.name;
        const match = currentName.match(/_(\d+)_/);
        if (match) {
          const currentIndex = match[1];
          const targetId = `q_carer_${currentIndex}_physical_detail`;
          const target = document.getElementById(targetId);
          if (target) {
            target.classList.toggle('is-visible', r.value === 'Ano');
            updateProgressBar();
            updateQuestionnaireSummary();
          }
        }
      }));

      // Auto-expand textareas
      fs.querySelectorAll('textarea.long-text').forEach(area => {
        area.addEventListener('input', () => autoExpandTextarea(area));
        autoExpandTextarea(area);
      });

      // Pre-fill data if provided
      if (data) {
        const inputs = fs.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
          if (data[input.name] !== undefined) {
            if (input.type === 'radio' || input.type === 'checkbox') {
              if (input.value === data[input.name]) input.checked = true;
            } else {
              input.value = data[input.name];
            }
          }
        });
        // Trigger change events to show/hide details
        mentalRadios.forEach(r => { if (r.checked) r.dispatchEvent(new Event('change')); });
        physicalRadios.forEach(r => { if (r.checked) r.dispatchEvent(new Event('change')); });
      }

      validateAllQuestions();
      updateProgressBar();
      updateQuestionnaireSummary();
    }

    // Dynamic generation for siblings
    function addSibling(data = null) {
      const container = document.getElementById('siblings_container');
      const index = container.children.length + 1;
      const fs = document.createElement('fieldset');
      fs.className = 'style-soft dynamic-item';

      fs.innerHTML = `
    <div class="style-soft-header">
        <legend>Sourozenec ${index}</legend>
        <button type="button" class="btn-remove-3" onclick="removeDynamicItem(this)">× Odebrat</button>
    </div>
    <div class="style-soft-body">
    <div class="qa-block">
      <label for="sibling_${index}_name"><span>Jméno sourozence:</span></label>
      <input class="short-text" type="text" name="sibling_${index}_name" id="sibling_${index}_name">
    </div>
    <div class="qa-block">
      <label for="sibling_${index}_age"><span>Věk sourozence:</span></label>
      <input type="number" name="sibling_${index}_age" id="sibling_${index}_age">
    </div>
    <div class="qa-block">
      <label id="lbl_sibling_${index}_biological_parents"><span>Mají dítě a sourozenec stejné biologické rodiče?</span></label>
      <div class="select-group" role="radiogroup" aria-labelledby="lbl_sibling_${index}_biological_parents">
        <label><input type="radio" name="sibling_${index}_biological_parents" value="Ano, oba"><span>Ano, oba</span></label>
        <label><input type="radio" name="sibling_${index}_biological_parents" value="Ano, jednoho"><span>Ano, jednoho</span></label>
        <label><input type="radio" name="sibling_${index}_biological_parents" value="Ne"><span>Ne</span></label>
        <label><input type="radio" name="sibling_${index}_biological_parents" value="Bez odpovědi"><span>Bez odpovědi</span></label>
      </div>
    </div>
    <div class="qa-block">
      <label id="lbl_sibling_${index}_same_household"><span>Žijí ve stejné domácnosti:</span></label>
      <div class="select-group" role="radiogroup" aria-labelledby="lbl_sibling_${index}_same_household">
        <label><input type="radio" name="sibling_${index}_same_household" value="Ano"><span>Ano</span></label>
        <label><input type="radio" name="sibling_${index}_same_household" value="Ne"><span>Ne</span></label>
        <label><input type="radio" name="sibling_${index}_same_household" value="Bez odpovědi"><span>Bez odpovědi</span></label>
      </div>
    </div>
        <div class="qa-block">
        <label for="sibling_${index}_diagnoses"><span>Má sourozenec nějaké fyzické nebo psychické obtíže?</span></label>
        <textarea class="long-text" name="sibling_${index}_diagnoses" id="sibling_${index}_diagnoses"></textarea>
    </div>
    <div class="qa-block">
        <label for="sibling_${index}_relationship"><span>Jak vypadá vztah sourozence a dítěte?</span></label>
        <textarea class="long-text" name="sibling_${index}_relationship" id="sibling_${index}_relationship"></textarea>
    </div>
    </div>
  `;

      container.appendChild(fs);

      fs.querySelectorAll('textarea.long-text').forEach(area => {
        area.addEventListener('input', () => autoExpandTextarea(area));
        autoExpandTextarea(area);
      });

      if (data) {
        const inputs = fs.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
          if (data[input.name] !== undefined) {
            if (input.type === 'radio' || input.type === 'checkbox') {
              if (input.value === data[input.name]) input.checked = true;
            } else {
              input.value = data[input.name];
            }
          }
        });
      }

      validateAllQuestions();
      updateProgressBar();
      updateQuestionnaireSummary();
    }

    function removeDynamicItem(button) {
      const fieldset = button.closest('.dynamic-item');
      const container = fieldset.parentElement;
      fieldset.remove();

      // Determine base name for reindexing
      let baseName = '';
      if (container.id === 'additional_carers_container') baseName = 'carer';
      else if (container.id === 'siblings_container') baseName = 'sibling';

      reindexItems(container.id, baseName);

      validateAllQuestions();
      updateProgressBar();
      updateQuestionnaireSummary();
    }

    function reindexItems(containerId, baseName) {
      const container = document.getElementById(containerId);
      const items = container.querySelectorAll('.dynamic-item');

      items.forEach((item, index) => {
        const newIndex = index + 1;

        // Update Legend
        const legend = item.querySelector('legend');
        if (legend) {
          // Preserve text, update number. Assuming format "Text Number"
          const text = legend.textContent.replace(/\d+$/, '');
          legend.textContent = text + newIndex;
        }

        // Update Hidden Blocks IDs first
        const hiddenBlocks = item.querySelectorAll('.qa-block.hidden');
        hiddenBlocks.forEach(block => {
          if (block.id) {
            block.id = block.id.replace(new RegExp(`${baseName}_\\d+`), `${baseName}_${newIndex}`);
          }
          if (block.hasAttribute('data-controlled-by')) {
            const val = block.getAttribute('data-controlled-by');
            block.setAttribute('data-controlled-by', val.replace(new RegExp(`${baseName}_\\d+`), `${baseName}_${newIndex}`));
          }
        });

        // Update Inputs and Labels
        const elements = item.querySelectorAll('input, textarea, select, label, div[role="radiogroup"]');
        elements.forEach(el => {
          const regex = new RegExp(`${baseName}_\\d+`);
          const replacement = `${baseName}_${newIndex}`;

          if (el.name) el.name = el.name.replace(regex, replacement);
          if (el.id) el.id = el.id.replace(regex, replacement);
          if (el.htmlFor) el.htmlFor = el.htmlFor.replace(regex, replacement);
          if (el.hasAttribute('aria-labelledby')) {
            const val = el.getAttribute('aria-labelledby');
            el.setAttribute('aria-labelledby', val.replace(regex, replacement));
          }
        });
      });
    }

    //saving

    const formStorageKey = 'child_questionnaire_data';

    const Security = {
      _secret: 'MuniFssDiagnostic2026',

      async _getKey() {
        const enc = new TextEncoder();
        const keyMaterial = await crypto.subtle.digest("SHA-256", enc.encode(this._secret));
        return crypto.subtle.importKey(
          "raw",
          keyMaterial,
          { name: "AES-GCM" },
          false,
          ["encrypt", "decrypt"]
        );
      },

      async encrypt(data) {
        const key = await this._getKey();
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const enc = new TextEncoder();
        const encodedData = enc.encode(JSON.stringify(data));

        const encryptedContent = await crypto.subtle.encrypt(
          {
            name: "AES-GCM",
            iv: iv
          },
          key,
          encodedData
        );

        return {
          iv: Array.from(iv),
          content: Array.from(new Uint8Array(encryptedContent)),
          version: "1.0"
        };
      },

      async decrypt(encryptedObj) {
        const key = await this._getKey();
        const iv = new Uint8Array(encryptedObj.iv);
        const content = new Uint8Array(encryptedObj.content);

        const decryptedContent = await crypto.subtle.decrypt(
          { name: "AES-GCM", iv: iv },
          key,
          content
        );

        const dec = new TextDecoder();
        return JSON.parse(dec.decode(decryptedContent));
      }
    };

    function getFormData() {
      const form = document.querySelector('form');
      const data = {};

      form.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'radio') {
          if (el.checked) data[el.name] = el.value;
        } else if (el.type === 'checkbox') {
          data[el.name] = el.checked;
        } else {
          data[el.name] = el.value;
        }
      });

      // Save dynamic carers
      const carers = [];
      document.querySelectorAll('#additional_carers_container .dynamic-item').forEach(fs => {
        const carerData = {};
        fs.querySelectorAll('input, select, textarea').forEach(el => {
          if (el.type === 'radio' || el.type === 'checkbox') {
            if (el.checked) carerData[el.name] = el.value;
          } else {
            carerData[el.name] = el.value;
          }
        });
        carers.push(carerData);
      });
      data['additional_carers'] = carers;

      // Save dynamic siblings
      const siblings = [];
      document.querySelectorAll('#siblings_container .dynamic-item').forEach(fs => {
        const siblingData = {};
        fs.querySelectorAll('input, select, textarea').forEach(el => {
          if (el.type === 'radio' || el.type === 'checkbox') {
            if (el.checked) siblingData[el.name] = el.value;
          } else {
            siblingData[el.name] = el.value;
          }
        });
        siblings.push(siblingData);
      });
      data['siblings'] = siblings;

      return data;
    }

    function saveForm(showNotification = false) {
      const data = getFormData();
      localStorage.setItem(formStorageKey, JSON.stringify(data));
      if (showNotification) {
        showCustomDialog("Uloženo", "Formulář byl úspěšně uložen do paměti prohlížeče.", "OK", "success");
      }
      const loadBtn = document.getElementById('load-from-storage-btn');
      if (loadBtn && loadBtn.disabled) { loadBtn.disabled = false; }
    }

    function generateFilenameBase(data) {
      const date = new Date();
      const timestamp = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;

      let childName = 'dite';
      if (data.child_name && data.child_name.trim().length > 0) {
        const parts = data.child_name.trim().split(/\s+/);
        if (parts.length === 1) {
          childName = parts[0];
        } else if (parts.length > 1) {
          const firstName = parts[0];
          const lastInitial = parts[parts.length - 1].charAt(0);
          childName = `${firstName}_${lastInitial}`;
        }
      }

      // Sanitize filename (remove potentially unsafe characters, keep alphanumeric, dashes, underscores)
      childName = childName.replace(/[^a-zA-Z0-9_\-\u00C0-\u017F]/g, '');
      return `dotaznik-${childName}-${timestamp}`;
    }

    async function saveAsJsonFile() {
      const data = getFormData();
      // Šifrování dat před uložením
      const encryptedData = await Security.encrypt(data);
      const jsonData = JSON.stringify(encryptedData, null, 2); // Pretty print JSON
      const blob = new Blob([jsonData], { type: 'application/json' });

      const suggestedName = `${generateFilenameBase(data)}.json`;

      // Use the modern File System Access API if available
      if (window.showSaveFilePicker) {
        try {
          const handle = await window.showSaveFilePicker({
            suggestedName: suggestedName,
            types: [{
              description: 'JSON Soubor',
              accept: { 'application/json': ['.json'] },
            }],
          });
          const writable = await handle.createWritable();
          await writable.write(blob);
          await writable.close();
        } catch (err) {
          // Handle cases where the user cancels the dialog
          if (err.name !== 'AbortError') {
            console.error('File save error:', err);
          }
        }
      } else {
        // Fallback for older browsers
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = suggestedName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);
      }
    }

    function loadData(data) {
      const form = document.querySelector('form');

      // Reset form first
      form.reset();
      document.getElementById('additional_carers_container').innerHTML = '';
      document.getElementById('siblings_container').innerHTML = '';

      // Load static fields
      form.querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'radio') {
          if (data[el.name] === el.value) el.checked = true;
        } else if (el.type === 'checkbox') {
          el.checked = !!data[el.name];
        } else if (data[el.name] !== undefined) {
          el.value = data[el.name];
        }
      });

      // Recreate dynamic carers
      if (data['additional_carers'] && Array.isArray(data['additional_carers'])) {
        data['additional_carers'].forEach(carer => {
          addCarer(carer);
        });
      }

      // Recreate dynamic siblings
      if (data['siblings'] && Array.isArray(data['siblings'])) {
        data['siblings'].forEach(sib => {
          addSibling(sib);
        });
      }
      // Trigger visibility checks for all conditional fields
      updateAllConditionals();

      // Ensure all textareas are expanded to fit loaded content
      form.querySelectorAll('textarea.long-text').forEach(area => {
        autoExpandTextarea(area);
      });

      // After adding new fields, re-validate the form to show/hide dots
      validateAllQuestions();
      updateProgressBar();

      // Re-validate all questions for error messages
      Validator.checkAll();

      // Summary update
      updateQuestionnaireSummary();
    }

    // Load saved data
    async function loadForm(isAutoLoad = false) {
      const saved = localStorage.getItem(formStorageKey);
      if (!saved) {
        if (!isAutoLoad) {
          await showCustomDialog(
            "Data nenalezena",
            "V paměti tohoto prohlížeče nebyl nalezen žádný rozpracovaný dotazník. Ujistěte se, že používáte stejný prohlížeč, jako posledně",
            "Zavřít",
            "warning"
          );
        }
        return;
      }
      const data = JSON.parse(saved);
      loadData(data);
      if (!isAutoLoad) {
        await showCustomDialog("Obnoveno", "Data byla úspěšně načtena z prohlížeče.", "OK", "success");
      }
    }


    // --- Clear History ---
    async function clearHistory() {
      const confirmed = await showCustomDialog(
        "Smazat historii?",
        "Opravdu chcete smazat uloženou historii? Tato akce trvale odstraní veškerá data uložená v prohlížeči a vymaže aktuálně vyplněný formulář.",
        "Smazat vše",
        "delete",
        true
      );

      if (confirmed) {
        localStorage.removeItem(formStorageKey);
        document.querySelector('form').reset();
        document.getElementById('additional_carers_container').innerHTML = '';
        document.getElementById('siblings_container').innerHTML = '';
        updateAllConditionals();
        validateAllQuestions();
        if (typeof Validator !== 'undefined') Validator.checkAll();
        updateProgressBar();
        updateQuestionnaireSummary();

        await showCustomDialog("Smazáno", "Veškerá data byla vymazána.", "OK", "success");

        const loadBtn = document.getElementById('load-from-storage-btn');
        if (loadBtn) loadBtn.disabled = true;
      }
    }

    // --- Live Unanswered Question Validation ---

    function validateQuestionBlock(block) {
      const label = block.querySelector('label > span');
      if (!label) return;

      let isUnanswered = false;

      // Ignore the calculated age field
      if (block.querySelector('#child_age')) {
        return;
      }

      // Case 1: Text, number, date, or textarea inputs
      const textInput = block.querySelector(':scope > input[type="text"], :scope > input[type="number"], :scope > input[type="date"], :scope > textarea, :scope > label > input[type="text"], :scope > label > input[type="number"]');
      if (textInput && textInput.value.trim() === '') {
        isUnanswered = true;
      }

      // Case 2: Radio button groups
      const radioGroup = block.querySelector(':scope > .select-group input[type="radio"]');
      if (radioGroup) {
        const checkedRadio = block.querySelector(`:scope > .select-group input[name="${radioGroup.name}"]:checked`);
        if (!checkedRadio) {
          isUnanswered = true;
        }
      }

      // Case 3: Checkbox groups (unanswered if none are checked)
      const checkboxGroup = block.querySelector(':scope > .select-group input[type="checkbox"]');
      if (checkboxGroup) {
        const isAnyCheckboxChecked = block.querySelector(':scope > .select-group input[type="checkbox"]:checked');
        if (!isAnyCheckboxChecked) {
          isUnanswered = true;
        }
      }

      const existingDot = label.querySelector('.unanswered-dot');

      if (isUnanswered) {
        if (!existingDot) {
          const dot = document.createElement('span');
          dot.className = 'unanswered-dot';
          label.prepend(dot);
        } else {
          existingDot.classList.remove('answered'); // Make it visible again
        }
      } else { // The question is answered
        if (!existingDot) {
          // If answered but no dot exists (e.g. after loading data), create it.
          const dot = document.createElement('span');
          dot.className = 'unanswered-dot answered';
          label.prepend(dot);
        } else {
          existingDot.classList.add('answered'); // Animate it out
        }
      }
    }

    function validateAllQuestions() {
      document.querySelectorAll('.qa-block:not(.hidden), .qa-block.is-visible').forEach(validateQuestionBlock);
    }

    function debounce(func, delay) {
      let timeout;
      return function (...args) {
        const context = this;
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(context, args), delay);
      };
    }

    function setupLiveValidation() {
      const form = document.getElementById('questionnaire');
      // Create a debounced auto-save function that saves silently.
      const autoSave = debounce(() => saveForm(false), 1500);
      const debouncedSummaryUpdate = debounce(() => updateQuestionnaireSummary(), 500);

      form.addEventListener('input', (event) => {
        const block = event.target.closest('.qa-block');
        if (block) {
          autoSave(); // Trigger auto-save on any input.
          validateQuestionBlock(block);
        }
        updateProgressBar();
        debouncedSummaryUpdate();
        // After adding new fields, re-validate the form to show/hide dots
        setTimeout(() => {
          validateAllQuestions();
        }, 100); // Delay to ensure dynamic elements are fully rendered
      });

      // Initial validation on page load
      validateAllQuestions();
    }

    // --- Print Text Replacement Generator ---
    function generatePrintReplacements() {
      // Najdeme všechny viditelné textarey
      const textareas = document.querySelectorAll('textarea');

      textareas.forEach(textarea => {
        // Zkontrolujeme, zda už náhradu nemá
        let replacementDiv = textarea.nextElementSibling;

        // Pokud element za textareou není naše náhrada, vytvoříme novou
        if (!replacementDiv || !replacementDiv.classList.contains('print-text-replacement')) {
          replacementDiv = document.createElement('div');
          replacementDiv.className = 'print-text-replacement';
          // Vložíme ji do DOMu hned za textareu
          textarea.parentNode.insertBefore(replacementDiv, textarea.nextSibling);
        }

        // Zkopírujeme text
        replacementDiv.textContent = textarea.value;
      });
    }

    function updateExportDate() {
      const el = document.getElementById('export-date');
      if (el) {
        const now = new Date();
        const days = ['Neděle', 'Pondělí', 'Úterý', 'Středa', 'Čtvrtek', 'Pátek', 'Sobota'];
        const dayName = days[now.getDay()];
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        el.textContent = `Zpráva vytvořena: ${dayName} ${day}.${month}.${year}, ${hours}:${minutes}`;
      }
    }


    // --- Print with Unanswered Marks ---

    function removeUnansweredMarks() {
      document.querySelectorAll('.unanswered-mark').forEach(mark => mark.remove());
    }

    function togglePrintPreview() {
      const body = document.body;
      const html = document.documentElement;
      const button = document.getElementById('preview-button');
      const form = document.getElementById('questionnaire');
      const isPreviewing = html.classList.toggle('preview-mode-active');
      body.classList.toggle('print-preview', isPreviewing);

      // Select all input fields
      const inputs = form.querySelectorAll('input, textarea, select');

      if (isPreviewing) {
        updateExportDate(); // Set current date
        generatePrintReplacements(); // Generování stínových divů pro tisk
        markUnansweredQuestions();
        window.scrollTo(0, 0); // Scroll to top

        // Make all fields non-editable
        inputs.forEach(el => {
          if (el.tagName.toLowerCase() !== 'select' && el.type !== 'radio' && el.type !== 'checkbox') {
            el.readOnly = true;
          }
        });

        // Reset textarea height for preview so CSS can take over
        // Recalculate height to fit content exactly, removing auto-expand gaps.
        document.querySelectorAll('textarea.long-text').forEach(area => {
          const buffer = area.scrollHeight * 0.15; // buffer as 15% of scrollHeight
          area.style.height = 'auto'; // Reset height
          area.style.height = `${area.scrollHeight + buffer}px`; // Set to content height + buffer
          area.style.overflow = 'hidden'; // Hide scrollbar that might appear
        });

        updatePreviewLayout();
        window.addEventListener('resize', updatePreviewLayout);

      } else {
        removeUnansweredMarks();
        inputs.forEach(el => {
          el.readOnly = false;
        });

        // Re-apply auto-expand to textareas when exiting preview
        document.querySelectorAll('textarea.long-text').forEach(area => {
          area.style.overflow = ''; // Restore default overflow
          autoExpandTextarea(area);
        });

        window.removeEventListener('resize', updatePreviewLayout);
        form.style.marginBottom = '';
      }
    }

    function updatePreviewLayout() {
      const form = document.getElementById('questionnaire');
      const html = document.documentElement;

      if (!html.classList.contains('preview-mode-active')) {
        form.style.marginBottom = '';
        return;
      }

      if (window.matchMedia('(max-width: 230mm)').matches) {
        const rect = form.getBoundingClientRect();
        const layoutHeight = form.offsetHeight;
        const emptySpace = layoutHeight - rect.height;
        form.style.marginBottom = `-${emptySpace - 40}px`;
      } else {
        form.style.marginBottom = '';
      }
    }

    function markUnansweredQuestions() {
      // Find all question blocks that are currently visible
      document.querySelectorAll('.qa-block:not(.hidden), .qa-block.is-visible').forEach(block => {
        const label = block.querySelector('label > span');
        if (!label) return;

        // Ignore the calculated age field from being marked as unanswered
        if (block.querySelector('#child_age')) {
          return;
        }

        let isUnanswered = false;
        // Case 1: Text, number, date, or textarea inputs
        // This selector handles both direct children and inputs nested inside the label.
        const textInput = block.querySelector(':scope > input[type="text"], :scope > input[type="number"], :scope > input[type="date"], :scope > textarea, :scope > label > input[type="text"], :scope > label > input[type="number"]');

        if (textInput && textInput.value.trim() === '') {
          isUnanswered = true;
        }

        // Case 2: Radio button groups
        const radioGroup = block.querySelector(':scope > .select-group input[type="radio"]');
        if (radioGroup) {
          const checkedRadio = block.querySelector(`:scope > .select-group input[name="${radioGroup.name}"]:checked`);
          if (!checkedRadio || checkedRadio.value === 'Bez odpovědi') {
            isUnanswered = true;
          }
        }

        // Case 3: Checkbox groups (if none are checked)
        const checkboxGroup = block.querySelector(':scope > .select-group input[type="checkbox"]');
        if (checkboxGroup) {
          const isAnyCheckboxChecked = block.querySelector(':scope > .select-group input[type="checkbox"]:checked');
          if (!isAnyCheckboxChecked) isUnanswered = true;
        }

        // Add the asterisk if the question is unanswered
        if (isUnanswered) {
          const mark = document.createElement('span');
          mark.className = 'unanswered-mark';
          mark.style.display = 'none'; // Hide by default, shown by print styles
          mark.textContent = '*';
          label.prepend(mark);
        }
      });
    }

    function updatePrintFooter(data) {
      // 1. Construct Footer Text (Left side)
      let childName = 'dite';
      if (data.child_name && data.child_name.trim().length > 0) {
        const parts = data.child_name.trim().split(/\s+/);
        if (parts.length === 1) {
          childName = parts[0];
        } else if (parts.length > 1) {
          const firstName = parts[0];
          const lastInitial = parts[parts.length - 1].charAt(0);
          childName = `${firstName} ${lastInitial}.`;
        }
      }

      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      const footerText = `${childName}, ${day}.${month}.${year}`;

      // 2. Inject Dynamic Style
      let styleEl = document.getElementById('dynamic-print-style');
      if (!styleEl) {
        styleEl = document.createElement('style');
        styleEl.id = 'dynamic-print-style';
        document.head.appendChild(styleEl);
      }

      styleEl.innerHTML = `
        @page {
          size: A4;
          margin: 20mm;
          margin-bottom: 25mm;

          @bottom-left {
            content: "${footerText}";
            font-family: "Times New Roman", Times, serif;
            font-size: 9pt;
            color: #888;
          }

          @bottom-right {
            content: counter(page) " / " counter(pages);
            font-family: "Times New Roman", Times, serif;
            font-size: 9pt;
            color: #888;
          }
        }
      `;
    }

    function printWithUnansweredMarks() {
      // This function is now used for the "Tisk PDF" button in preview
      updateExportDate(); // Ensure date is current
      generatePrintReplacements(); // Pro jistotu přegenerovat aktuální texty

      // Update document title for PDF filename
      // Store original title in a property to allow restoring it later if needed (though we hardcode restore)
      window.originalDocTitle = document.title;
      const data = getFormData();
      document.title = generateFilenameBase(data);

      updatePrintFooter(data); // Update formatting before print

      window.print();
    }

    window.addEventListener('afterprint', () => {
      // Restore title
      document.title = "Anamnéza dítěte";

      // Only remove marks if we are NOT in preview mode.
      if (!document.documentElement.classList.contains('preview-mode-active')) {
        removeUnansweredMarks();
      }
    });

    /** --- VALIDAČNÍ ENGINE --- **/
    const Validator = {
      ui: {
        show: function (inputElement, message, persistent = false) {
          const container = inputElement.closest('.qa-block');
          if (!container) return;

          let bubble = container.querySelector('.error-bubble');
          if (!bubble) {
            bubble = document.createElement('div');
            bubble.className = 'error-bubble';
            inputElement.parentNode.insertBefore(bubble, inputElement.nextSibling);
          }

          bubble.textContent = message;

          setTimeout(() => {
            bubble.classList.add('is-visible');
            inputElement.classList.add('input-error');
          }, 10);

          clearTimeout(inputElement.errorTimeout);
          if (!persistent) {
            inputElement.errorTimeout = setTimeout(() => this.hide(inputElement), 3000);
          }
        },

        hide: function (inputElement) {
          const container = inputElement.closest('.qa-block');
          if (container) {
            const bubble = container.querySelector('.error-bubble');
            if (bubble) {
              bubble.classList.remove('is-visible');
              inputElement.classList.remove('input-error');
            }
          }
        }
      },

      // LOGICKÁ PRAVIDLA 
      rules: {
        child_birthdate: function (input) {
          const ageInput = document.getElementById('child_age');
          const birthDate = new Date(input.value);
          const today = new Date();

          // Reset zobrazení věku
          if (ageInput) {
            ageInput.value = '';
            ageInput.classList.remove('age-error-text');
          }

          if (isNaN(birthDate)) return true; // Prázdné pole ignorujeme

          if (birthDate > today) {
            if (ageInput) {
              ageInput.value = 'Chybné datum';
              ageInput.classList.add('age-error-text');
            }
            return "Datum narození nemůže být v budoucnosti.";
          }

          // Výpočet věku:
          // $years = today_{year} - birth_{year}$
          let years = today.getFullYear() - birthDate.getFullYear();
          let months = today.getMonth() - birthDate.getMonth();
          if (months < 0) { years--; months += 12; }

          if (ageInput) {
            ageInput.value = `${formatYearsCzech(years)}, ${formatMonthsCzech(months)}`;
          }

          if (years >= 18) return "Věk vychází na více než 18 let. Zkontrolujte prosím správnost data.";

          return true; // Vše v pořádku
        },
      },

      // POMOCNÉ FUNKCE PRO SPOUŠTĚNÍ
      checkField: function (id) {
        const input = document.getElementById(id);
        if (!input || !this.rules[id]) return;
        const result = this.rules[id](input);
        result === true ? this.ui.hide(input) : this.ui.show(input, result, true);
      },

      checkAll: function () {
        Object.keys(this.rules).forEach(id => this.checkField(id));
      },

      // INICIALIZACE POSLUCHAČŮ
      init: function () {
        const form = document.getElementById('questionnaire');

        // Okamžité skrytí chyby při jakémkoli psaní (Váš požadavek)
        form.addEventListener('input', (e) => {
          if (e.target.type === 'number' || e.target.type === 'date') {
            this.ui.hide(e.target);
          }
        });

        // Validace po opuštění pole nebo změně (např. u Date picker)
        form.addEventListener('change', (e) => {
          if (this.rules[e.target.id]) {
            this.checkField(e.target.id);
          }
        });

        // Striktní blokování kláves pro čísla (pouze 0-9)
        form.addEventListener('keydown', (e) => {
          if (e.target.type === 'number') {
            // 1. Povolíme systémové zkratky (Ctrl+C, Ctrl+V, Cmd+A atd.)
            if (e.ctrlKey || e.metaKey || e.altKey) return;

            // 2. Definujeme klávesy, které neprodukují znak, ale ovládají pole
            const controlKeys = [
              'Backspace', 'Tab', 'Enter', 'Delete', 'Escape',
              'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
              'Home', 'End', 'Shift', 'CapsLock'
            ];

            if (controlKeys.includes(e.key)) return;

            // 3. Kontrola, zda jde o číslici 0-9
            // Používáme e.key, což u Shift+1 vrátí např. "!" (neprojde testem)
            const isDigit = /^[0-9]$/.test(e.key);

            if (!isDigit) {
              e.preventDefault();
              this.ui.show(e.target, "Lze vkládat pouze číslice.");
            }
          }
        });
      }
    };

    Validator.init();

    // Initialize all dynamic functionalities on page load
    document.addEventListener('DOMContentLoaded', () => {
      setupLiveValidation();

      // Check if there's saved data and enable/disable the load button
      const loadBtn = document.getElementById('load-from-storage-btn');
      if (loadBtn && !localStorage.getItem(formStorageKey)) {
        loadBtn.disabled = true;
      }

      const fileInput = document.getElementById('json-file-input');
      fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            const parsedData = JSON.parse(e.target.result);
            let data = parsedData;

            // Pokud data vypadají jako šifrovaná (mají iv a content), dešifrujeme je
            if (parsedData.iv && parsedData.content) {
              data = await Security.decrypt(parsedData);
            }

            loadData(data);
            await showCustomDialog("Soubor načten", "Data byla úspěšně nahrána do formuláře.", "OK", "success");
          } catch (error) {
            await showCustomDialog("Chyba souboru", "Soubor se nepodařilo zpracovat. Ujistěte se, že jde o platný soubor formátu JSON.", "Zavřít", "warning");
          }
        };
        reader.readAsText(file);
        fileInput.value = '';
      });

      Validator.checkAll();
      initSmartNav(); // Initialize Smart Nav
      // updateSmartNav is called inside initSmartNav

      // Disable mouse wheel scroll on number inputs to prevent accidental value changes
      document.addEventListener('wheel', (e) => {
        if (document.activeElement.type === 'number') {
          document.activeElement.blur();
        }
      });

      // Auto-load data if the page is being reloaded
      const isReload = (window.performance && window.performance.navigation && window.performance.navigation.type === 1) ||
        (window.performance && window.performance.getEntriesByType && window.performance.getEntriesByType("navigation").length > 0 && window.performance.getEntriesByType("navigation")[0].type === "reload");

      if (isReload && localStorage.getItem(formStorageKey)) {
        loadForm(true);
      }

    });



    // Summary PANEL
    /* --- LOGIKA SOUHRNNÉHO PANELU --- */

    function updateQuestionnaireSummary() {
      // Vybereme pouze bloky, které nejsou označené jako skupina (qa-group)
      const allBlocks = Array.from(document.querySelectorAll('.qa-block:not(.qa-group):not(.summary-ignore)'));

      let countAnswered = 0;
      let countRefused = 0;
      let countEmpty = 0;

      const attentionList = [];

      allBlocks.forEach(block => {
        // Ignorujeme pomocné bloky (věk)
        if (block.querySelector('#child_age')) return;

        // 1. STRIKTNÍ KONTROLA VIDITELNOSTI
        // Pokud je blok skrytý (nebo jeho rodič), zcela ho ignorujeme.
        const isHidden = block.classList.contains('hidden') && !block.classList.contains('is-visible');
        let parentHidden = false;
        let currentEl = block.parentElement;
        while (currentEl && currentEl.tagName !== 'FORM') {
          if (currentEl.classList.contains('hidden') && !currentEl.classList.contains('is-visible')) {
            parentHidden = true; break;
          }
          currentEl = currentEl.parentElement;
        }

        if (isHidden || parentHidden) {
          return; // Neviditelné otázky se nepočítají
        }

        // 2. KONTROLA OBSAHU U VIDITELNÝCH
        const fieldset = block.closest('fieldset');
        const sectionName = fieldset ? fieldset.querySelector('legend').textContent : 'Obecné';
        const labelEl = block.querySelector('label span');

        const questionText = labelEl ? labelEl.textContent.replace(':', '') : 'Otázka';

        const input = block.querySelector('input:not([type="radio"]):not([type="checkbox"]), textarea, select');
        const radioChecked = block.querySelector('input[type="radio"]:checked');
        const checkboxChecked = block.querySelector('input[type="checkbox"]:checked');

        const hasValue = (input && input.value.trim() !== "") || radioChecked || checkboxChecked;

        if (hasValue) {
          // Kontrola, zda je vybráno "Bez odpovědi"
          const isRadioRefused = radioChecked && radioChecked.value === "Bez odpovědi";

          if (isRadioRefused) {
            countRefused++;
            attentionList.push({
              id: block,
              section: sectionName,
              question: questionText,
              type: 'refused',
              label: 'Nechci odpovídat'
            });
          } else {
            countAnswered++;
          }
        } else {
          // Viditelná, ale prázdná
          countEmpty++;
          attentionList.push({
            id: block,
            section: sectionName,
            question: questionText,
            type: 'empty',
            label: 'Prázdné'
          });
        }
      });

      // 3. AKTUALIZACE DOM
      document.getElementById('count-answered').textContent = countAnswered;
      document.getElementById('count-refused').textContent = countRefused;
      document.getElementById('count-empty').textContent = countEmpty;

      // Generování seznamu detailů
      const listContainer = document.getElementById('summary-list');
      const emptyMsg = document.getElementById('summary-empty-msg');
      listContainer.innerHTML = '';

      if (attentionList.length === 0) {
        emptyMsg.style.display = 'block';
      } else {
        emptyMsg.style.display = 'none';
        attentionList.forEach(item => {
          const li = document.createElement('li');
          li.className = 'summary-list-item';
          li.innerHTML = `
                <div class="item-info">
                    <span class="item-section">${item.section}</span>
                    <span class="item-question">${item.question}</span>
                </div>
                <div class="item-status ${item.type}">${item.label}</div>
            `;

          li.addEventListener('click', (e) => {
            e.stopPropagation();
            scrollToAndHighlight(item.id);
          });

          listContainer.appendChild(li);
        });
      }
    }

    function scrollToAndHighlight(element) {
      // 1. Reset předchozích zvýraznění
      document.querySelectorAll('.highlighted-dot').forEach(el => el.classList.remove('highlighted-dot'));
      document.querySelectorAll('.allow-overflow').forEach(el => el.classList.remove('allow-overflow'));

      // Najdeme všechny předky, kteří by mohli oříznout obsah (qa-block, fieldset)
      const ancestorsToUnclip = [];
      let curr = element.parentElement;
      while (curr && curr.tagName !== 'FORM') {
        if (curr.classList.contains('qa-block') || curr.tagName === 'FIELDSET') {
          ancestorsToUnclip.push(curr);
        }
        curr = curr.parentElement;
      }

      // 2. Intersection Observer (spustí se až v momentě, kdy uživatel na prvek dokouká)
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            element.classList.add('highlighted-dot');
            ancestorsToUnclip.forEach(el => el.classList.add('allow-overflow'));

            observer.disconnect();

            // Odstranění tříd po 2.5 sekundách (animace trvá 2s + 0.5s rezerva)
            setTimeout(() => {
              element.classList.remove('highlighted-dot');
              ancestorsToUnclip.forEach(el => el.classList.remove('allow-overflow'));
            }, 4000);
          }
        });
      }, {
        threshold: 0.4
      });

      observer.observe(element);

      // 3. Plynulý scroll na střed
      element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }



    /** Custom dialogy */
    async function showCustomDialog(title, message, confirmText = "OK", type = "info", showCancel = false) {
      const dialog = document.getElementById('custom-confirm');
      const titleEl = document.getElementById('dialog-title');
      const messageEl = document.getElementById('dialog-message');
      const confirmBtn = document.getElementById('dialog-confirm');
      const cancelBtn = document.getElementById('dialog-cancel');

      titleEl.textContent = title;
      messageEl.textContent = message;
      confirmBtn.textContent = confirmText;

      dialog.className = '';
      dialog.classList.add(`type-${type}`);

      // Tlačítko Zrušit se ukáže jen pro potvrzovací dialogy
      cancelBtn.style.display = showCancel ? "inline-block" : "none";

      // Nastavení barvy hlavního tlačítka
      // Pokud je typ 'warning' nebo 'delete', dáme červené tlačítko
      if (type === 'warning' || type === 'delete') {
        confirmBtn.className = "btn btn-danger";
      } else {
        confirmBtn.className = "btn primary";
      }

      dialog.showModal();

      return new Promise((resolve) => {
        confirmBtn.onclick = () => { dialog.close(); resolve(true); };
        cancelBtn.onclick = () => { dialog.close(); resolve(false); };
        dialog.onclick = (e) => { if (e.target === dialog) { dialog.close(); resolve(false); } };
      });
    }


    function toggleSummaryDetails() {
      const body = document.getElementById('summary-details-body');
      const text = document.getElementById('summary-toggle-text');
      const arrow = document.getElementById('summary-arrow');
      const isOpen = body.classList.contains('is-open');

      if (isOpen) {
        body.classList.remove('is-open');
        arrow.classList.remove('is-rotated');
        text.textContent = "Zobrazit detaily";
      } else {
        body.classList.add('is-open');
        arrow.classList.add('is-rotated');
        text.textContent = "Skrýt detaily";
      }
    }

    function toggleHeaderMenu(event) {
      event.stopPropagation();
      const menu = document.getElementById('header-right-links');
      if (menu) {
        menu.classList.toggle('is-open');
      }
    }

    // Close menu when clicking outside
    document.addEventListener('click', function (event) {
      const menu = document.getElementById('header-right-links');
      const btn = document.querySelector('.menu-toggle-btn');
      if (menu && menu.classList.contains('is-open') && btn && !menu.contains(event.target) && !btn.contains(event.target)) {
        menu.classList.remove('is-open');
      }
    });

    // Spuštění po načtení
    document.addEventListener('DOMContentLoaded', () => {
      updateQuestionnaireSummary();
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        toggleTheme(null, 'dark');
      }
    });

    function toggleTheme(e, forceTheme) {
      if (e) e.preventDefault();
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = forceTheme ? forceTheme : (currentTheme === "dark" ? "light" : "dark");
      document.documentElement.setAttribute("data-theme", newTheme);
      localStorage.setItem('theme', newTheme);

      const themeIcon = document.getElementById("theme-icon");
      const themeText = document.getElementById("theme-text");

      if (newTheme === "dark") {
        themeText.textContent = "Světlý režim";
        themeIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun-icon lucide-sun"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`;
      } else {
        themeText.textContent = "Tmavý režim";
        themeIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon-icon lucide-moon"><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></svg>`;
      }
    }
  </script>



  <dialog id="custom-confirm">
    <div class="dialog-inner">
      <h3 id="dialog-title">Potvrzení</h3>
      <p id="dialog-message">Zpráva...</p>
      <div class="dialog-buttons">
        <button id="dialog-cancel" class="btn btn-secondary">Zrušit</button>
        <button id="dialog-confirm">OK</button>
      </div>
    </div>
  </dialog>

</body>

</html>
