<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dotazník dítěte</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f8; color: #333; margin: 0; padding: 20px; }
  h1 { color: #0000dc; text-align: center; margin-bottom: 30px; }
  form { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
  fieldset { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-bottom: 20px; background-color: #fafafa; }
  legend { font-weight: bold; color: #0000dc; font-size: 16px; padding: 0 5px; }
  label {
    display: block;
    margin-bottom: 0;
    font-weight: 500;
    page-break-inside: avoid;
  }
  input, select, textarea {
    padding: 6px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 14px;
    width: 100%;
    margin-left: 0;
    min-width: 0;
    box-sizing: border-box;
    margin-top: 6px;
    margin-bottom: 22px;
    line-height: 1.5;
    height: 38px;
    vertical-align: middle;
  }
  textarea.long-text {
    width: 100%;
    overflow-wrap: break-word;
    resize: vertical;
    box-sizing: border-box;
    margin-top: 6px;
    margin-bottom: 22px;
  }
  .hidden { display: none; }
  button { margin-top: 20px; background-color: #0000dc; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; }
  button:hover { background-color: #0000aa; }



/* Unified select-group alignment fix */
.select-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  width: 100%;
  margin-top: 6px;
  margin-bottom: 22px;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 8px;
  background: #fff;
  align-items: center;
  justify-content: flex-start;
  box-sizing: border-box;
}

.select-group label {
  display: flex;
  align-items: center;
  gap: 6px; /* spacing between input and text */
  font-weight: 500;
  margin: 0;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.15s ease, color 0.15s ease;
  user-select: none;
  min-height: 32px;
}

.select-group input[type="radio"],
.select-group input[type="checkbox"] {
  width: 18px;
  height: 18px;
  margin: 0; /* remove margin-right */
  accent-color: #0000dc;
}

.select-group label span {
  display: inline-block;
  padding: 2px 4px;
  border-radius: 4px;
  line-height: 1.2;
  height: auto;
}

.select-group label:hover span {
  background-color: #0000dc08;
}

.select-group input[type="radio"]:checked + span,
.select-group input[type="checkbox"]:checked + span {
  background-color: #0000dc10;
  color: #0000dc;
}

.select-group input[type="radio"]:focus-visible,
.select-group input[type="checkbox"]:focus-visible {
  outline: 2px solid rgba(0, 0, 220, 0.2);
  outline-offset: 2px;
}

  .page-footer {
  width: 100%;
  text-align: center;
  font-size: 10pt;
  color: #666;
  font-family: "Times New Roman", Times, serif;
  border-top: 1px solid #ccc;
  padding: 10px 0;
  margin-top: 40px;
  position: relative;
}

@media print {
  fieldset > label,
  fieldset > input,
  fieldset > select,
  fieldset > textarea,
  fieldset > .select-group,
  fieldset > .qa-block {
    page-break-inside: avoid !important;
  }

  @page { 
    size: A4; 
    margin: 20mm; 
  }

@media print {
/* Keep dynamic fieldsets (siblings, carers) visually grouped */
#additional_carers_container fieldset,
#siblings_container fieldset {
page-break-inside: avoid !important; /* never split mid-section */
border: none !important;
margin: 0 0 10mm 5mm !important; /* small left indent for hierarchy */
padding: 0 !important;
}


#additional_carers_container legend,
#siblings_container legend {
font-size: 13pt !important;
color: #000 !important;
font-weight: bold !important;
margin-left: 0 !important;
margin-bottom: 4mm !important;
}


#additional_carers_container .qa-block,
#siblings_container .qa-block {
margin-left: 5mm !important; /* indent questions */
page-break-inside: avoid !important;
}


#additional_carers_container label,
#siblings_container label,
#additional_carers_container textarea,
#siblings_container textarea,
#additional_carers_container input,
#siblings_container input {
page-break-inside: avoid !important;
}
}

  body {
    background-color: white;
    padding: 0;
    margin: 0;
    font-size: 12pt;
    font-family: "Times New Roman", Times, serif;
    color: black;
  }

  h1 {
    font-weight: bold;
    font-size: 20pt;
    color: #0000dc;
    margin-bottom: 20px;
    font-family: "Times New Roman", Times, serif;
  }

  form {
    box-shadow: none;
    background: none;
    padding: 0;
    max-width: 100%;
    font-family: "Times New Roman", Times, serif;
  }

  fieldset {
    background: none;
    border: none !important;
    padding: 0 !important;
    margin-bottom: 25px !important;
    font-family: "Times New Roman", Times, serif;
  }

  legend {
    color: #0000dc; 
    font-size: 14pt;
    font-weight: normal;
    border-bottom: none;
    margin-left: 0 !important;
    padding: 0 !important;
    margin-bottom: 25px !important;
    text-align: left !important;
    font-family: "Times New Roman", Times, serif;
  }

  label {
    display: block !important;
    justify-content: flex-start;
    margin-bottom: 6px !important;
    page-break-inside: avoid !important;
    font-weight: normal;
    color: black; 
    font-family: "Times New Roman", Times, serif;
  }

  label span {
    display: block;
    margin-bottom: 4px;
    font-weight: normal;
    color: black; 
    font-family: "Times New Roman", Times, serif;
  }

  input,
  select,
  textarea {
    display: block !important;
    border: none;
    background: none;
    width: 100% !important;
    font-weight: normal;
    margin-left: 0 !important;
    color: #444; 
    font-family: "Times New Roman", Times, serif;
    font-size: 12pt;
    page-break-inside: avoid !important;
    margin-bottom: 22px !important;
  }

  textarea {
    resize: none;
    white-space: pre-wrap;
    overflow: visible !important;
  }

  select {
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
    appearance: none !important;
    pointer-events: none;
  }

  select::-ms-expand { display: none !important; }

  textarea::-webkit-scrollbar { display: none !important; }

  .select-group {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 16px !important;
    margin-top: 0 !important;
    margin-bottom: 22px !important;
    padding: 0 !important;
    background: none !important;
    border: none !important;
    page-break-inside: avoid !important;
  }

  .select-group label {
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
    font-weight: normal !important;
    font-size: 12pt !important;
    color: #000 !important;
    padding: 0 !important;
    margin: 0 !important;
    background: none !important;
    border: none !important;
    cursor: default !important;
  }

  .select-group input[type="radio"],
  .select-group input[type="checkbox"] {
    width: 14px !important;
    height: 14px !important;
    margin: 0 !important;
    accent-color: #000 !important;
  }

  .select-group label span {
    display: inline-block !important;
    line-height: 1.2 !important;
    color: #000 !important;
    font-weight: normal !important;
  }

  .select-group input[type="radio"]:checked + span,
  .select-group input[type="checkbox"]:checked + span {
    font-weight: bold !important;
  }

  .qa-block {
    display: block !important;
    page-break-inside: avoid !important;
    margin-bottom: 22px !important;
  }

  .hidden, button { display: none; }

  .page-footer {
    display: block !important;
    position: relative;
    text-align: center;
    font-size: 10pt;
    color: #666;
    font-family: "Times New Roman", Times, serif;
    border-top: 1px solid #ccc;
    padding-top: 4mm;
    margin-top: 10mm;
    background: none;
  }

  .page-footer p {
    margin: 1px 0;
    line-height: 1.2;
  }
}


</style>
</head>
<body>

<h1>Anamnestický dotazník</h1>
<form id="questionnaire">

  <!-- Základní údaje -->
<fieldset>
  <legend>Základní údaje</legend>
  <div class="qa-block">
    <label><span>Jméno dítěte:</span></label>
    <input class="short-text" type="text" name="child_name">
  </div>
  <div class="qa-block">
    <label><span>Jak si dítě přeje být oslovováno:</span></label>
    <input class="short-text" type="text" name="child_preferred_name">
  </div>
  <div class="qa-block">
    <label><span>Datum narození dítěte:</span></label>
    <input type="date" name="child_birthdate" id="child_birthdate">
  </div>
  <div class="qa-block">
    <label><span>Věk:</span></label>
    <input type="text" name="child_age" id="child_age" readonly style="cursor:default; pointer-events: none;">
  </div>
</fieldset>

<fieldset>
  <legend>Rodinná anamnéza</legend>
  <div class="qa-block">
    <label><span>Jméno matky:</span></label>
    <input class="short-text" type="text" name="mother_name">
  </div>
  <div class="qa-block">
    <label><span>Věk matky:</span></label>
    <input type="number" name="mother_age">
  </div>
  <div class="qa-block">
    <label><span>Jméno otce:</span></label>
    <input class="short-text" type="text" name="father_name">
  </div>
  <div class="qa-block">
    <label><span>Věk otce:</span></label>
    <input type="number" name="father_age">
  </div>
  <div class="qa-block">
    <label><span>Rodiče jsou:</span></label>
    <div class="select-group">
      <label><input type="radio" name="parents_status" value="-"><span>-</span></label>
      <label><input type="radio" name="parents_status" value="Biologičtí"><span>Biologičtí</span></label>
      <label><input type="radio" name="parents_status" value="Vychovávající"><span>Vychovávající</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Biologická matka je vychovávající matka?</span></label>
    <div class="select-group">
      <label><input type="radio" name="bio_mother_status" value="-"><span>-</span></label>
      <label><input type="radio" name="bio_mother_status" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="bio_mother_status" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Biologický otec je vychovávající otec?</span></label>
    <div class="select-group">
      <label><input type="radio" name="bio_father_status" value="-"><span>-</span></label>
      <label><input type="radio" name="bio_father_status" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="bio_father_status" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Existuje další vychovávající rodič/pečovatel?</span></label>
    <div class="select-group">
      <label><input type="radio" name="additional_carer_status" value="-"><span>-</span></label>
      <label><input type="radio" name="additional_carer_status" value="Ano - plná péče"><span>Ano - plná péče</span></label>
      <label><input type="radio" name="additional_carer_status" value="Ano - střídavá péče"><span>Ano - střídavá péče</span></label>
      <label><input type="radio" name="additional_carer_status" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Má matka nějaká zdravotní omezení?</span></label>
    <div class="select-group">
      <label><input type="radio" name="mother_health" value="-"><span>-</span></label>
      <label><input type="radio" name="mother_health" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="mother_health" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block hidden" id="q_mother_health_detail">
    <label><span>Pokud ano, uveďte prosím jaká omezení:</span></label>
    <textarea class="long-text" name="mother_health_detail"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Má otec nějaká zdravotní omezení?</span></label>
    <div class="select-group">
      <label><input type="radio" name="father_health" value="-"><span>-</span></label>
      <label><input type="radio" name="father_health" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="father_health" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block hidden" id="q_father_health_detail">
    <label><span>Pokud ano, uveďte prosím jaká omezení:</span></label>
    <textarea class="long-text" name="father_health_detail"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Je matka dítěte momentálně zaměstnaná?</span></label>
    <div class="select-group">
      <label><input type="radio" name="mother_employed" value="-"><span>-</span></label>
      <label><input type="radio" name="mother_employed" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="mother_employed" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block hidden" id="q_mother_jobs_detail">
    <label><span>Jaká zaměstnání vykonává matka:</span></label>
    <textarea class="long-text" name="mother_jobs"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Je otec dítěte momentálně zaměstnaný?</span></label>
    <div class="select-group">
      <label><input type="radio" name="father_employed" value="-"><span>-</span></label>
      <label><input type="radio" name="father_employed" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="father_employed" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block hidden" id="q_father_jobs_detail">
    <label><span>Jaká zaměstnání vykonává otec:</span></label>
    <textarea class="long-text" name="father_jobs"></textarea>
  </div>
   <div class="qa-block">
    <label><span>Vychovává dítě i někdo jiný (podstatným způsobem zasahuje do života dítěte)?</span></label>
    <div class="select-group">
      <label><input type="radio" name="other_carer_status" value="-"><span>-</span></label>
      <label><input type="radio" name="other_carer_status" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="other_carer_status" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block hidden" id="q_other_carer_detail">
    <label><span>Kolik dalších osob dítě vychovává?</span></label>
    <input type="number" name="additional_carers_count" id="additional_carers_count" min="0">
    <div id="additional_carers_container"></div>
  </div>
  <div class="qa-block">
    <label><span>Má dítě sourozence?</span></label>
    <div class="select-group">
      <label><input type="radio" name="has_siblings" value="-"><span>-</span></label>
      <label><input type="radio" name="has_siblings" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="has_siblings" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block-hidden" id="q_siblings_detail">
    <label><span>Kolik má sourozenců?</span></label>
    <input type="number" name="siblings_count" id="siblings_count" min="0">
    <div id="siblings_container"></div>
  </div>
</fieldset>

<fieldset>
  <legend>Zdravotní anamnéza</legend>
  <div class="qa-block">
    <label><span>Bylo dítě někdy vyšetřeno neurologem, psychiatrem nebo klinickým psychologem?</span></label>
    <div class="select-group">
      <label><input type="radio" name="neurolog_exam" value="-"><span>-</span></label>
      <label><input type="radio" name="neurolog_exam" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="neurolog_exam" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Jaké diagnózy stanovil:</span></label>
    <textarea class="long-text" name="diagnoses"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Trpí dítě některými chronickými onemocněními?</span></label>
    <textarea class="long-text" name="chronic_illnesses"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Prodělalo dítě v minulosti nějaké vážné zdravotní komplikace?</span></label>
    <textarea class="long-text" name="past_health_issues"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Byl dítěti někdy vyšetřen zrak?</span></label>
    <div class="select-group">
      <label><input type="radio" name="vision_exam" value="-"><span>-</span></label>
      <label><input type="radio" name="vision_exam" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="vision_exam" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Má dítě se zrakem nějaké obtíže?</span></label>
    <div class="select-group">
      <label><input type="radio" name="vision_issues" value="-"><span>-</span></label>
      <label><input type="radio" name="vision_issues" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="vision_issues" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Dítě:</span></label>
    <div class="select-group">
      <label><input type="checkbox" name="vision_devices_glasses"><span>Nosí brýle</span></label>
      <label><input type="checkbox" name="vision_devices_contacts"><span>Nosí kontaktní čočky</span></label>
      <label><input type="checkbox" name="vision_devices_occluder"><span>Používá okluzory</span></label>
      <label><input type="checkbox" name="vision_devices_surgery"><span>Podstoupilo operaci očí</span></label>
    </div>
  </div>
</fieldset>

<fieldset>
  <legend>Sociální anamnéza</legend>
  <div class="qa-block">
    <label><span>V jakém typu bydlení žijete?</span></label>
    <select name="housing_type">
      <option value="-" selected>-</option>
      <option value="Dům">Dům</option>
      <option value="Byt">Byt</option>
      <option value="Jiné">Jiné</option>
    </select>
  </div>
  <div class="qa-block">
    <label><span>Jak jste s bydlením spokojení?</span></label>
    <textarea class="long-text" name="housing_satisfaction"></textarea>
  </div>
  <div class="qa-block">
    <label><span>Kolik lidí žije ve vaší domácnosti?</span></label>
    <input type="number" name="household_count">
  </div>
  <div class="qa-block">
    <label><span>Má dítě vlastní pokoj?</span></label>
    <div class="select-group">
      <label><input type="radio" name="child_own_room" value="-"><span>-</span></label>
      <label><input type="radio" name="child_own_room" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="child_own_room" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  <div class="qa-block">
    <label><span>Má dítě vlastní pracovní stůl?</span></label>
    <div class="select-group">
      <label><input type="radio" name="child_own_desk" value="-"><span>-</span></label>
      <label><input type="radio" name="child_own_desk" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="child_own_desk" value="Ne"><span>Ne</span></label>
    </div>
  </div>
  
  <div class="qa-block">
    <label><span>Kolik hodin denně trávíte (vy nebo další rodiče / pečovatelé) doma s dětmi?</span></label>
    <input type="number" name="time_with_children">
  </div>

  <div class="qa-block">
    <label><span>Máte prostor s dítětem něco procvičovat?</span></label>
    <div class="select-group">
      <label><input type="radio" name="practice_with_child" value="-" checked><span>-</span></label>
      <label><input type="radio" name="practice_with_child" value="Ano"><span>Ano</span></label>
      <label><input type="radio" name="practice_with_child" value="Ne"><span>Ne</span></label>
    </div>
  </div>

  <div class="qa-block">
    <label><span>Jaká je vaše oblíbená činnost s dítětem (může jich být i více)?</span></label>
    <textarea class="long-text" name="fav_activity_with_child"></textarea>
  </div>

  <div class="qa-block">
    <label><span>Jaká je oblíbená činnost dítěte obecně?</span></label>
    <textarea class="long-text" name="child_fav_activity"></textarea>
  </div>

  <div class="qa-block">
    <label><span>Jestli má dítě oblíbený film, jaký to je?</span></label>
    <input type="text" name="child_fav_movie">
  </div>

  <div class="qa-block">
    <label><span>Jestli má dítě oblíbenou knihu, jaká to je?</span></label>
    <input type="text" name="child_fav_book">
  </div>

  <div class="qa-block">
      <label><span>Má dítě přístup k telefonu nebo tabletu?</span></label>
      <div class="select-group">
        <label><input type="radio" name="child_has_device" value="-" checked><span>-</span></label>
        <label><input type="radio" name="child_has_device" value="Ano"><span>Ano</span></label>
        <label><input type="radio" name="child_has_device" value="Ne"><span>Ne</span></label>
      </div>
    </div>

  <div class="qa-block-hidden" id="q_child_device_detail1">
    <label><span>Jak moc dítě podle vás používá mobil nebo tablet ve srovnání s vrstevníky?</span></label>
    <input type="text" name="child_device_use_relative">
  </div>

  <div class="qa-block-hidden" id="q_child_device_detail2">
    <label><span>Co dítě na telefonu nejčastěji dělá (seřaďte podle frekvence)?</span></label>
    <textarea class="long-text" name="child_device_usage"></textarea>
  </div>

  <div class="qa-block-hidden" id="q_child_device_detail3">
    <label><span>Pokoušíte se nějakým způsobem kontrolovat, co dítě na telefonu dělá (např. výchovně nebo omezením přímo v telefonu)?</span></label>
    <textarea class="long-text" name="child_device_control"></textarea>
  </div>

  <div class="qa-block">
    <label><span>Jak moc je pro vás používání mobilu či tabletu tématem ve výchově?</span></label>
    <textarea class="long-text" name="child_device_parenting_theme"></textarea>
  </div>
</fieldset>


  <button type="button" onclick="window.print()">Tisk / Uložit pdf</button>
  
<div class="save.buttons">
  <button type="button" onclick="saveForm()">Uložit pro příště</button>
  <button type="button" onclick="loadForm()">Načíst poslední</button>
  <button type="button" onclick="clearHistory()">Smazat historii</button>
</div>


<footer class="page-footer">
  <p>© 2025 MUNI FSS - Diagnostika dítěte</p>
  <p>Garant: Mgr. Zuzana Masopustová, PhD.</p>
  <p>Volně dostupné na webu: diagnostikaditete.cz</p>
</footer>

</form>

<script>
// Replacement setupConditional that supports radio groups and <select>
function setupConditional(selectName, detailId) {
  const detailDiv = document.getElementById(detailId);
  if (!detailDiv) return;
  detailDiv.style.display = 'none';

  // Try to find radios first
  const radios = Array.from(document.querySelectorAll(`[name="${selectName}"]`));
  const isRadioGroup = radios.length > 1 || (radios.length === 1 && radios[0].type === 'radio');

  if (isRadioGroup) {
    // If there is a "-" option, select it by default
    const dash = radios.find(r => r.value === '-');
    if (dash) dash.checked = true;

    const update = () => {
      const checked = document.querySelector(`[name="${selectName}"]:checked`);
      detailDiv.style.display = checked && checked.value === 'Ano' ? 'block' : 'none';
    };

    radios.forEach(r => r.addEventListener('change', update));
    // run once to set initial visibility
    update();
  } else {
    // Fallback for single select/input
    const elem = document.querySelector(`[name="${selectName}"]`);
    if (!elem) return;
    // if it's a <select> and has "-" option, select it
    if (elem.tagName === 'SELECT') {
      const opt = Array.from(elem.options).find(o => o.value === '-');
      if (opt) elem.value = '-';
    }
    elem.addEventListener('change', () => {
      detailDiv.style.display = elem.value === 'Ano' ? 'block' : 'none';
    });
    // initial state
    detailDiv.style.display = elem.value === 'Ano' ? 'block' : 'none';
  }
}

setupConditional('mother_health', 'q_mother_health_detail');
setupConditional('father_health', 'q_father_health_detail');
setupConditional('other_carer_status', 'q_other_carer_detail');
setupConditional('mother_employed', 'q_mother_jobs_detail');
setupConditional('father_employed', 'q_father_jobs_detail');
setupConditional('has_siblings', 'q_siblings_detail');
setupConditional('child_has_device', 'q_child_device_detail1');
setupConditional('child_has_device', 'q_child_device_detail2');
setupConditional('child_has_device', 'q_child_device_detail3');

// Set "-" as baseline everywhere else too
window.addEventListener('DOMContentLoaded', () => {
  // For all selects
  document.querySelectorAll('select').forEach(sel => {
    if ([...sel.options].some(o => o.value === '-')) {
      sel.value = '-';
    }
  });

  // For all radio groups
  const groups = [...new Set([...document.querySelectorAll('input[type="radio"]')].map(r => r.name))];
  groups.forEach(name => {
    const radios = document.getElementsByName(name);
    const dash = [...radios].find(r => r.value === '-');
    if (dash) dash.checked = true;
  });
});


  // Auto-expand long textareas
  document.querySelectorAll('textarea.long-text').forEach(area => {
    area.addEventListener('input', () => {
      area.style.height = 'auto';
      area.style.height = area.scrollHeight + 'px';
    });
  });

// Dynamic generation for additional carers
const additionalCarersCountInput = document.getElementById('additional_carers_count');
const additionalCarersContainer = document.getElementById('additional_carers_container');
additionalCarersCountInput.addEventListener('input', () => {
  const count = parseInt(additionalCarersCountInput.value) || 0;
  additionalCarersContainer.innerHTML = '';
  for (let i = 1; i <= count; i++) {
    const fs = document.createElement('fieldset');
    fs.innerHTML = `
      <legend>Další vychovávající osoba ${i}</legend>
      <label><span>Jméno osoby ${i}:</span><input class="short-text" type="text" name="carer_${i}_name"></label>
      <label><span>Věk osoby ${i}:</span><input type="number" name="carer_${i}_age"></label>
      <div class="qa-block"><label><span>Jaké jsou vaše vztahy s osobou ${i}:</span></label><textarea class="long-text" name="carer_${i}_relation"></textarea></div>
      <div class="qa-block"><label><span>V jaké domácnosti osoba ${i} dítě vychovává:</span></label><textarea class="long-text" name="carer_${i}_household"></textarea></div>
    `;
    additionalCarersContainer.appendChild(fs);
    fs.querySelectorAll('textarea.long-text').forEach(area => {
      area.addEventListener('input', () => {
        area.style.height = 'auto';
        area.style.height = area.scrollHeight + 'px';
      });
    });
  }
});

// Dynamic generation for siblings
const siblingsCountInput = document.getElementById('siblings_count');
const siblingsContainer = document.getElementById('siblings_container');
siblingsCountInput.addEventListener('input', () => {
  const count = parseInt(siblingsCountInput.value) || 0;
  siblingsContainer.innerHTML = '';
  for (let i = 1; i <= count; i++) {
    const fs = document.createElement('fieldset');
    fs.innerHTML = `
      <legend>Sourozenec ${i}</legend>
      <label><span>Jméno sourozence ${i}:</span><input class="short-text" type="text" name="sibling_${i}_name"></label>
      <label><span>Věk sourozence ${i}:</span><input type="number" name="sibling_${i}_age"></label>
      <div class="qa-block">
        <label><span>Jsou dítě a sourozenec biologičtí příbuzní:</span></label>
        <div class="select-group">
          <label><input type="radio" name="sibling_${i}_biological" value="-" checked><span>-</span></label>
          <label><input type="radio" name="sibling_${i}_biological" value="Ano"><span>Ano</span></label>
          <label><input type="radio" name="sibling_${i}_biological" value="Ne"><span>Ne</span></label>
        </div>
      </div>
      <div class="qa-block">
        <label><span>Má dítě se sourozencem společné rodiče:</span></label>
        <div class="select-group">
          <label><input type="radio" name="sibling_${i}_common_parents" value="-" checked><span>-</span></label>
          <label><input type="radio" name="sibling_${i}_common_parents" value="Ano"><span>Ano</span></label>
          <label><input type="radio" name="sibling_${i}_common_parents" value="Ne"><span>Ne</span></label>
        </div>
      </div>
      <div class="qa-block">
        <label><span>Žijí ve stejné domácnosti:</span></label>
        <div class="select-group">
          <label><input type="radio" name="sibling_${i}_same_household" value="-" checked><span>-</span></label>
          <label><input type="radio" name="sibling_${i}_same_household" value="Ano"><span>Ano</span></label>
          <label><input type="radio" name="sibling_${i}_same_household" value="Ne"><span>Ne</span></label>
        </div>
      </div>
      <div class="qa-block"><label><span>Jaký mají vztah:</span></label><textarea class="long-text" name="sibling_${i}_relationship"></textarea></div>
      <div class="qa-block"><label><span>Fyzické a psychické diagnózy:</span></label><textarea class="long-text" name="sibling_${i}_diagnoses"></textarea></div>
    `;
    siblingsContainer.appendChild(fs);
    fs.querySelectorAll('textarea.long-text').forEach(area => {
      area.addEventListener('input', () => {
        area.style.height = 'auto';
        area.style.height = area.scrollHeight + 'px';
      });
    });
  }
});


//saving

const formStorageKey = 'child_questionnaire_data';

function saveForm() {
  const form = document.querySelector('form');
  const data = {};

  form.querySelectorAll('input, select, textarea').forEach(el => {
    if (el.type === 'radio') {
      if (el.checked) data[el.name] = el.value;
    } else if (el.type === 'checkbox') {
      data[el.name] = el.checked;
    } else {
      data[el.name] = el.value;
    }
  });

  // Save dynamic carers
  const carers = [];
  document.querySelectorAll('#additional_carers_container fieldset').forEach(fs => {
    const carerData = {};
    fs.querySelectorAll('input, textarea').forEach(el => {
      carerData[el.name] = el.value;
    });
    carers.push(carerData);
  });
  data['additional_carers'] = carers;

  // Save dynamic siblings
  const siblings = [];
  document.querySelectorAll('#siblings_container fieldset').forEach(fs => {
    const siblingData = {};
    fs.querySelectorAll('input, select, textarea').forEach(el => {
      if (el.type === 'radio') {
        if (el.checked) siblingData[el.name] = el.value;
      } else if (el.type === 'checkbox') {
        siblingData[el.name] = el.checked;
      } else {
        siblingData[el.name] = el.value;
      }
    });
    siblings.push(siblingData);
  });
  data['siblings'] = siblings;

  localStorage.setItem(formStorageKey, JSON.stringify(data));
  alert("Formulář byl uložen.");
}

// Load saved data
function loadForm() {
  const saved = localStorage.getItem(formStorageKey);
  if (!saved) {
    alert("Žádná uložená data nejsou k dispozici.");
    return;
  }
  const data = JSON.parse(saved);
  const form = document.querySelector('form');

  // Reset form first
  form.reset();
  document.getElementById('additional_carers_container').innerHTML = '';
  document.getElementById('siblings_container').innerHTML = '';

  // Load static fields
  form.querySelectorAll('input, select, textarea').forEach(el => {
    if (el.type === 'radio') {
      if (data[el.name] === el.value) el.checked = true;
    } else if (el.type === 'checkbox') {
      el.checked = !!data[el.name];
    } else if (data[el.name] !== undefined) {
      el.value = data[el.name];
    }
  });

  // Recreate dynamic carers
  if (data['additional_carers']) {
    data['additional_carers'].forEach((carer, i) => {
      const fs = document.createElement('fieldset');
      fs.innerHTML = `
        <legend>Další vychovávající osoba ${i + 1}</legend>
        <label><span>Jméno osoby ${i + 1}:</span><input class="short-text" type="text" name="carer_${i+1}_name" value="${carer['carer_' + (i+1) + '_name'] || ''}"></label>
        <label><span>Věk osoby ${i + 1}:</span><input type="number" name="carer_${i+1}_age" value="${carer['carer_' + (i+1) + '_age'] || ''}"></label>
        <div class="qa-block"><label><span>Jaké jsou vaše vztahy s osobou ${i + 1}:</span></label><textarea class="long-text" name="carer_${i+1}_relation">${carer['carer_' + (i+1) + '_relation'] || ''}</textarea></div>
        <div class="qa-block"><label><span>V jaké domácnosti osoba ${i + 1} dítě vychovává:</span></label><textarea class="long-text" name="carer_${i+1}_household">${carer['carer_' + (i+1) + '_household'] || ''}</textarea></div>
      `;
      document.getElementById('additional_carers_container').appendChild(fs);
    });
  }

  // Recreate dynamic siblings
  if (data['siblings']) {
    data['siblings'].forEach((sib, i) => {
      const fs = document.createElement('fieldset');
      fs.innerHTML = `
        <legend>Sourozenec ${i + 1}</legend>
        <label><span>Jméno sourozence ${i + 1}:</span><input class="short-text" type="text" name="sibling_${i+1}_name" value="${sib['sibling_' + (i+1) + '_name'] || ''}"></label>
        <label><span>Věk sourozence ${i + 1}:</span><input type="number" name="sibling_${i+1}_age" value="${sib['sibling_' + (i+1) + '_age'] || ''}"></label>
        <label><span>Jsou dítě a sourozenec biologičtí příbuzní:</span></label>
        <select name="sibling_${i+1}_biological">
          <option value="-" ${sib['sibling_' + (i+1) + '_biological']==='-'?'selected':''}>-</option>
          <option value="Ano" ${sib['sibling_' + (i+1) + '_biological']==='Ano'?'selected':''}>Ano</option>
          <option value="Ne" ${sib['sibling_' + (i+1) + '_biological']==='Ne'?'selected':''}>Ne</option>
        </select>
        <label><span>Má dítě se sourozencem společné rodiče:</span></label>
        <select name="sibling_${i+1}_common_parents">
          <option value="-" ${sib['sibling_' + (i+1) + '_common_parents']==='-'?'selected':''}>-</option>
          <option value="Ano" ${sib['sibling_' + (i+1) + '_common_parents']==='Ano'?'selected':''}>Ano</option>
          <option value="Ne" ${sib['sibling_' + (i+1) + '_common_parents']==='Ne'?'selected':''}>Ne</option>
        </select>
        <label><span>Žijí ve stejné domácnosti:</span></label>
        <select name="sibling_${i+1}_same_household">
          <option value="-" ${sib['sibling_' + (i+1) + '_same_household']==='-'?'selected':''}>-</option>
          <option value="Ano" ${sib['sibling_' + (i+1) + '_same_household']==='Ano'?'selected':''}>Ano</option>
          <option value="Ne" ${sib['sibling_' + (i+1) + '_same_household']==='Ne'?'selected':''}>Ne</option>
        </select>
        <div class="qa-block"><label><span>Jaký mají vztah:</span></label><textarea class="long-text" name="sibling_${i+1}_relationship">${sib['sibling_' + (i+1) + '_relationship'] || ''}</textarea></div>
        <div class="qa-block"><label><span>Fyzické a psychické diagnózy:</span></label><textarea class="long-text" name="sibling_${i+1}_diagnoses">${sib['sibling_' + (i+1) + '_diagnoses'] || ''}</textarea></div>
      `;
      document.getElementById('siblings_container').appendChild(fs);
    });
  }

  alert("Formulář byl obnoven z poslední uložené verze.");
}

// Clear history
function clearHistory() {
  if (confirm("Opravdu chcete smazat uloženou historii?")) {
    localStorage.removeItem(formStorageKey);
    document.querySelector('form').reset();
    document.getElementById('additional_carers_container').innerHTML = '';
    document.getElementById('siblings_container').innerHTML = '';
    alert("Historie byla smazána.");
  }
}

</script>

</body>
</html>
